"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[939],{92594:function(En,pe,n){n.r(pe),n.d(pe,{default:function(){return jn}});var ke=n(15009),W=n.n(ke),we=n(99289),te=n.n(we),Ge=n(97857),k=n.n(Ge),Me=n(5574),F=n.n(Me),We=n(56034),xe=n(45360),Se=n(42075),ye=n(55102),Ce=n(14726),Ke=n(75081),r=n(67294),ae=n(33067),e=n(85893),He=function(i){var u=i.value,T=u===void 0?{}:u,g=i.onChange,C=i.reload,B=C===void 0?0:C,R=i.placeholder,D=R===void 0?"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801":R,L=(0,r.useState)(""),A=F()(L,2),p=A[0],K=A[1],V=(0,r.useState)(""),E=F()(V,2),w=E[0],G=E[1],M=(0,r.useState)(""),y=F()(M,2),x=y[0],N=y[1],X=(0,r.useState)(!1),z=F()(X,2),H=z[0],$=z[1],v=function(){var O=te()(W()().mark(function t(){var I;return W()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,(0,ae.xx)({key:w});case 3:if(I=S.sent,I.code!==0){S.next=6;break}return S.abrupt("return",I.data);case 6:S.next=12;break;case 8:return S.prev=8,S.t0=S.catch(0),xe.ZP.error("\u83B7\u53D6\u90E8\u95E8\u6811\u5931\u8D25,\u8BF7\u91CD\u8BD5"),S.abrupt("return",[]);case 12:return xe.ZP.error("\u83B7\u53D6\u90E8\u95E8\u6811\u5931\u8D25,\u8BF7\u91CD\u8BD5"),S.abrupt("return",[]);case 14:case"end":return S.stop()}},t,null,[[0,8]])}));return function(){return O.apply(this,arguments)}}(),f=function(t){g&&g(k()(k()({captchaCode:p,captchaKey:w},T),t))},h=function(t){$(!0),v().then(function(I){$(!1),G(I.key),N(I.img),t&&f({captchaKey:I.key})})};(0,r.useEffect)(function(){h(!1)},[]),(0,r.useEffect)(function(){B>0&&h(!0)},[B]);var d=function(t){var I=t.target.value||"";I&&K(I),f({captchaCode:I})},j=function(){h(!0)};return(0,e.jsxs)(Se.Z,{children:[(0,e.jsx)(ye.Z,{prefix:(0,e.jsx)(We.Z,{}),size:"large",placeholder:D,onChange:d}),(0,e.jsx)(Ce.ZP,{size:"large",style:{overflow:"hidden",padding:0,width:112},children:(0,e.jsx)(Ke.Z,{spinning:H,size:"small",children:(0,e.jsx)("img",{src:x,onClick:j})})})]})},de=He,Oe=n(99702),Ue=n(62871),Qe=n(64182),re=n(19179),Ve=n(74700),Ze=n(87547),je=n(94149),Xe=n(71356),Ye=n(84517),ve=n(5966),ie=n(34994),Je=n(97462),l=n(1413),oe=n(74165),Pe=n(15861),fe=n(45987),he=n(97685),qe=n(8232),Fe=n(90789),_e=["rules","name","phoneName","fieldProps","onTiming","captchaTextRender","captchaProps"],en=r.forwardRef(function(a,i){var u=qe.Z.useFormInstance(),T=(0,r.useState)(a.countDown||60),g=(0,he.Z)(T,2),C=g[0],B=g[1],R=(0,r.useState)(!1),D=(0,he.Z)(R,2),L=D[0],A=D[1],p=(0,r.useState)(),K=(0,he.Z)(p,2),V=K[0],E=K[1],w=a.rules,G=a.name,M=a.phoneName,y=a.fieldProps,x=a.onTiming,N=a.captchaTextRender,X=N===void 0?function(v,f){return v?"".concat(f," \u79D2\u540E\u91CD\u65B0\u83B7\u53D6"):"\u83B7\u53D6\u9A8C\u8BC1\u7801"}:N,z=a.captchaProps,H=(0,fe.Z)(a,_e),$=function(){var v=(0,Pe.Z)((0,oe.Z)().mark(function f(h){return(0,oe.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.prev=0,E(!0),j.next=4,H.onGetCaptcha(h);case 4:E(!1),A(!0),j.next=13;break;case 8:j.prev=8,j.t0=j.catch(0),A(!1),E(!1),console.log(j.t0);case 13:case"end":return j.stop()}},f,null,[[0,8]])}));return function(h){return v.apply(this,arguments)}}();return(0,r.useImperativeHandle)(i,function(){return{startTiming:function(){return A(!0)},endTiming:function(){return A(!1)}}}),(0,r.useEffect)(function(){var v=0,f=a.countDown;return L&&(v=window.setInterval(function(){B(function(h){return h<=1?(A(!1),clearInterval(v),f||60):h-1})},1e3)),function(){return clearInterval(v)}},[L]),(0,r.useEffect)(function(){x&&x(C)},[C,x]),(0,e.jsxs)("div",{style:(0,l.Z)((0,l.Z)({},y==null?void 0:y.style),{},{display:"flex",alignItems:"center"}),ref:i,children:[(0,e.jsx)(ye.Z,(0,l.Z)((0,l.Z)({},y),{},{style:(0,l.Z)({flex:1,transition:"width .3s",marginRight:8},y==null?void 0:y.style)})),(0,e.jsx)(Ce.ZP,(0,l.Z)((0,l.Z)({style:{display:"block"},disabled:L,loading:V},z),{},{onClick:(0,Pe.Z)((0,oe.Z)().mark(function v(){var f;return(0,oe.Z)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(d.prev=0,!M){d.next=9;break}return d.next=4,u.validateFields([M].flat(1));case 4:return f=u.getFieldValue([M].flat(1)),d.next=7,$(f);case 7:d.next=11;break;case 9:return d.next=11,$("");case 11:d.next=16;break;case 13:d.prev=13,d.t0=d.catch(0),console.log(d.t0);case 16:case"end":return d.stop()}},v,null,[[0,13]])})),children:X(L,C)}))]})}),nn=(0,Fe.G)(en),tn=nn,Te=n(98082),an=n(10915),rn=n(28459),on=n(93967),sn=n.n(on),me=n(4942),ln=function(i){return(0,me.Z)((0,me.Z)({},i.componentCls,{"&-container":{display:"flex",flex:"1",flexDirection:"column",height:"100%",paddingInline:32,paddingBlock:24,overflow:"auto",background:"inherit"},"&-top":{textAlign:"center"},"&-header":{display:"flex",alignItems:"center",justifyContent:"center",height:"44px",lineHeight:"44px",a:{textDecoration:"none"}},"&-title":{position:"relative",insetBlockStart:"2px",color:"@heading-color",fontWeight:"600",fontSize:"33px"},"&-logo":{width:"44px",height:"44px",marginInlineEnd:"16px",verticalAlign:"top",img:{width:"100%"}},"&-desc":{marginBlockStart:"12px",marginBlockEnd:"40px",color:i.colorTextSecondary,fontSize:i.fontSize},"&-main":{minWidth:"328px",maxWidth:"580px",margin:"0 auto","&-other":{marginBlockStart:"24px",lineHeight:"22px",textAlign:"start"}}}),"@media (min-width: @screen-md-min)",(0,me.Z)({},"".concat(i.componentCls,"-container"),{paddingInline:0,paddingBlockStart:32,paddingBlockEnd:24,backgroundRepeat:"no-repeat",backgroundPosition:"center 110px",backgroundSize:"100%"}))};function un(a){return(0,Te.Xj)("LoginForm",function(i){var u=(0,l.Z)((0,l.Z)({},i),{},{componentCls:".".concat(a)});return[ln(u)]})}var cn=["logo","message","contentStyle","title","subTitle","actions","children","containerStyle","otherStyle"];function dn(a){var i,u=a.logo,T=a.message,g=a.contentStyle,C=a.title,B=a.subTitle,R=a.actions,D=a.children,L=a.containerStyle,A=a.otherStyle,p=(0,fe.Z)(a,cn),K=(0,an.YB)(),V=p.submitter===!1?!1:(0,l.Z)((0,l.Z)({searchConfig:{submitText:K.getMessage("loginForm.submitText","\u767B\u5F55")}},p.submitter),{},{submitButtonProps:(0,l.Z)({size:"large",style:{width:"100%"}},(i=p.submitter)===null||i===void 0?void 0:i.submitButtonProps),render:function(z,H){var $,v=H.pop();if(typeof(p==null||($=p.submitter)===null||$===void 0?void 0:$.render)=="function"){var f,h;return p==null||(f=p.submitter)===null||f===void 0||(h=f.render)===null||h===void 0?void 0:h.call(f,z,H)}return v}}),E=(0,r.useContext)(rn.ZP.ConfigContext),w=E.getPrefixCls("pro-form-login"),G=un(w),M=G.wrapSSR,y=G.hashId,x=function(z){return"".concat(w,"-").concat(z," ").concat(y)},N=(0,r.useMemo)(function(){return u?typeof u=="string"?(0,e.jsx)("img",{src:u}):u:null},[u]);return M((0,e.jsxs)("div",{className:sn()(x("container"),y),style:L,children:[(0,e.jsxs)("div",{className:"".concat(x("top")," ").concat(y).trim(),children:[C||N?(0,e.jsxs)("div",{className:"".concat(x("header")),children:[N?(0,e.jsx)("span",{className:x("logo"),children:N}):null,C?(0,e.jsx)("span",{className:x("title"),children:C}):null]}):null,B?(0,e.jsx)("div",{className:x("desc"),children:B}):null]}),(0,e.jsxs)("div",{className:x("main"),style:(0,l.Z)({width:328},g),children:[(0,e.jsxs)(ie.A,(0,l.Z)((0,l.Z)({isKeyPressSubmit:!0},p),{},{submitter:V,children:[T,D]})),R?(0,e.jsx)("div",{className:x("main-other"),style:A,children:R}):null]})]}))}var Be=n(22270),vn=n(84567),Ie=n(20677),fn=["options","fieldProps","proFieldProps","valueEnum"],hn=r.forwardRef(function(a,i){var u=a.options,T=a.fieldProps,g=a.proFieldProps,C=a.valueEnum,B=(0,fe.Z)(a,fn);return(0,e.jsx)(Ie.Z,(0,l.Z)({ref:i,valueType:"checkbox",valueEnum:(0,Be.h)(C,void 0),fieldProps:(0,l.Z)({options:u},T),lightProps:(0,l.Z)({labelFormatter:function(){return(0,e.jsx)(Ie.Z,(0,l.Z)({ref:i,valueType:"checkbox",mode:"read",valueEnum:(0,Be.h)(C,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,l.Z)({options:u},T),proFieldProps:g},B))}},B.lightProps),proFieldProps:g},B))}),mn=r.forwardRef(function(a,i){var u=a.fieldProps,T=a.children;return(0,e.jsx)(vn.Z,(0,l.Z)((0,l.Z)({ref:i},u),{},{children:T}))}),gn=(0,Fe.G)(mn,{valuePropName:"checked"}),Ae=gn;Ae.Group=hn;var pn=Ae,se=n(7837),xn=n(9361),Sn=n(10397),yn=n(48096),Re=n(73935),J={container:"container___ldtvs",lang:"lang___qrAB8",content:"content___wB3e_","ant-pro-form-login-container":"ant-pro-form-login-container___Z1bnX",icon:"icon___CBYA8"},ge=n(37233),Cn=function(){return(0,e.jsx)(Zn,{})},Zn=function(){var i,u,T=(0,se.useModel)("@@initialState"),g=T.initialState,C=T.setInitialState,B=(0,r.useState)(0),R=F()(B,2),D=R[0],L=R[1],A=(0,r.useState)(0),p=F()(A,2),K=p[0],V=p[1],E=(0,r.useState)(!1),w=F()(E,2),G=w[0],M=w[1],y=(0,r.useState)(!1),x=F()(y,2),N=x[0],X=x[1],z=(0,se.useSearchParams)(),H=F()(z,1),$=H[0],v=(0,r.useContext)(Qe.DN),f=v.clientId,h=v.messageData,d=v.bind,j=(0,r.useState)(),O=F()(j,2),t=O[0],I=O[1],De=(0,r.useState)(),S=F()(De,2),q=S[0],be=S[1];(0,r.useEffect)(function(){(0,Ve.A)().then(function(o){I(o),be(o==null?void 0:o.loginTypeDefault)})},[]);var Le=function(s){(0,ae.MU)(s.access_token),d==null||d(),C(function(m){return k()(k()({},m),{},{currentUser:s.userinfo,settings:k()(k()({},m==null?void 0:m.settings),s.setting)})}).then(function(){var m,U="/",c="/";if(s.userinfo.redirect)c=s.userinfo.redirect;else if(g!=null&&(m=g.settings)!==null&&m!==void 0&&m.baseurl){var b;c=U.replace(g==null||(b=g.settings)===null||b===void 0?void 0:b.baseurl,"/")}se.history.push(c)})};(0,r.useEffect)(function(){if(h){var o=h.data;(o==null?void 0:o.action)=="login"&&(ge.Z.set("Sa-Remember",1),re.yw.success({content:o.msg,duration:1,onClose:function(){(0,Re.flushSync)(function(){Le(o)})}}))}},[h]);var Pn=function(){var o=te()(W()().mark(function s(m){return W()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,ae.ZP.post("login",{data:k()(k()({},m),{},{loginType:q}),duration:1,then:function(Z){var Y=Z.code,Q=Z.msg,_=Z.data;Z.code?(re.t6.error({description:Q,message:"\u63D0\u793A"}),q=="phone"&&Z.code==3&&V(D+1),G&&L(D+1),(Z.code==3||Z.code==2)&&M(!0)):(m.autoLogin?ge.Z.set("Sa-Remember",1):ge.Z.set("Sa-Remember",0),re.yw.success({content:Q,duration:1,onClose:function(){(0,Re.flushSync)(function(){Le(Z.data)})}}))}});case 2:return c.abrupt("return");case 3:case"end":return c.stop()}},s)}));return function(m){return o.apply(this,arguments)}}(),le={};t!=null&&t.loginBgImgage&&(le.backgroundImage='url("'+t.loginBgImgage+'")');var Ee=(0,r.useRef)(),Fn=[{label:"\u624B\u673A\u53F7\u767B\u5F55",key:"phone",children:q!="phone"?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ve.Z,{name:"mobile",fieldProps:{size:"large",prefix:(0,e.jsx)(Ze.Z,{className:J.prefixIcon})},placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"},{pattern:/^1\d{10}$/,message:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"}]}),(0,e.jsx)(ie.A.Item,{name:"captchaPhone",rules:[{required:!0,message:"\u83B7\u53D6\u624B\u673A\u9A8C\u8BC1\u7801\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"}],children:(0,e.jsx)(de,{reload:K,placeholder:"\u83B7\u53D6\u624B\u673A\u9A8C\u8BC1\u7801\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"})}),(0,e.jsx)(Je.Z,{name:["captchaPhone"],children:function(s){var m=s.captchaPhone;return(0,e.jsx)(tn,{fieldProps:{size:"large",prefix:(0,e.jsx)(je.Z,{})},countDown:60,captchaProps:{size:"large"},phoneName:"mobile",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",captchaTextRender:function(c,b){return c?"".concat(b," \u83B7\u53D6\u9A8C\u8BC1\u7801"):"\u83B7\u53D6\u9A8C\u8BC1\u7801"},name:"mobilecode",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"}],onGetCaptcha:function(){var U=te()(W()().mark(function c(b){var Z,Y,Q,_;return W()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,(Z=Ee.current)===null||Z===void 0?void 0:Z.validateFields(["captcha"]);case 3:P.next=8;break;case 5:throw P.prev=5,P.t0=P.catch(0),new Error("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25");case 8:return P.next=10,ae.ZP.post("sms",{data:{mobile:b,captcha:m}});case 10:if(Y=P.sent,Q=Y.code,_=Y.msg,!Q){P.next=15;break}throw new Error(_);case 15:case"end":return P.stop()}},c,null,[[0,5]])}));return function(c){return U.apply(this,arguments)}}()})}}),G&&(0,e.jsx)(ie.A.Item,{name:"captcha",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"}],children:(0,e.jsx)(de,{reload:D})})]})},{label:"\u8D26\u53F7\u5BC6\u7801\u767B\u5F55",key:"password",children:q!="password"?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ve.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(Ze.Z,{className:J.prefixIcon})},placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"}]}),(0,e.jsx)(ve.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(je.Z,{className:J.prefixIcon})},placeholder:"\u8BF7\u8F93\u5165\u767B\u5F55\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"}]}),G&&(0,e.jsx)(ie.A.Item,{name:"captcha",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"}],children:(0,e.jsx)(de,{reload:D})})]})}],Tn=xn.Z.useToken(),Bn=Tn.token,In={marginInlineStart:"16px",color:(0,Te.uK)(Bn.colorTextBase,.2),fontSize:"24px",verticalAlign:"middle",cursor:"pointer"},An=function(s){var m=s.type,U=(0,r.useState)(0),c=F()(U,2),b=c[0],Z=c[1],Y=(0,r.useState)("active"),Q=F()(Y,2),_=Q[0],ue=Q[1],P=3*60,ce,Ne=function ee(ne){var Ln=Date.now();Ln>ne+P*1e3?ue("expired"):ce=setTimeout(function(){return ee(ne)},1e3)},Rn=function(){var ne=Date.now();Z(ne),ue("active"),ce=setTimeout(function(){return Ne(ne)},1e3)};if((0,r.useEffect)(function(){var ee=Date.now();return Z(ee),ce=setTimeout(function(){return Ne(ee)},1e3),function(){return clearTimeout(ce)}},[]),m=="wechat"){var ze=t==null?void 0:t.loginWechat,Dn=ze.url,bn=ze.desc,$e=Dn+"?client_id="+f+"&timestamp="+b;return console.log("qrcodeUrl",$e),(0,e.jsxs)("div",{style:{textAlign:"center"},children:[b?(0,e.jsx)(Sn.Z,{style:{margin:"0 auto"},value:$e,status:_,onRefresh:Rn}):null,(0,e.jsx)("div",{style:{marginTop:20},children:bn})]})}return null};return t?(0,e.jsxs)("div",{className:J.container,style:k()({},le),children:[(0,e.jsx)(se.Helmet,{children:(0,e.jsxs)("title",{children:["\u767B\u5F55 - ",t==null?void 0:t.title]})}),(0,e.jsx)("div",{className:J.content,style:le.backgroundImage?{}:{padding:0},children:(0,e.jsx)(Ye.ZP,{style:{margin:"0px auto",padding:"20px 0",background:le.backgroundImage?"#fff":"none"},children:(0,e.jsxs)(dn,{contentStyle:{minWidth:280,maxWidth:"75vw"},containerStyle:{paddingInline:0},formRef:Ee,logo:t==null?void 0:t.logo,title:t==null?void 0:t.title,subTitle:t!=null&&t.subtitle?(0,e.jsx)("span",{dangerouslySetInnerHTML:{__html:t==null?void 0:t.subtitle}}):null,initialValues:{autoLogin:!0},onFinish:function(){var o=te()(W()().mark(function s(m){return W()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Pn(m);case 2:case"end":return c.stop()}},s)}));return function(s){return o.apply(this,arguments)}}(),actions:t!=null&&t.loginActions?(0,e.jsxs)(Se.Z,{children:["\u5176\u4ED6\u767B\u5F55\u65B9\u5F0F",(0,e.jsx)(Ue.Z,{trigger:(0,e.jsx)(Xe.Z,{style:In}),width:350,title:"\u626B\u7801\u767B\u5F55",children:t==null||(i=t.loginActions)===null||i===void 0?void 0:i.map(function(o,s){return(0,e.jsx)(An,{type:o},s)})})]}):null,children:[(0,e.jsx)(yn.Z,{centered:!0,activeKey:q,onChange:function(s){be(s),X(s=="phone")},items:(u=t.loginType)===null||u===void 0?void 0:u.map(function(o){return Fn.find(function(s){return s.key==o})})}),N?null:(0,e.jsxs)("div",{style:{marginBottom:24},children:[(0,e.jsx)(pn,{noStyle:!0,name:"autoLogin",children:"\u81EA\u52A8\u767B\u5F55"}),(0,e.jsx)("a",{style:{float:"right"},onClick:function(){re.yw.info("\u8BF7\u4F7F\u7528\u624B\u673A\u53F7\u767B\u5F55\u540E\u4FEE\u6539,\u6216\u8054\u7CFB\u540E\u53F0\u7BA1\u7406\u5458\u4FEE\u6539\u8D26\u53F7\u5BC6\u7801\uFF01")},children:"\u5FD8\u8BB0\u5BC6\u7801"})]})]})})}),(0,e.jsx)(Oe.Z,{})]}):null},jn=Cn}}]);
