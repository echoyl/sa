"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[318],{55318:function(Qe,K,a){a.r(K),a.d(K,{default:function(){return Re}});var oe=a(19632),g=a.n(oe),ve=a(15009),Q=a.n(ve),ce=a(99289),fe=a.n(ce),me=a(5574),j=a.n(me),ge=a(68400),he=a.n(ge),xe=a(97857),u=a.n(xe),W=a(97584),A=a(51042),ye=a(79090),pe=a(14726),je=a(9361),X=a(36457),Se=a(40411),Te=a(96917),f=a(67294),b=a(60887),B=a(45587),Ce=a(97133),Le=a(70145),Z=a(65302),n=a(85893),Y,Ie=function(l){var N=l.originNode,I=l.file,o=(0,B.nB)({id:I.uid}),O=o.attributes,D=o.listeners,h=o.setNodeRef,S=o.transform,v=o.transition,x=o.isDragging,c={cursor:"move",transition:"unset",height:"100%",width:"100%"},E=S?u()(u()({},c),{},{transform:"translate3d(".concat(S.x,"px, ").concat(S.y,"px, 0)"),transition:x?"unset":v},x?{zIndex:9999}:{}):c,V=x?(0,Ce.iv)(Y||(Y=he()([`
        a {
          pointer-events: none;
        }
      `]))):"";return(0,n.jsx)("div",u()(u()(u()({ref:h,style:E,className:V},O),D),{},{children:I.status==="error"&&x?N.props.children:N}))},Pe=function(l){var N=(0,f.useState)(),I=j()(N,2),o=I[0],O=I[1],D=l.max,h=D===void 0?1:D,S=l.type,v=S===void 0?"image":S,x=l.value,c=x===void 0?[]:x,E=l.size,V=E===void 0?0:E,$=l.accept,Ne=$===void 0?v=="image"?"image/*":"application/*,text/*":$,w=l.fieldProps,T=w===void 0?{name:"file",listType:"picture-card",data:{toSize:V,isFile:v=="image"?0:1}}:w,k=l.buttonType,m=k===void 0?"card":k,q=l.readonly,U=q===void 0?!1:q,De=(0,f.useState)([]),_=j()(De,2),e=_[0],y=_[1],ee=(0,f.useContext)(Le.r),z=ee.notificationApi,G=ee.setting,Ee=(0,f.useState)(!1),te=j()(Ee,2),Ue=te[0],ae=te[1],ze=(0,f.useState)(0),ne=j()(ze,2),Fe=ne[0],ie=ne[1],Ae=(0,f.useState)(!1),le=j()(Ae,2),F=le[0],H=le[1];T.maxCount=h,T.multiple=h>1,T.accept=Ne;var re=function(t){if((0,Z.jg)(t))return{url:t,value:t};var r;return{url:[G==null||(r=G.adminSetting)===null||r===void 0?void 0:r.fileImagePrefix,t].join(""),value:t}};(0,f.useEffect)(function(){(0,W.hu)().then(function(i){O(i)})},[]),(0,f.useEffect)(function(){var i=[];if((0,Z.d8)(c))i.push(re(c)),y(i);else if((0,Z.H1)(c)){if(c.length<1)return;c.map(function(t){(0,Z.d8)(t)?i.push(re(t)):i.push(t)}),y(i)}},[c]);var be=function(){var i=fe()(Q()().mark(function t(r){return Q()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(v!="file"){d.next=2;break}return d.abrupt("return");case 2:e.forEach(function(C,L){r.uid==C.uid&&ie(L)}),ae(!0);case 4:case"end":return d.stop()}},t)}));return function(r){return i.apply(this,arguments)}}();v=="image"&&(T.onPreview=be);var Be=(0,n.jsxs)("div",{children:[(0,n.jsx)(A.Z,{}),(0,n.jsx)("div",{style:{marginTop:4},children:v=="image"?"\u9009\u56FE\u7247":"\u9009\u6587\u4EF6"}),(0,n.jsxs)("div",{children:[e==null?void 0:e.length,"/",h]})]}),Oe=m=="card"||m=="table"?(0,n.jsxs)("div",{children:[F?(0,n.jsx)(ye.Z,{}):(0,n.jsx)(A.Z,{}),(0,n.jsx)("div",{style:{marginTop:8},children:v=="image"?"\u9009\u56FE\u7247":"\u9009\u6587\u4EF6"})]}):(0,n.jsx)(pe.ZP,{icon:(0,n.jsx)(A.Z,{}),children:v=="image"?"\u9009\u56FE\u7247":"\u9009\u6587\u4EF6"}),Ve=(0,b.VT)(b.we,{activationConstraint:{distance:10}}),Ge=function(t){var r=t.active,s=t.over;if(r.id!==(s==null?void 0:s.id)){var d,C=e.findIndex(function(p){return p.uid===r.id}),L=e.findIndex(function(p){return p.uid===(s==null?void 0:s.id)}),P=(0,B.Rp)(e,C,L);y(g()(P)),(d=l.onChange)===null||d===void 0||d.call(l,g()(P))}},se=function(t){if(t.file.status==="uploading"&&(H(!0),y(g()(t.fileList))),t.file.status==="done"){var r=t.file.response,s=r.code,d=r.msg,C=r.data,L=e.findIndex(function(R){return R.uid==t.file.uid}),P={uid:t.file.uid,name:t.file.name,url:s?"":C.src,value:s?"":C.url,status:s?"error":"done"};if(L>=0?e.splice(L,1,P):e.push(P),s)t.file.status="error",t.file.errorMsg=d;else{var p;(p=l.onChange)===null||p===void 0||p.call(l,g()(e))}y(g()(e)),H(!1)}if(t.file.status==="removed"){var M,ue=e.filter(function(R){return R.uid!=t.file.uid});(M=l.onChange)===null||M===void 0||M.call(l,g()(ue)),y(ue)}if(t.file.status==="error"){var J;z==null||(J=z.error)===null||J===void 0||J.call(z,{description:"".concat(t.file.name," \u4E0A\u4F20\u5931\u8D25. ").concat(t.file.errorMsg),message:"\u63D0\u793A"});var Ke=e.findIndex(function(R){return R.uid==t.file.uid});e.splice(Ke,1),y(g()(e)),H(!1)}},de=W.m7+"uploader/index",He=je.Z.useToken,Me=He(),Je=Me.token;return(0,n.jsxs)(n.Fragment,{children:[h==1||U?(0,n.jsx)(X.Z,u()(u()({},T),{},{headers:o,listType:m=="card"||m=="table"?"picture-card":"text",className:m=="table"?"sa-upload-list sa-upload-list-table":"sa-upload-list",showUploadList:e!=null&&e.length&&!F?{showRemoveIcon:!U}:!1,action:de,fileList:e!=null&&e.length?[e[0]]:[],onChange:se,itemRender:function(t){return(0,n.jsx)(Se.Z,{color:Je.colorPrimary,count:(e==null?void 0:e.length)>1&&U?e==null?void 0:e.length:0,size:"small",offset:[-10,10],styles:{root:{height:"100%",width:"100%"}},children:t})},children:e!=null&&e.length&&!F||U?null:Oe})):(0,n.jsx)(b.LB,{sensors:[Ve],onDragEnd:Ge,children:(0,n.jsx)(B.Fo,{items:e==null?void 0:e.map(function(i){return i.uid}),children:(0,n.jsx)(X.Z,u()(u()({},T),{},{headers:o,action:de,listType:m=="card"||m=="table"?"picture-card":"text",className:m=="table"?"sa-upload-list sa-upload-list-table":"sa-upload-list",itemRender:function(t,r){return(0,n.jsx)(Ie,{originNode:t,file:r})},fileList:e,onChange:se,children:e!=null&&e.length&&e.length==h&&!F?null:Be}))})}),(e==null?void 0:e.length)>0&&(0,n.jsx)("div",{style:{display:"none"},children:(0,n.jsx)(Te.Z.PreviewGroup,{preview:{visible:Ue,current:Fe,onVisibleChange:function(t){ae(t)},onChange:function(t){ie(t)}},items:e==null?void 0:e.map(function(i){if(i.url){var t=i.url.split("?"),r=j()(t,1),s=r[0];return s}else return""})})})]})},Re=Pe}}]);
