"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[939],{19034:function(at,Ie,n){n.r(Ie),n.d(Ie,{default:function(){return Gn}});var Je=n(15009),O=n.n(Je),qe=n(99289),oe=n.n(qe),_e=n(97857),J=n.n(_e),en=n(5574),b=n.n(en),nn=n(56034),de=n(45360),be=n(42075),Fe=n(55102),Re=n(14726),tn=n(74330),i=n(67294),ee=n(97584),e=n(85893),an=function(r){var o=r.value,p=o===void 0?{}:o,x=r.onChange,v=r.reload,u=v===void 0?0:v,y=r.placeholder,W=y===void 0?"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801":y,F=(0,i.useState)(""),D=b()(F,2),C=D[0],w=D[1],M=(0,i.useState)(""),G=b()(M,2),V=G[0],Q=G[1],K=(0,i.useState)(""),Z=b()(K,2),j=Z[0],E=Z[1],U=(0,i.useState)(!1),H=b()(U,2),Y=H[0],A=H[1],P=function(){var q=oe()(O()().mark(function z(){var R;return O()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,I.next=3,(0,ee.xx)({key:V});case 3:if(R=I.sent,R.code!==0){I.next=6;break}return I.abrupt("return",R.data);case 6:I.next=12;break;case 8:return I.prev=8,I.t0=I.catch(0),de.ZP.error("\u83B7\u53D6\u90E8\u95E8\u6811\u5931\u8D25,\u8BF7\u91CD\u8BD5"),I.abrupt("return",[]);case 12:return de.ZP.error("\u83B7\u53D6\u90E8\u95E8\u6811\u5931\u8D25,\u8BF7\u91CD\u8BD5"),I.abrupt("return",[]);case 14:case"end":return I.stop()}},z,null,[[0,8]])}));return function(){return q.apply(this,arguments)}}(),h=function(z){x&&x(J()(J()({captchaCode:C,captchaKey:V},p),z))},T=function(z){A(!0),P().then(function(R){A(!1),Q(R.key),E(R.img),z&&h({captchaKey:R.key})})};(0,i.useEffect)(function(){T(!1)},[]),(0,i.useEffect)(function(){u>0&&T(!0)},[u]);var m=function(z){var R=z.target.value||"";R&&w(R),h({captchaCode:R})},N=function(){T(!0)};return(0,e.jsxs)(be.Z,{children:[(0,e.jsx)(Fe.Z,{prefix:(0,e.jsx)(nn.Z,{}),size:"large",placeholder:W,onChange:m}),(0,e.jsx)(Re.ZP,{size:"large",style:{overflow:"hidden",padding:0,width:112},children:(0,e.jsx)(tn.Z,{spinning:Y,size:"small",children:(0,e.jsx)("img",{src:j,onClick:N})})})]})},ve=an,rn=n(99702),on=n(62871),Le=n(64182),Be=n(73406),Ne=n(87547),De=n(94149),ln=n(71356),sn=n(84517),ge=n(5966),le=n(34994),un=n(97462),d=n(1413),se=n(74165),Ae=n(15861),he=n(45987),me=n(97685),cn=n(8232),Ee=n(90789),dn=["rules","name","phoneName","fieldProps","onTiming","captchaTextRender","captchaProps"],vn=i.forwardRef(function(a,r){var o=cn.Z.useFormInstance(),p=(0,i.useState)(a.countDown||60),x=(0,me.Z)(p,2),v=x[0],u=x[1],y=(0,i.useState)(!1),W=(0,me.Z)(y,2),F=W[0],D=W[1],C=(0,i.useState)(),w=(0,me.Z)(C,2),M=w[0],G=w[1],V=a.rules,Q=a.name,K=a.phoneName,Z=a.fieldProps,j=a.onTiming,E=a.captchaTextRender,U=E===void 0?function(P,h){return P?"".concat(h," \u79D2\u540E\u91CD\u65B0\u83B7\u53D6"):"\u83B7\u53D6\u9A8C\u8BC1\u7801"}:E,H=a.captchaProps,Y=(0,he.Z)(a,dn),A=function(){var P=(0,Ae.Z)((0,se.Z)().mark(function h(T){return(0,se.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.prev=0,G(!0),N.next=4,Y.onGetCaptcha(T);case 4:G(!1),D(!0),N.next=13;break;case 8:N.prev=8,N.t0=N.catch(0),D(!1),G(!1),console.log(N.t0);case 13:case"end":return N.stop()}},h,null,[[0,8]])}));return function(T){return P.apply(this,arguments)}}();return(0,i.useImperativeHandle)(r,function(){return{startTiming:function(){return D(!0)},endTiming:function(){return D(!1)}}}),(0,i.useEffect)(function(){var P=0,h=a.countDown;return F&&(P=window.setInterval(function(){u(function(T){return T<=1?(D(!1),clearInterval(P),h||60):T-1})},1e3)),function(){return clearInterval(P)}},[F]),(0,i.useEffect)(function(){j&&j(v)},[v,j]),(0,e.jsxs)("div",{style:(0,d.Z)((0,d.Z)({},Z==null?void 0:Z.style),{},{display:"flex",alignItems:"center"}),ref:r,children:[(0,e.jsx)(Fe.Z,(0,d.Z)((0,d.Z)({},Z),{},{style:(0,d.Z)({flex:1,transition:"width .3s",marginRight:8},Z==null?void 0:Z.style)})),(0,e.jsx)(Re.ZP,(0,d.Z)((0,d.Z)({style:{display:"block"},disabled:F,loading:M},H),{},{onClick:(0,Ae.Z)((0,se.Z)().mark(function P(){var h;return(0,se.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(m.prev=0,!K){m.next=9;break}return m.next=4,o.validateFields([K].flat(1));case 4:return h=o.getFieldValue([K].flat(1)),m.next=7,A(h);case 7:m.next=11;break;case 9:return m.next=11,A("");case 11:m.next=16;break;case 13:m.prev=13,m.t0=m.catch(0),console.log(m.t0);case 16:case"end":return m.stop()}},P,null,[[0,13]])})),children:U(F,v)}))]})}),gn=(0,Ee.G)(vn),hn=gn,mn=n(10915),fn=n(28459),pn=n(93967),Sn=n.n(pn),fe=n(4942),xn=n(98082),yn=function(r){return(0,fe.Z)((0,fe.Z)({},r.componentCls,{"&-container":{display:"flex",flex:"1",flexDirection:"column",height:"100%",paddingInline:32,paddingBlock:24,overflow:"auto",background:"inherit"},"&-top":{textAlign:"center"},"&-header":{display:"flex",alignItems:"center",justifyContent:"center",height:"44px",lineHeight:"44px",a:{textDecoration:"none"}},"&-title":{position:"relative",insetBlockStart:"2px",color:"@heading-color",fontWeight:"600",fontSize:"33px"},"&-logo":{width:"44px",height:"44px",marginInlineEnd:"16px",verticalAlign:"top",img:{width:"100%"}},"&-desc":{marginBlockStart:"12px",marginBlockEnd:"40px",color:r.colorTextSecondary,fontSize:r.fontSize},"&-main":{minWidth:"328px",maxWidth:"580px",margin:"0 auto","&-other":{marginBlockStart:"24px",lineHeight:"22px",textAlign:"start"}}}),"@media (min-width: @screen-md-min)",(0,fe.Z)({},"".concat(r.componentCls,"-container"),{paddingInline:0,paddingBlockStart:32,paddingBlockEnd:24,backgroundRepeat:"no-repeat",backgroundPosition:"center 110px",backgroundSize:"100%"}))};function Cn(a){return(0,xn.Xj)("LoginForm",function(r){var o=(0,d.Z)((0,d.Z)({},r),{},{componentCls:".".concat(a)});return[yn(o)]})}var Zn=["logo","message","contentStyle","title","subTitle","actions","children","containerStyle","otherStyle"];function jn(a){var r,o=a.logo,p=a.message,x=a.contentStyle,v=a.title,u=a.subTitle,y=a.actions,W=a.children,F=a.containerStyle,D=a.otherStyle,C=(0,he.Z)(a,Zn),w=(0,mn.YB)(),M=C.submitter===!1?!1:(0,d.Z)((0,d.Z)({searchConfig:{submitText:w.getMessage("loginForm.submitText","\u767B\u5F55")}},C.submitter),{},{submitButtonProps:(0,d.Z)({size:"large",style:{width:"100%"}},(r=C.submitter)===null||r===void 0?void 0:r.submitButtonProps),render:function(H,Y){var A,P=Y.pop();if(typeof(C==null||(A=C.submitter)===null||A===void 0?void 0:A.render)=="function"){var h,T;return C==null||(h=C.submitter)===null||h===void 0||(T=h.render)===null||T===void 0?void 0:T.call(h,H,Y)}return P}}),G=(0,i.useContext)(fn.ZP.ConfigContext),V=G.getPrefixCls("pro-form-login"),Q=Cn(V),K=Q.wrapSSR,Z=Q.hashId,j=function(H){return"".concat(V,"-").concat(H," ").concat(Z)},E=(0,i.useMemo)(function(){return o?typeof o=="string"?(0,e.jsx)("img",{src:o}):o:null},[o]);return K((0,e.jsxs)("div",{className:Sn()(j("container"),Z),style:F,children:[(0,e.jsxs)("div",{className:"".concat(j("top")," ").concat(Z).trim(),children:[v||E?(0,e.jsxs)("div",{className:"".concat(j("header")),children:[E?(0,e.jsx)("span",{className:j("logo"),children:E}):null,v?(0,e.jsx)("span",{className:j("title"),children:v}):null]}):null,u?(0,e.jsx)("div",{className:j("desc"),children:u}):null]}),(0,e.jsxs)("div",{className:j("main"),style:(0,d.Z)({width:328},x),children:[(0,e.jsxs)(le.A,(0,d.Z)((0,d.Z)({isKeyPressSubmit:!0},C),{},{submitter:M,children:[p,W]})),y?(0,e.jsx)("div",{className:j("main-other"),style:D,children:y}):null]})]}))}var ze=n(22270),Pn=n(84567),$e=n(56897),Tn=["options","fieldProps","proFieldProps","valueEnum"],In=i.forwardRef(function(a,r){var o=a.options,p=a.fieldProps,x=a.proFieldProps,v=a.valueEnum,u=(0,he.Z)(a,Tn);return(0,e.jsx)($e.Z,(0,d.Z)({ref:r,valueType:"checkbox",valueEnum:(0,ze.h)(v,void 0),fieldProps:(0,d.Z)({options:o},p),lightProps:(0,d.Z)({labelFormatter:function(){return(0,e.jsx)($e.Z,(0,d.Z)({ref:r,valueType:"checkbox",mode:"read",valueEnum:(0,ze.h)(v,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,d.Z)({options:o},p),proFieldProps:x},u))}},u.lightProps),proFieldProps:x},u))}),bn=i.forwardRef(function(a,r){var o=a.fieldProps,p=a.children;return(0,e.jsx)(Pn.Z,(0,d.Z)((0,d.Z)({ref:r},o),{},{children:p}))}),Fn=(0,Ee.G)(bn,{valuePropName:"checked"}),ke=Fn;ke.Group=In;var Rn=ke,ne=n(7837),Ln=n(26855),Bn=n(9361),Nn=n(85230),Dn=n(48096),Me=n(73935),pe=n(37233),An=n(38477),En=n(30644),f=n(15076),zn=n(73219),Ge=function(){var r,o=(0,i.useContext)(zn.r),p=o.setting,x=p==null||(r=p.adminSetting)===null||r===void 0?void 0:r.baseurl;return(0,An.kc)(function(v){var u=v.token,y=v.css;return{action:{marginLeft:"8px",color:u.colorPrimaryHover,fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"color 0.3s","&:hover":{color:u.colorPrimary}},lang:{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:u.borderRadius,":hover":{backgroundColor:u.colorBgTextHover}},container:{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto",backgroundImage:x?"url('".concat(x,"/login_bg.png')"):"",backgroundSize:"100% 100%"}}})()},$n=function(){var r=Ge(),o=r.styles;return(0,e.jsx)("div",{className:o.lang,"data-lang":!0,children:(0,e.jsx)(En.pD,{})})},kn=function(){return(0,e.jsx)(Le.ZP,{children:(0,e.jsx)(Mn,{})})},Mn=function(){var r,o,p,x,v,u,y,W=(0,ne.useModel)("@@initialState"),F=W.initialState,D=W.setInitialState,C=(0,i.useState)(0),w=b()(C,2),M=w[0],G=w[1],V=(0,i.useState)(0),Q=b()(V,2),K=Q[0],Z=Q[1],j=(0,i.useState)(!1),E=b()(j,2),U=E[0],H=E[1],Y=(0,i.useState)(!1),A=b()(Y,2),P=A[0],h=A[1],T=(0,ne.useSearchParams)(),m=b()(T,1),N=m[0],q=de.ZP.useMessage(),z=b()(q,2),R=z[0],He=z[1],I=Ln.ZP.useNotification(),We=b()(I,2),Hn=We[0],Wn=We[1],Se=(0,i.useContext)(Le.DN),wn=Se.clientId,xe=Se.messageData,ye=Se.bind,Kn=(0,i.useState)(),we=b()(Kn,2),t=we[0],Un=we[1],On=Ge(),Ce=On.styles,Vn=(0,i.useState)(),Ke=b()(Vn,2),te=Ke[0],Ue=Ke[1];(0,i.useEffect)(function(){(0,Be.Zl)().then(function(s){var l;Un(s),Ue(s==null||(l=s.adminSetting)===null||l===void 0?void 0:l.loginTypeDefault)})},[]);var Oe=function(l){ye==null||ye();var $=(0,Be.Y0)(l.setting);D(function(L){return J()(J()({},L),{},{currentUser:l.userinfo,settings:$})}).then(function(){var L,g="/",k="/";if(l.userinfo.redirect)k=l.userinfo.redirect;else if(F!=null&&(L=F.settings)!==null&&L!==void 0&&(L=L.adminSetting)!==null&&L!==void 0&&L.baseurl){var c;k=g.replace(F==null||(c=F.settings)===null||c===void 0||(c=c.adminSetting)===null||c===void 0?void 0:c.baseurl,"/")}ne.history.push(k)})};(0,i.useEffect)(function(){if(xe){var s=xe.data;(s==null?void 0:s.action)=="login"&&(pe.Z.set("Sa-Remember",1),(0,ee.MU)(s.access_token).then(function(){R.success({content:s.msg,duration:1,onClose:function(){(0,Me.flushSync)(function(){Oe(s)})}})}))}},[xe]);var Qn=function(){var s=oe()(O()().mark(function l($){return O()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,ee.ZP.post("login",{data:J()(J()({},$),{},{loginType:te}),duration:1,then:function(c){var _=c.code,X=c.msg,ae=c.data;c.code?(Hn.error({description:X,message:"\u63D0\u793A"}),te=="phone"&&c.code==3&&Z(M+1),U&&G(M+1),(c.code==3||c.code==2)&&H(!0)):($.autoLogin?pe.Z.set("Sa-Remember",1):pe.Z.set("Sa-Remember",0),(0,ee.MU)(c.data.access_token).then(function(){R.success({content:X,duration:1,onClose:function(){(0,Me.flushSync)(function(){Oe(c.data)})}})}))}});case 2:return g.abrupt("return");case 3:case"end":return g.stop()}},l)}));return function($){return s.apply(this,arguments)}}(),Ve=(0,i.useRef)(),S=(0,ne.useIntl)(),Yn=[{label:(0,f.t)("pages.login.phoneLogin.tab",S),key:"phone",children:te!="phone"?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ge.Z,{name:"mobile",fieldProps:{size:"large",prefix:(0,e.jsx)(Ne.Z,{})},placeholder:(0,f.t)("pages.login.phoneNumber.placeholder",S),rules:[{required:!0,message:(0,f.t)("pages.login.phoneNumber.required",S)},{pattern:/^1\d{10}$/,message:(0,f.t)("pages.login.phoneNumber.invalid",S)}]}),(0,e.jsx)(le.A.Item,{name:"captchaPhone",rules:[{required:!0,message:(0,f.t)("pages.login.captcha.required",S)}],children:(0,e.jsx)(ve,{reload:K,placeholder:(0,f.t)("pages.login.captcha.placeholder",S)})}),(0,e.jsx)(un.Z,{name:["captchaPhone"],children:function(l){var $=l.captchaPhone;return(0,e.jsx)(hn,{fieldProps:{size:"large",prefix:(0,e.jsx)(De.Z,{})},countDown:60,captchaProps:{size:"large"},phoneName:"mobile",placeholder:(0,f.t)("pages.login.captcha.placeholder",S),captchaTextRender:function(g,k){return g?"".concat(k," ").concat((0,f.t)("pages.login.phoneLogin.getVerificationCode",S)):(0,f.t)("pages.login.phoneLogin.getVerificationCode",S)},name:"mobilecode",rules:[{required:!0,message:(0,f.t)("pages.login.captcha.required",S)}],onGetCaptcha:function(){var L=oe()(O()().mark(function g(k){var c,_,X,ae;return O()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.prev=0,B.next=3,(c=Ve.current)===null||c===void 0?void 0:c.validateFields(["captcha"]);case 3:B.next=8;break;case 5:throw B.prev=5,B.t0=B.catch(0),new Error("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25");case 8:return B.next=10,ee.ZP.post("sms",{data:{mobile:k,captcha:$}});case 10:if(_=B.sent,X=_.code,ae=_.msg,!X){B.next=15;break}throw new Error(ae);case 15:case"end":return B.stop()}},g,null,[[0,5]])}));return function(g){return L.apply(this,arguments)}}()})}}),U&&(0,e.jsx)(le.A.Item,{name:"captcha",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"}],children:(0,e.jsx)(ve,{reload:M})})]})},{label:(0,f.t)("pages.login.accountLogin.tab",S),key:"password",children:te!="password"?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ge.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(Ne.Z,{})},placeholder:(0,f.t)("pages.login.username.placeholder",S),rules:[{required:!0,message:(0,f.t)("pages.login.username.required",S)}]}),(0,e.jsx)(ge.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(De.Z,{}),autoComplete:""},placeholder:(0,f.t)("pages.login.password.placeholder",S),rules:[{required:!0,message:(0,f.t)("pages.login.password.required",S)}]}),U&&(0,e.jsx)(le.A.Item,{name:"captcha",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"}],children:(0,e.jsx)(ve,{reload:M})})]})}],Xn=Bn.Z.useToken(),Jn=Xn.token,Ze={};if((t==null?void 0:t.navTheme)=="light"){var je;if(t!=null&&(je=t.adminSetting)!==null&&je!==void 0&&je.loginBgImgage){var Pe;Ze.backgroundImage='url("'+(t==null||(Pe=t.adminSetting)===null||Pe===void 0?void 0:Pe.loginBgImgage)+'")'}}else Ze.background=Jn.colorBgBase;var qn=function(l){var $=l.type,L=(0,i.useState)(0),g=b()(L,2),k=g[0],c=g[1],_=(0,i.useState)("active"),X=b()(_,2),ae=X[0],ue=X[1],B=3*60,ce,Qe=function re(ie){var tt=Date.now();tt>ie+B*1e3?ue("expired"):ce=setTimeout(function(){return re(ie)},1e3)},_n=function(){var ie=Date.now();c(ie),ue("active"),ce=setTimeout(function(){return Qe(ie)},1e3)};if((0,i.useEffect)(function(){var re=Date.now();return c(re),ce=setTimeout(function(){return Qe(re)},1e3),function(){return clearTimeout(ce)}},[]),$=="wechat"){var Te,Ye=t==null||(Te=t.adminSetting)===null||Te===void 0?void 0:Te.loginWechat,et=Ye.url,nt=Ye.desc,Xe=et+"?client_id="+wn+"&timestamp="+k;return console.log("qrcodeUrl",Xe),(0,e.jsxs)("div",{style:{textAlign:"center"},children:[k?(0,e.jsx)(Nn.Z,{style:{margin:"0 auto"},value:Xe,status:ae,onRefresh:_n}):null,(0,e.jsx)("div",{style:{marginTop:20},children:nt})]})}return null};return t?(0,e.jsxs)("div",{className:Ce.container,style:J()({},Ze),children:[(0,e.jsx)(ne.Helmet,{children:(0,e.jsxs)("title",{children:["\u767B\u5F55 - ",t==null?void 0:t.title]})}),He,Wn,t!=null&&(r=t.adminSetting)!==null&&r!==void 0&&r.lang?(0,e.jsx)($n,{}):null,(0,e.jsx)("div",{style:{flex:"1",padding:"48px 0"},children:(0,e.jsx)(sn.ZP,{style:{margin:"0px auto",background:t==null||(o=t.adminSetting)===null||o===void 0?void 0:o.loginBgCardColor,width:376},bodyStyle:{paddingTop:0,paddingBottom:0},className:Ce.card,children:(0,e.jsxs)(jn,{contentStyle:{minWidth:280,maxWidth:"75vw"},containerStyle:{paddingInline:0},formRef:Ve,logo:t==null?void 0:t.logo,title:t==null?void 0:t.title,subTitle:t!=null&&(p=t.adminSetting)!==null&&p!==void 0&&p.subtitle?(0,e.jsx)("span",{dangerouslySetInnerHTML:{__html:t==null||(x=t.adminSetting)===null||x===void 0?void 0:x.subtitle}}):null,initialValues:{autoLogin:!0},onFinish:function(){var s=oe()(O()().mark(function l($){return O()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,Qn($);case 2:case"end":return g.stop()}},l)}));return function(l){return s.apply(this,arguments)}}(),actions:t!=null&&(v=t.adminSetting)!==null&&v!==void 0&&v.loginActions?(0,e.jsxs)(be.Z,{children:[(0,f.t)("pages.login.loginWith",S),(0,e.jsx)(on.Z,{trigger:(0,e.jsx)(ln.Z,{className:Ce.action}),width:350,title:"\u626B\u7801\u767B\u5F55",children:t==null||(u=t.adminSetting)===null||u===void 0||(u=u.loginActions)===null||u===void 0?void 0:u.map(function(s,l){return(0,e.jsx)(qn,{type:s},l)})})]}):null,children:[(0,e.jsx)(Dn.Z,{centered:!0,activeKey:te,onChange:function(l){Ue(l),h(l=="phone")},items:(y=t.adminSetting)===null||y===void 0||(y=y.loginType)===null||y===void 0?void 0:y.map(function(s){return Yn.find(function(l){return l.key==s})})}),(0,e.jsxs)("div",{style:{marginBottom:24},children:[(0,e.jsx)(Rn,{noStyle:!0,name:"autoLogin",children:(0,f.t)("pages.login.rememberMe",S)}),(0,e.jsx)("a",{style:{float:"right"},onClick:function(){R.info("\u8BF7\u4F7F\u7528\u624B\u673A\u53F7\u767B\u5F55\u540E\u4FEE\u6539,\u6216\u8054\u7CFB\u540E\u53F0\u7BA1\u7406\u5458\u4FEE\u6539\u8D26\u53F7\u5BC6\u7801\uFF01")},children:(0,f.t)("pages.login.forgotPassword",S)})]})]})})}),(0,e.jsx)(rn.Z,{})]}):null},Gn=kn}}]);
