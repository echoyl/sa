"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[939],{92594:function(wt,Ce,t){t.r(Ce),t.d(Ce,{default:function(){return Bt}});var We=t(15009),H=t.n(We),He=t(99289),ie=t.n(He),Ke=t(97857),k=t.n(Ke),Ue=t(5574),Z=t.n(Ue),Oe=t(56034),ve=t(45360),Ze=t(42075),je=t(55102),Pe=t(14726),Qe=t(75081),a=t(67294),q=t(33067),e=t(85893),Ve=function(i){var l=i.value,T=l===void 0?{}:l,g=i.onChange,j=i.reload,B=j===void 0?0:j,D=i.placeholder,R=D===void 0?"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801":D,N=(0,a.useState)(""),A=Z()(N,2),m=A[0],K=A[1],X=(0,a.useState)(""),L=Z()(X,2),G=L[0],w=L[1],W=(0,a.useState)(""),S=Z()(W,2),p=S[0],E=S[1],Y=(0,a.useState)(!1),$=Z()(Y,2),U=$[0],z=$[1],x=function(){var O=ie()(H()().mark(function M(){var I;return H()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.prev=0,y.next=3,(0,q.xx)({key:G});case 3:if(I=y.sent,I.code!==0){y.next=6;break}return y.abrupt("return",I.data);case 6:y.next=12;break;case 8:return y.prev=8,y.t0=y.catch(0),ve.ZP.error("\u83B7\u53D6\u90E8\u95E8\u6811\u5931\u8D25,\u8BF7\u91CD\u8BD5"),y.abrupt("return",[]);case 12:return ve.ZP.error("\u83B7\u53D6\u90E8\u95E8\u6811\u5931\u8D25,\u8BF7\u91CD\u8BD5"),y.abrupt("return",[]);case 14:case"end":return y.stop()}},M,null,[[0,8]])}));return function(){return O.apply(this,arguments)}}(),d=function(M){g&&g(k()(k()({captchaCode:m,captchaKey:G},T),M))},f=function(M){z(!0),x().then(function(I){z(!1),w(I.key),E(I.img),M&&d({captchaKey:I.key})})};(0,a.useEffect)(function(){f(!1)},[]),(0,a.useEffect)(function(){B>0&&f(!0)},[B]);var v=function(M){var I=M.target.value||"";I&&K(I),d({captchaCode:I})},P=function(){f(!0)};return(0,e.jsxs)(Ze.Z,{children:[(0,e.jsx)(je.Z,{prefix:(0,e.jsx)(Oe.Z,{}),size:"large",placeholder:R,onChange:v}),(0,e.jsx)(Pe.ZP,{size:"large",style:{overflow:"hidden",padding:0,width:112},children:(0,e.jsx)(Qe.Z,{spinning:U,size:"small",children:(0,e.jsx)("img",{src:p,onClick:P})})})]})},fe=Ve,Xe=t(99702),Ye=t(62871),Je=t(64182),qe=t(74700),Fe=t(87547),Te=t(94149),_e=t(71356),et=t(84517),he=t(5966),oe=t(34994),tt=t(97462),s=t(1413),se=t(74165),Be=t(15861),ge=t(45987),me=t(97685),nt=t(8232),Ie=t(90789),at=["rules","name","phoneName","fieldProps","onTiming","captchaTextRender","captchaProps"],rt=a.forwardRef(function(n,i){var l=nt.Z.useFormInstance(),T=(0,a.useState)(n.countDown||60),g=(0,me.Z)(T,2),j=g[0],B=g[1],D=(0,a.useState)(!1),R=(0,me.Z)(D,2),N=R[0],A=R[1],m=(0,a.useState)(),K=(0,me.Z)(m,2),X=K[0],L=K[1],G=n.rules,w=n.name,W=n.phoneName,S=n.fieldProps,p=n.onTiming,E=n.captchaTextRender,Y=E===void 0?function(x,d){return x?"".concat(d," \u79D2\u540E\u91CD\u65B0\u83B7\u53D6"):"\u83B7\u53D6\u9A8C\u8BC1\u7801"}:E,$=n.captchaProps,U=(0,ge.Z)(n,at),z=function(){var x=(0,Be.Z)((0,se.Z)().mark(function d(f){return(0,se.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,L(!0),P.next=4,U.onGetCaptcha(f);case 4:L(!1),A(!0),P.next=13;break;case 8:P.prev=8,P.t0=P.catch(0),A(!1),L(!1),console.log(P.t0);case 13:case"end":return P.stop()}},d,null,[[0,8]])}));return function(f){return x.apply(this,arguments)}}();return(0,a.useImperativeHandle)(i,function(){return{startTiming:function(){return A(!0)},endTiming:function(){return A(!1)}}}),(0,a.useEffect)(function(){var x=0,d=n.countDown;return N&&(x=window.setInterval(function(){B(function(f){return f<=1?(A(!1),clearInterval(x),d||60):f-1})},1e3)),function(){return clearInterval(x)}},[N]),(0,a.useEffect)(function(){p&&p(j)},[j,p]),(0,e.jsxs)("div",{style:(0,s.Z)((0,s.Z)({},S==null?void 0:S.style),{},{display:"flex",alignItems:"center"}),ref:i,children:[(0,e.jsx)(je.Z,(0,s.Z)((0,s.Z)({},S),{},{style:(0,s.Z)({flex:1,transition:"width .3s",marginRight:8},S==null?void 0:S.style)})),(0,e.jsx)(Pe.ZP,(0,s.Z)((0,s.Z)({style:{display:"block"},disabled:N,loading:X},$),{},{onClick:(0,Be.Z)((0,se.Z)().mark(function x(){var d;return(0,se.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,!W){v.next=9;break}return v.next=4,l.validateFields([W].flat(1));case 4:return d=l.getFieldValue([W].flat(1)),v.next=7,z(d);case 7:v.next=11;break;case 9:return v.next=11,z("");case 11:v.next=16;break;case 13:v.prev=13,v.t0=v.catch(0),console.log(v.t0);case 16:case"end":return v.stop()}},x,null,[[0,13]])})),children:Y(N,j)}))]})}),it=(0,Ie.G)(rt),ot=it,Ae=t(98082),st=t(10915),lt=t(28459),ut=t(93967),ct=t.n(ut),pe=t(4942),dt=function(i){return(0,pe.Z)((0,pe.Z)({},i.componentCls,{"&-container":{display:"flex",flex:"1",flexDirection:"column",height:"100%",paddingInline:32,paddingBlock:24,overflow:"auto",background:"inherit"},"&-top":{textAlign:"center"},"&-header":{display:"flex",alignItems:"center",justifyContent:"center",height:"44px",lineHeight:"44px",a:{textDecoration:"none"}},"&-title":{position:"relative",insetBlockStart:"2px",color:"@heading-color",fontWeight:"600",fontSize:"33px"},"&-logo":{width:"44px",height:"44px",marginInlineEnd:"16px",verticalAlign:"top",img:{width:"100%"}},"&-desc":{marginBlockStart:"12px",marginBlockEnd:"40px",color:i.colorTextSecondary,fontSize:i.fontSize},"&-main":{minWidth:"328px",maxWidth:"580px",margin:"0 auto","&-other":{marginBlockStart:"24px",lineHeight:"22px",textAlign:"start"}}}),"@media (min-width: @screen-md-min)",(0,pe.Z)({},"".concat(i.componentCls,"-container"),{paddingInline:0,paddingBlockStart:32,paddingBlockEnd:24,backgroundRepeat:"no-repeat",backgroundPosition:"center 110px",backgroundSize:"100%"}))};function vt(n){return(0,Ae.Xj)("LoginForm",function(i){var l=(0,s.Z)((0,s.Z)({},i),{},{componentCls:".".concat(n)});return[dt(l)]})}var ft=["logo","message","contentStyle","title","subTitle","actions","children","containerStyle","otherStyle"];function ht(n){var i,l=n.logo,T=n.message,g=n.contentStyle,j=n.title,B=n.subTitle,D=n.actions,R=n.children,N=n.containerStyle,A=n.otherStyle,m=(0,ge.Z)(n,ft),K=(0,st.YB)(),X=m.submitter===!1?!1:(0,s.Z)((0,s.Z)({searchConfig:{submitText:K.getMessage("loginForm.submitText","\u767B\u5F55")}},m.submitter),{},{submitButtonProps:(0,s.Z)({size:"large",style:{width:"100%"}},(i=m.submitter)===null||i===void 0?void 0:i.submitButtonProps),render:function($,U){var z,x=U.pop();if(typeof(m==null||(z=m.submitter)===null||z===void 0?void 0:z.render)=="function"){var d,f;return m==null||(d=m.submitter)===null||d===void 0||(f=d.render)===null||f===void 0?void 0:f.call(d,$,U)}return x}}),L=(0,a.useContext)(lt.ZP.ConfigContext),G=L.getPrefixCls("pro-form-login"),w=vt(G),W=w.wrapSSR,S=w.hashId,p=function($){return"".concat(G,"-").concat($," ").concat(S)},E=(0,a.useMemo)(function(){return l?typeof l=="string"?(0,e.jsx)("img",{src:l}):l:null},[l]);return W((0,e.jsxs)("div",{className:ct()(p("container"),S),style:N,children:[(0,e.jsxs)("div",{className:"".concat(p("top")," ").concat(S).trim(),children:[j||E?(0,e.jsxs)("div",{className:"".concat(p("header")),children:[E?(0,e.jsx)("span",{className:p("logo"),children:E}):null,j?(0,e.jsx)("span",{className:p("title"),children:j}):null]}):null,B?(0,e.jsx)("div",{className:p("desc"),children:B}):null]}),(0,e.jsxs)("div",{className:p("main"),style:(0,s.Z)({width:328},g),children:[(0,e.jsxs)(oe.A,(0,s.Z)((0,s.Z)({isKeyPressSubmit:!0},m),{},{submitter:X,children:[T,R]})),D?(0,e.jsx)("div",{className:p("main-other"),style:A,children:D}):null]})]}))}var De=t(22270),gt=t(84567),Re=t(20677),mt=["options","fieldProps","proFieldProps","valueEnum"],pt=a.forwardRef(function(n,i){var l=n.options,T=n.fieldProps,g=n.proFieldProps,j=n.valueEnum,B=(0,ge.Z)(n,mt);return(0,e.jsx)(Re.Z,(0,s.Z)({ref:i,valueType:"checkbox",valueEnum:(0,De.h)(j,void 0),fieldProps:(0,s.Z)({options:l},T),lightProps:(0,s.Z)({labelFormatter:function(){return(0,e.jsx)(Re.Z,(0,s.Z)({ref:i,valueType:"checkbox",mode:"read",valueEnum:(0,De.h)(j,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,s.Z)({options:l},T),proFieldProps:g},B))}},B.lightProps),proFieldProps:g},B))}),xt=a.forwardRef(function(n,i){var l=n.fieldProps,T=n.children;return(0,e.jsx)(gt.Z,(0,s.Z)((0,s.Z)({ref:i},l),{},{children:T}))}),St=(0,Ie.G)(xt,{valuePropName:"checked"}),be=St;be.Group=pt;var yt=be,le=t(7837),Ct=t(26855),Zt=t(9361),jt=t(10397),Pt=t(48096),Ne=t(73935),_={container:"container___ldtvs",lang:"lang___qrAB8",content:"content___wB3e_","ant-pro-form-login-container":"ant-pro-form-login-container___Z1bnX",icon:"icon___CBYA8"},xe=t(37233),Ft=function(){return(0,e.jsx)(Tt,{})},Tt=function(){var i,l,T=(0,le.useModel)("@@initialState"),g=T.initialState,j=T.setInitialState,B=(0,a.useState)(0),D=Z()(B,2),R=D[0],N=D[1],A=(0,a.useState)(0),m=Z()(A,2),K=m[0],X=m[1],L=(0,a.useState)(!1),G=Z()(L,2),w=G[0],W=G[1],S=(0,a.useState)(!1),p=Z()(S,2),E=p[0],Y=p[1],$=(0,le.useSearchParams)(),U=Z()($,1),z=U[0],x=ve.ZP.useMessage(),d=Z()(x,2),f=d[0],v=d[1],P=Ct.ZP.useNotification(),O=Z()(P,2),M=O[0],I=O[1],ee=(0,a.useContext)(Je.DN),y=ee.clientId,Se=ee.messageData,ye=ee.bind,Wt=ee.setMessageData,It=(0,a.useState)(),Le=Z()(It,2),r=Le[0],At=Le[1],Dt=(0,a.useState)(),Ee=Z()(Dt,2),te=Ee[0],$e=Ee[1];(0,a.useEffect)(function(){(0,qe.A)().then(function(o){At(o),$e(o==null?void 0:o.loginTypeDefault)})},[]);var ze=function(u){ye==null||ye(),j(function(h){return k()(k()({},h),{},{currentUser:u.userinfo,settings:k()(k()({},h==null?void 0:h.settings),u.setting)})}).then(function(){var h,Q="/",c="/";if(u.userinfo.redirect)c=u.userinfo.redirect;else if(g!=null&&(h=g.settings)!==null&&h!==void 0&&h.baseurl){var b;c=Q.replace(g==null||(b=g.settings)===null||b===void 0?void 0:b.baseurl,"/")}le.history.push(c)})};(0,a.useEffect)(function(){if(Se){var o=Se.data;(o==null?void 0:o.action)=="login"&&(xe.Z.set("Sa-Remember",1),(0,q.MU)(o.access_token).then(function(){f.success({content:o.msg,duration:1,onClose:function(){(0,Ne.flushSync)(function(){ze(o)})}})}))}},[Se]);var Rt=function(){var o=ie()(H()().mark(function u(h){return H()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,q.ZP.post("login",{data:k()(k()({},h),{},{loginType:te}),duration:1,then:function(C){var J=C.code,V=C.msg,ne=C.data;C.code?(M.error({description:V,message:"\u63D0\u793A"}),te=="phone"&&C.code==3&&X(R+1),w&&N(R+1),(C.code==3||C.code==2)&&W(!0)):(h.autoLogin?xe.Z.set("Sa-Remember",1):xe.Z.set("Sa-Remember",0),(0,q.MU)(C.data.access_token).then(function(){f.success({content:V,duration:1,onClose:function(){(0,Ne.flushSync)(function(){ze(C.data)})}})}))}});case 2:return c.abrupt("return");case 3:case"end":return c.stop()}},u)}));return function(h){return o.apply(this,arguments)}}(),ue={};r!=null&&r.loginBgImgage&&(ue.backgroundImage='url("'+r.loginBgImgage+'")');var Me=(0,a.useRef)(),bt=[{label:"\u624B\u673A\u53F7\u767B\u5F55",key:"phone",children:te!="phone"?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he.Z,{name:"mobile",fieldProps:{size:"large",prefix:(0,e.jsx)(Fe.Z,{className:_.prefixIcon})},placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"},{pattern:/^1\d{10}$/,message:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"}]}),(0,e.jsx)(oe.A.Item,{name:"captchaPhone",rules:[{required:!0,message:"\u83B7\u53D6\u624B\u673A\u9A8C\u8BC1\u7801\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"}],children:(0,e.jsx)(fe,{reload:K,placeholder:"\u83B7\u53D6\u624B\u673A\u9A8C\u8BC1\u7801\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"})}),(0,e.jsx)(tt.Z,{name:["captchaPhone"],children:function(u){var h=u.captchaPhone;return(0,e.jsx)(ot,{fieldProps:{size:"large",prefix:(0,e.jsx)(Te.Z,{})},countDown:60,captchaProps:{size:"large"},phoneName:"mobile",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",captchaTextRender:function(c,b){return c?"".concat(b," \u83B7\u53D6\u9A8C\u8BC1\u7801"):"\u83B7\u53D6\u9A8C\u8BC1\u7801"},name:"mobilecode",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"}],onGetCaptcha:function(){var Q=ie()(H()().mark(function c(b){var C,J,V,ne;return H()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.prev=0,F.next=3,(C=Me.current)===null||C===void 0?void 0:C.validateFields(["captcha"]);case 3:F.next=8;break;case 5:throw F.prev=5,F.t0=F.catch(0),new Error("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25");case 8:return F.next=10,q.ZP.post("sms",{data:{mobile:b,captcha:h}});case 10:if(J=F.sent,V=J.code,ne=J.msg,!V){F.next=15;break}throw new Error(ne);case 15:case"end":return F.stop()}},c,null,[[0,5]])}));return function(c){return Q.apply(this,arguments)}}()})}}),w&&(0,e.jsx)(oe.A.Item,{name:"captcha",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"}],children:(0,e.jsx)(fe,{reload:R})})]})},{label:"\u8D26\u53F7\u5BC6\u7801\u767B\u5F55",key:"password",children:te!="password"?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(Fe.Z,{className:_.prefixIcon})},placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"}]}),(0,e.jsx)(he.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(Te.Z,{className:_.prefixIcon})},placeholder:"\u8BF7\u8F93\u5165\u767B\u5F55\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"}]}),w&&(0,e.jsx)(oe.A.Item,{name:"captcha",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801"}],children:(0,e.jsx)(fe,{reload:R})})]})}],Nt=Zt.Z.useToken(),Lt=Nt.token,Et={marginInlineStart:"16px",color:(0,Ae.uK)(Lt.colorTextBase,.2),fontSize:"24px",verticalAlign:"middle",cursor:"pointer"},$t=function(u){var h=u.type,Q=(0,a.useState)(0),c=Z()(Q,2),b=c[0],C=c[1],J=(0,a.useState)("active"),V=Z()(J,2),ne=V[0],ce=V[1],F=3*60,de,ke=function ae(re){var Gt=Date.now();Gt>re+F*1e3?ce("expired"):de=setTimeout(function(){return ae(re)},1e3)},zt=function(){var re=Date.now();C(re),ce("active"),de=setTimeout(function(){return ke(re)},1e3)};if((0,a.useEffect)(function(){var ae=Date.now();return C(ae),de=setTimeout(function(){return ke(ae)},1e3),function(){return clearTimeout(de)}},[]),h=="wechat"){var Ge=r==null?void 0:r.loginWechat,Mt=Ge.url,kt=Ge.desc,we=Mt+"?client_id="+y+"&timestamp="+b;return console.log("qrcodeUrl",we),(0,e.jsxs)("div",{style:{textAlign:"center"},children:[b?(0,e.jsx)(jt.Z,{style:{margin:"0 auto"},value:we,status:ne,onRefresh:zt}):null,(0,e.jsx)("div",{style:{marginTop:20},children:kt})]})}return null};return r?(0,e.jsxs)("div",{className:_.container,style:k()({},ue),children:[(0,e.jsx)(le.Helmet,{children:(0,e.jsxs)("title",{children:["\u767B\u5F55 - ",r==null?void 0:r.title]})}),v,I,(0,e.jsx)("div",{className:_.content,style:ue.backgroundImage?{}:{padding:0},children:(0,e.jsx)(et.ZP,{style:{margin:"0px auto",padding:"20px 0",background:ue.backgroundImage?"#fff":"none"},children:(0,e.jsxs)(ht,{contentStyle:{minWidth:280,maxWidth:"75vw"},containerStyle:{paddingInline:0},formRef:Me,logo:r==null?void 0:r.logo,title:r==null?void 0:r.title,subTitle:r!=null&&r.subtitle?(0,e.jsx)("span",{dangerouslySetInnerHTML:{__html:r==null?void 0:r.subtitle}}):null,initialValues:{autoLogin:!0},onFinish:function(){var o=ie()(H()().mark(function u(h){return H()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Rt(h);case 2:case"end":return c.stop()}},u)}));return function(u){return o.apply(this,arguments)}}(),actions:r!=null&&r.loginActions?(0,e.jsxs)(Ze.Z,{children:["\u5176\u4ED6\u767B\u5F55\u65B9\u5F0F",(0,e.jsx)(Ye.Z,{trigger:(0,e.jsx)(_e.Z,{style:Et}),width:350,title:"\u626B\u7801\u767B\u5F55",children:r==null||(i=r.loginActions)===null||i===void 0?void 0:i.map(function(o,u){return(0,e.jsx)($t,{type:o},u)})})]}):null,children:[(0,e.jsx)(Pt.Z,{centered:!0,activeKey:te,onChange:function(u){$e(u),Y(u=="phone")},items:(l=r.loginType)===null||l===void 0?void 0:l.map(function(o){return bt.find(function(u){return u.key==o})})}),E?null:(0,e.jsxs)("div",{style:{marginBottom:24},children:[(0,e.jsx)(yt,{noStyle:!0,name:"autoLogin",children:"\u81EA\u52A8\u767B\u5F55"}),(0,e.jsx)("a",{style:{float:"right"},onClick:function(){f.info("\u8BF7\u4F7F\u7528\u624B\u673A\u53F7\u767B\u5F55\u540E\u4FEE\u6539,\u6216\u8054\u7CFB\u540E\u53F0\u7BA1\u7406\u5458\u4FEE\u6539\u8D26\u53F7\u5BC6\u7801\uFF01")},children:"\u5FD8\u8BB0\u5BC6\u7801"})]})]})})}),(0,e.jsx)(Xe.Z,{})]}):null},Bt=Ft}}]);
