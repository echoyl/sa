(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[487],{81550:function(Hi){(function(Be,xe){Hi.exports=xe()})(this,function(){"use strict";var Be=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},xe=function(e,t){for(var s=Object.keys(t),y=0;y<s.length;++y)e[s[y]]=t[s[y]];return e},ur=`
`;function Xi(e){return typeof atob!="undefined"?atob(e):"base64:"+e}function Ze(e){var t=new Error("(regl) "+e);throw console.error(t),t}function Ee(e,t){e||Ze(t)}function sr(e){return e?": "+e:""}function $i(e,t,s){e in t||Ze("unknown parameter ("+e+")"+sr(s)+". possible values: "+Object.keys(t).join())}function Wi(e,t){Be(e)||Ze("invalid parameter type"+sr(t)+". must be a typed array")}function Gn(e,t){switch(t){case"number":return typeof e=="number";case"object":return typeof e=="object";case"string":return typeof e=="string";case"boolean":return typeof e=="boolean";case"function":return typeof e=="function";case"undefined":return typeof e=="undefined";case"symbol":return typeof e=="symbol"}}function Yi(e,t,s){Gn(e,t)||Ze("invalid parameter type"+sr(s)+". expected "+t+", got "+typeof e)}function Qi(e,t){e>=0&&(e|0)===e||Ze("invalid parameter type, ("+e+")"+sr(t)+". must be a nonnegative integer")}function Nt(e,t,s){t.indexOf(e)<0&&Ze("invalid value"+sr(s)+". must be one of: "+t)}var Cn=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function qi(e){Object.keys(e).forEach(function(t){Cn.indexOf(t)<0&&Ze('invalid regl constructor argument "'+t+'". must be one of '+Cn)})}function xr(e,t){for(e=e+"";e.length<t;)e=" "+e;return e}function Bt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Fn(e,t){this.number=e,this.line=t,this.errors=[]}function Dn(e,t,s){this.file=e,this.line=t,this.message=s}function cr(){var e=new Error,t=(e.stack||e).toString(),s=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(s)return s[1];var y=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return y?y[1]:"unknown"}function Nn(){var e=new Error,t=(e.stack||e).toString(),s=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(s)return s[1];var y=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return y?y[1]:"unknown"}function It(e,t){var s=e.split(`
`),y=1,L=0,E={unknown:new Bt,0:new Bt};E.unknown.name=E[0].name=t||cr(),E.unknown.lines.push(new Fn(0,""));for(var S=0;S<s.length;++S){var N=s[S],I=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(N);if(I)switch(I[1]){case"line":var z=/(\d+)(\s+\d+)?/.exec(I[2]);z&&(y=z[1]|0,z[2]&&(L=z[2]|0,L in E||(E[L]=new Bt)));break;case"define":var M=/SHADER_NAME(_B64)?\s+(.*)$/.exec(I[2]);M&&(E[L].name=M[1]?Xi(M[2]):M[2]);break}E[L].lines.push(new Fn(y++,N))}return Object.keys(E).forEach(function(U){var j=E[U];j.lines.forEach(function(F){j.index[F.number]=F})}),E}function Ki(e){var t=[];return e.split(`
`).forEach(function(s){if(!(s.length<5)){var y=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(s);y?t.push(new Dn(y[1]|0,y[2]|0,y[3].trim())):s.length>0&&t.push(new Dn("unknown",0,s))}}),t}function Zi(e,t){t.forEach(function(s){var y=e[s.file];if(y){var L=y.index[s.line];if(L){L.errors.push(s),y.hasErrors=!0;return}}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(s)})}function Ji(e,t,s,y,L){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var E=e.getShaderInfoLog(t),S=y===e.FRAGMENT_SHADER?"fragment":"vertex";In(s,"string",S+" shader source must be a string",L);var N=It(s,L),I=Ki(E);Zi(N,I),Object.keys(N).forEach(function(z){var M=N[z];if(!M.hasErrors)return;var U=[""],j=[""];function F(V,v){U.push(V),j.push(v||"")}F("file number "+z+": "+M.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),M.lines.forEach(function(V){if(V.errors.length>0){F(xr(V.number,4)+"|  ","background-color:yellow; font-weight:bold"),F(V.line+ur,"color:red; background-color:yellow; font-weight:bold");var v=0;V.errors.forEach(function(A){var B=A.message,X=/^\s*'(.*)'\s*:\s*(.*)$/.exec(B);if(X){var O=X[1];switch(B=X[2],O){case"assign":O="=";break}v=Math.max(V.line.indexOf(O,v),0)}else v=0;F(xr("| ",6)),F(xr("^^^",v+3)+ur,"font-weight:bold"),F(xr("| ",6)),F(B+ur,"font-weight:bold")}),F(xr("| ",6)+ur)}else F(xr(V.number,4)+"|  "),F(V.line+ur,"color:red")}),typeof document!="undefined"&&!window.chrome?(j[0]=U.join("%c"),console.log.apply(console,j)):console.log(U.join(""))}),Ee.raise("Error compiling "+S+" shader, "+N[0].name)}}function ef(e,t,s,y,L){if(!e.getProgramParameter(t,e.LINK_STATUS)){var E=e.getProgramInfoLog(t),S=It(s,L),N=It(y,L),I='Error linking program with vertex shader, "'+N[0].name+'", and fragment shader "'+S[0].name+'"';typeof document!="undefined"?console.log("%c"+I+ur+"%c"+E,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(I+ur+E),Ee.raise(I)}}function Bn(e){e._commandRef=cr()}function rf(e,t,s,y){Bn(e);function L(I){return I?y.id(I):0}e._fragId=L(e.static.frag),e._vertId=L(e.static.vert);function E(I,z){Object.keys(z).forEach(function(M){I[y.id(M)]=!0})}var S=e._uniformSet={};E(S,t.static),E(S,t.dynamic);var N=e._attributeSet={};E(N,s.static),E(N,s.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function rt(e,t){var s=Nn();Ze(e+" in command "+(t||cr())+(s==="unknown"?"":" called from "+s))}function tf(e,t,s){e||rt(t,s||cr())}function nf(e,t,s,y){e in t||rt("unknown parameter ("+e+")"+sr(s)+". possible values: "+Object.keys(t).join(),y||cr())}function In(e,t,s,y){Gn(e,t)||rt("invalid parameter type"+sr(s)+". expected "+t+", got "+typeof e,y||cr())}function af(e){e()}function ff(e,t,s){e.texture?Nt(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):Nt(e.renderbuffer._renderbuffer.format,s,"unsupported renderbuffer format for attachment")}var tt=33071,kn=9728,of=9984,uf=9985,sf=9986,cf=9987,lf=5120,df=5121,mf=5122,hf=5123,vf=5124,pf=5125,Pn=5126,Mn=32819,Un=32820,Vn=33635,zn=34042,_f=36193,Ue={};Ue[lf]=Ue[df]=1,Ue[mf]=Ue[hf]=Ue[_f]=Ue[Vn]=Ue[Mn]=Ue[Un]=2,Ue[vf]=Ue[pf]=Ue[Pn]=Ue[zn]=4;function jn(e,t){return e===Un||e===Mn||e===Vn?2:e===zn?4:Ue[e]*t}function nt(e){return!(e&e-1)&&!!e}function bf(e,t,s){var y,L=t.width,E=t.height,S=t.channels;Ee(L>0&&L<=s.maxTextureSize&&E>0&&E<=s.maxTextureSize,"invalid texture shape"),(e.wrapS!==tt||e.wrapT!==tt)&&Ee(nt(L)&&nt(E),"incompatible wrap mode for texture, both width and height must be power of 2"),t.mipmask===1?L!==1&&E!==1&&Ee(e.minFilter!==of&&e.minFilter!==sf&&e.minFilter!==uf&&e.minFilter!==cf,"min filter requires mipmap"):(Ee(nt(L)&&nt(E),"texture must be a square power of 2 to support mipmapping"),Ee(t.mipmask===(L<<1)-1,"missing or incomplete mipmap data")),t.type===Pn&&(s.extensions.indexOf("oes_texture_float_linear")<0&&Ee(e.minFilter===kn&&e.magFilter===kn,"filter not supported, must enable oes_texture_float_linear"),Ee(!e.genMipmaps,"mipmap generation not supported with float textures"));var N=t.images;for(y=0;y<16;++y)if(N[y]){var I=L>>y,z=E>>y;Ee(t.mipmask&1<<y,"missing mipmap data");var M=N[y];if(Ee(M.width===I&&M.height===z,"invalid shape for mip images"),Ee(M.format===t.format&&M.internalformat===t.internalformat&&M.type===t.type,"incompatible type for mip image"),!M.compressed)if(M.data){var U=Math.ceil(jn(M.type,S)*I/M.unpackAlignment)*M.unpackAlignment;Ee(M.data.byteLength===U*z,"invalid data for image, buffer size is inconsistent with image format")}else M.element||M.copy}else e.genMipmaps||Ee((t.mipmask&1<<y)===0,"extra mipmap data");t.compressed&&Ee(!e.genMipmaps,"mipmap generation for compressed images not supported")}function yf(e,t,s,y){var L=e.width,E=e.height,S=e.channels;Ee(L>0&&L<=y.maxTextureSize&&E>0&&E<=y.maxTextureSize,"invalid texture shape"),Ee(L===E,"cube map must be square"),Ee(t.wrapS===tt&&t.wrapT===tt,"wrap mode not supported by cube map");for(var N=0;N<s.length;++N){var I=s[N];Ee(I.width===L&&I.height===E,"inconsistent cube map face shape"),t.genMipmaps&&(Ee(!I.compressed,"can not generate mipmap for compressed textures"),Ee(I.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var z=I.images,M=0;M<16;++M){var U=z[M];if(U){var j=L>>M,F=E>>M;Ee(I.mipmask&1<<M,"missing mipmap data"),Ee(U.width===j&&U.height===F,"invalid shape for mip images"),Ee(U.format===e.format&&U.internalformat===e.internalformat&&U.type===e.type,"incompatible type for mip image"),U.compressed||(U.data?Ee(U.data.byteLength===j*F*Math.max(jn(U.type,S),U.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):U.element||U.copy)}}}}var i=xe(Ee,{optional:af,raise:Ze,commandRaise:rt,command:tf,parameter:$i,commandParameter:nf,constructor:qi,type:Yi,commandType:In,isTypedArray:Wi,nni:Qi,oneOf:Nt,shaderError:Ji,linkError:ef,callSite:Nn,saveCommandRef:Bn,saveDrawInfo:rf,framebufferFormat:ff,guessCommand:cr,texture2D:bf,textureCube:yf}),Ef=0,xf=0;function at(e,t){this.id=Ef++,this.type=e,this.data=t}function Hn(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Pr(e){if(e.length===0)return[];var t=e.charAt(0),s=e.charAt(e.length-1);if(e.length>1&&t===s&&(t==='"'||t==="'"))return['"'+Hn(e.substr(1,e.length-2))+'"'];var y=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(y)return Pr(e.substr(0,y.index)).concat(Pr(y[1])).concat(Pr(e.substr(y.index+y[0].length)));var L=e.split(".");if(L.length===1)return['"'+Hn(e)+'"'];for(var E=[],S=0;S<L.length;++S)E=E.concat(Pr(L[S]));return E}function Xn(e){return"["+Pr(e).join("][")+"]"}function Tf(e,t){return new at(e,Xn(t+""))}function Af(e){return typeof e=="function"&&!e._reglType||e instanceof at}function Sf(e,t){return typeof e=="function"?new at(xf,e):e}var $e={DynamicVariable:at,define:Tf,isDynamic:Af,unbox:Sf,accessor:Xn},kt={next:typeof requestAnimationFrame=="function"?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame=="function"?function(e){return cancelAnimationFrame(e)}:clearTimeout},$n=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function gf(){var e={"":0},t=[""];return{id:function(s){var y=e[s];return y||(y=e[s]=t.length,t.push(s),y)},str:function(s){return t[s]}}}function Lf(e,t,s){var y=document.createElement("canvas");xe(y.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(y),e===document.body&&(y.style.position="absolute",xe(e.style,{margin:0,padding:0}));function L(){var N=window.innerWidth,I=window.innerHeight;if(e!==document.body){var z=e.getBoundingClientRect();N=z.right-z.left,I=z.bottom-z.top}y.width=s*N,y.height=s*I,xe(y.style,{width:N+"px",height:I+"px"})}var E;e!==document.body&&typeof ResizeObserver=="function"?(E=new ResizeObserver(function(){setTimeout(L)}),E.observe(e)):window.addEventListener("resize",L,!1);function S(){E?E.disconnect():window.removeEventListener("resize",L),e.removeChild(y)}return L(),{canvas:y,onDestroy:S}}function wf(e,t){function s(y){try{return e.getContext(y,t)}catch(L){return null}}return s("webgl")||s("experimental-webgl")||s("webgl-experimental")}function Rf(e){return typeof e.nodeName=="string"&&typeof e.appendChild=="function"&&typeof e.getBoundingClientRect=="function"}function Of(e){return typeof e.drawArrays=="function"||typeof e.drawElements=="function"}function Wn(e){return typeof e=="string"?e.split():(i(Array.isArray(e),"invalid extension array"),e)}function Yn(e){return typeof e=="string"?(i(typeof document!="undefined","not supported outside of DOM"),document.querySelector(e)):e}function Gf(e){var t=e||{},s,y,L,E,S={},N=[],I=[],z=typeof window=="undefined"?1:window.devicePixelRatio,M=!1,U=function(V){V&&i.raise(V)},j=function(){};if(typeof t=="string"?(i(typeof document!="undefined","selector queries only supported in DOM enviroments"),s=document.querySelector(t),i(s,"invalid query string for element")):typeof t=="object"?Rf(t)?s=t:Of(t)?(E=t,L=E.canvas):(i.constructor(t),"gl"in t?E=t.gl:"canvas"in t?L=Yn(t.canvas):"container"in t&&(y=Yn(t.container)),"attributes"in t&&(S=t.attributes,i.type(S,"object","invalid context attributes")),"extensions"in t&&(N=Wn(t.extensions)),"optionalExtensions"in t&&(I=Wn(t.optionalExtensions)),"onDone"in t&&(i.type(t.onDone,"function","invalid or missing onDone callback"),U=t.onDone),"profile"in t&&(M=!!t.profile),"pixelRatio"in t&&(z=+t.pixelRatio,i(z>0,"invalid pixel ratio"))):i.raise("invalid arguments to regl"),s&&(s.nodeName.toLowerCase()==="canvas"?L=s:y=s),!E){if(!L){i(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var F=Lf(y||document.body,U,z);if(!F)return null;L=F.canvas,j=F.onDestroy}S.premultipliedAlpha===void 0&&(S.premultipliedAlpha=!0),E=wf(L,S)}return E?{gl:E,canvas:L,container:y,extensions:N,optionalExtensions:I,pixelRatio:z,profile:M,onDone:U,onDestroy:j}:(j(),U("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Cf(e,t){var s={};function y(S){i.type(S,"string","extension name must be string");var N=S.toLowerCase(),I;try{I=s[N]=e.getExtension(N)}catch(z){}return!!I}for(var L=0;L<t.extensions.length;++L){var E=t.extensions[L];if(!y(E))return t.onDestroy(),t.onDone('"'+E+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(y),{extensions:s,restore:function(){Object.keys(s).forEach(function(S){if(s[S]&&!y(S))throw new Error("(regl): error restoring extension "+S)})}}}function Ve(e,t){for(var s=Array(e),y=0;y<e;++y)s[y]=t(y);return s}var Ff=5120,Df=5121,Nf=5122,Bf=5123,If=5124,kf=5125,Pf=5126;function Mf(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function Qn(e){var t,s;return t=(e>65535)<<4,e>>>=t,s=(e>255)<<3,e>>>=s,t|=s,s=(e>15)<<2,e>>>=s,t|=s,s=(e>3)<<1,e>>>=s,t|=s,t|e>>1}function qn(){var e=Ve(8,function(){return[]});function t(E){var S=Mf(E),N=e[Qn(S)>>2];return N.length>0?N.pop():new ArrayBuffer(S)}function s(E){e[Qn(E.byteLength)>>2].push(E)}function y(E,S){var N=null;switch(E){case Ff:N=new Int8Array(t(S),0,S);break;case Df:N=new Uint8Array(t(S),0,S);break;case Nf:N=new Int16Array(t(2*S),0,S);break;case Bf:N=new Uint16Array(t(2*S),0,S);break;case If:N=new Int32Array(t(4*S),0,S);break;case kf:N=new Uint32Array(t(4*S),0,S);break;case Pf:N=new Float32Array(t(4*S),0,S);break;default:return null}return N.length!==S?N.subarray(0,S):N}function L(E){s(E.buffer)}return{alloc:t,free:s,allocType:y,freeType:L}}var Se=qn();Se.zero=qn();var Uf=3408,Vf=3410,zf=3411,jf=3412,Hf=3413,Xf=3414,$f=3415,Wf=33901,Yf=33902,Qf=3379,qf=3386,Kf=34921,Zf=36347,Jf=36348,eo=35661,ro=35660,to=34930,no=36349,ao=34076,io=34024,fo=7936,oo=7937,uo=7938,so=35724,co=34047,lo=36063,mo=34852,it=3553,Kn=34067,ho=34069,vo=33984,Mr=6408,Pt=5126,Zn=5121,Mt=36160,po=36053,_o=36064,bo=16384,yo=function(e,t){var s=1;t.ext_texture_filter_anisotropic&&(s=e.getParameter(co));var y=1,L=1;t.webgl_draw_buffers&&(y=e.getParameter(mo),L=e.getParameter(lo));var E=!!t.oes_texture_float;if(E){var S=e.createTexture();e.bindTexture(it,S),e.texImage2D(it,0,Mr,1,1,0,Mr,Pt,null);var N=e.createFramebuffer();if(e.bindFramebuffer(Mt,N),e.framebufferTexture2D(Mt,_o,it,S,0),e.bindTexture(it,null),e.checkFramebufferStatus(Mt)!==po)E=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(bo);var I=Se.allocType(Pt,4);e.readPixels(0,0,1,1,Mr,Pt,I),e.getError()?E=!1:(e.deleteFramebuffer(N),e.deleteTexture(S),E=I[0]===1),Se.freeType(I)}}var z=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),M=!0;if(!z){var U=e.createTexture(),j=Se.allocType(Zn,36);e.activeTexture(vo),e.bindTexture(Kn,U),e.texImage2D(ho,0,Mr,3,3,0,Mr,Zn,j),Se.freeType(j),e.bindTexture(Kn,null),e.deleteTexture(U),M=!e.getError()}return{colorBits:[e.getParameter(Vf),e.getParameter(zf),e.getParameter(jf),e.getParameter(Hf)],depthBits:e.getParameter(Xf),stencilBits:e.getParameter($f),subpixelBits:e.getParameter(Uf),extensions:Object.keys(t).filter(function(F){return!!t[F]}),maxAnisotropic:s,maxDrawbuffers:y,maxColorAttachments:L,pointSizeDims:e.getParameter(Wf),lineWidthDims:e.getParameter(Yf),maxViewportDims:e.getParameter(qf),maxCombinedTextureUnits:e.getParameter(eo),maxCubeMapSize:e.getParameter(ao),maxRenderbufferSize:e.getParameter(io),maxTextureUnits:e.getParameter(to),maxTextureSize:e.getParameter(Qf),maxAttributes:e.getParameter(Kf),maxVertexUniforms:e.getParameter(Zf),maxVertexTextureUnits:e.getParameter(ro),maxVaryingVectors:e.getParameter(Jf),maxFragmentUniforms:e.getParameter(no),glsl:e.getParameter(so),renderer:e.getParameter(oo),vendor:e.getParameter(fo),version:e.getParameter(uo),readFloat:E,npotTextureCube:M}};function We(e){return!!e&&typeof e=="object"&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&typeof e.offset=="number"&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||Be(e.data))}var ze=function(e){return Object.keys(e).map(function(t){return e[t]})},ft={shape:Ao,flatten:To};function Eo(e,t,s){for(var y=0;y<t;++y)s[y]=e[y]}function xo(e,t,s,y){for(var L=0,E=0;E<t;++E)for(var S=e[E],N=0;N<s;++N)y[L++]=S[N]}function Jn(e,t,s,y,L,E){for(var S=E,N=0;N<t;++N)for(var I=e[N],z=0;z<s;++z)for(var M=I[z],U=0;U<y;++U)L[S++]=M[U]}function ea(e,t,s,y,L){for(var E=1,S=s+1;S<t.length;++S)E*=t[S];var N=t[s];if(t.length-s===4){var I=t[s+1],z=t[s+2],M=t[s+3];for(S=0;S<N;++S)Jn(e[S],I,z,M,y,L),L+=E}else for(S=0;S<N;++S)ea(e[S],t,s+1,y,L),L+=E}function To(e,t,s,y){var L=1;if(t.length)for(var E=0;E<t.length;++E)L*=t[E];else L=0;var S=y||Se.allocType(s,L);switch(t.length){case 0:break;case 1:Eo(e,t[0],S);break;case 2:xo(e,t[0],t[1],S);break;case 3:Jn(e,t[0],t[1],t[2],S,0);break;default:ea(e,t,0,S,0)}return S}function Ao(e){for(var t=[],s=e;s.length;s=s[0])t.push(s.length);return t}var Ut={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},So=5120,go=5122,Lo=5124,wo=5121,Ro=5123,Oo=5125,Go=5126,Co=5126,lr={int8:So,int16:go,int32:Lo,uint8:wo,uint16:Ro,uint32:Oo,float:Go,float32:Co},Fo=35048,Do=35040,ot={dynamic:Fo,stream:Do,static:35044},Vt=ft.flatten,ra=ft.shape,ta=35044,No=35040,zt=5121,jt=5126,nr=[];nr[5120]=1,nr[5122]=2,nr[5124]=4,nr[5121]=1,nr[5123]=2,nr[5125]=4,nr[5126]=4;function ut(e){return Ut[Object.prototype.toString.call(e)]|0}function na(e,t){for(var s=0;s<t.length;++s)e[s]=t[s]}function aa(e,t,s,y,L,E,S){for(var N=0,I=0;I<s;++I)for(var z=0;z<y;++z)e[N++]=t[L*I+E*z+S]}function Bo(e,t,s,y){var L=0,E={};function S(v){this.id=L++,this.buffer=e.createBuffer(),this.type=v,this.usage=ta,this.byteLength=0,this.dimension=1,this.dtype=zt,this.persistentData=null,s.profile&&(this.stats={size:0})}S.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},S.prototype.destroy=function(){j(this)};var N=[];function I(v,A){var B=N.pop();return B||(B=new S(v)),B.bind(),U(B,A,No,0,1,!1),B}function z(v){N.push(v)}function M(v,A,B){v.byteLength=A.byteLength,e.bufferData(v.type,A,B)}function U(v,A,B,X,O,Y){var k;if(v.usage=B,Array.isArray(A)){if(v.dtype=X||jt,A.length>0){var W;if(Array.isArray(A[0])){k=ra(A);for(var G=1,H=1;H<k.length;++H)G*=k[H];v.dimension=G,W=Vt(A,k,v.dtype),M(v,W,B),Y?v.persistentData=W:Se.freeType(W)}else if(typeof A[0]=="number"){v.dimension=O;var J=Se.allocType(v.dtype,A.length);na(J,A),M(v,J,B),Y?v.persistentData=J:Se.freeType(J)}else Be(A[0])?(v.dimension=A[0].length,v.dtype=X||ut(A[0])||jt,W=Vt(A,[A.length,A[0].length],v.dtype),M(v,W,B),Y?v.persistentData=W:Se.freeType(W)):i.raise("invalid buffer data")}}else if(Be(A))v.dtype=X||ut(A),v.dimension=O,M(v,A,B),Y&&(v.persistentData=new Uint8Array(new Uint8Array(A.buffer)));else if(We(A)){k=A.shape;var te=A.stride,$=A.offset,P=0,w=0,ne=0,me=0;k.length===1?(P=k[0],w=1,ne=te[0],me=0):k.length===2?(P=k[0],w=k[1],ne=te[0],me=te[1]):i.raise("invalid shape"),v.dtype=X||ut(A.data)||jt,v.dimension=w;var K=Se.allocType(v.dtype,P*w);aa(K,A.data,P,w,ne,me,$),M(v,K,B),Y?v.persistentData=K:Se.freeType(K)}else A instanceof ArrayBuffer?(v.dtype=zt,v.dimension=O,M(v,A,B),Y&&(v.persistentData=new Uint8Array(new Uint8Array(A)))):i.raise("invalid buffer data")}function j(v){t.bufferCount--,y(v);var A=v.buffer;i(A,"buffer must not be deleted already"),e.deleteBuffer(A),v.buffer=null,delete E[v.id]}function F(v,A,B,X){t.bufferCount++;var O=new S(A);E[O.id]=O;function Y(G){var H=ta,J=null,te=0,$=0,P=1;return Array.isArray(G)||Be(G)||We(G)||G instanceof ArrayBuffer?J=G:typeof G=="number"?te=G|0:G&&(i.type(G,"object","buffer arguments must be an object, a number or an array"),"data"in G&&(i(J===null||Array.isArray(J)||Be(J)||We(J),"invalid data for buffer"),J=G.data),"usage"in G&&(i.parameter(G.usage,ot,"invalid buffer usage"),H=ot[G.usage]),"type"in G&&(i.parameter(G.type,lr,"invalid buffer type"),$=lr[G.type]),"dimension"in G&&(i.type(G.dimension,"number","invalid dimension"),P=G.dimension|0),"length"in G&&(i.nni(te,"buffer length must be a nonnegative integer"),te=G.length|0)),O.bind(),J?U(O,J,H,$,P,X):(te&&e.bufferData(O.type,te,H),O.dtype=$||zt,O.usage=H,O.dimension=P,O.byteLength=te),s.profile&&(O.stats.size=O.byteLength*nr[O.dtype]),Y}function k(G,H){i(H+G.byteLength<=O.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+G.byteLength+" starting from offset "+H+" to a buffer of size "+O.byteLength),e.bufferSubData(O.type,H,G)}function W(G,H){var J=(H||0)|0,te;if(O.bind(),Be(G)||G instanceof ArrayBuffer)k(G,J);else if(Array.isArray(G)){if(G.length>0)if(typeof G[0]=="number"){var $=Se.allocType(O.dtype,G.length);na($,G),k($,J),Se.freeType($)}else if(Array.isArray(G[0])||Be(G[0])){te=ra(G);var P=Vt(G,te,O.dtype);k(P,J),Se.freeType(P)}else i.raise("invalid buffer data")}else if(We(G)){te=G.shape;var w=G.stride,ne=0,me=0,K=0,se=0;te.length===1?(ne=te[0],me=1,K=w[0],se=0):te.length===2?(ne=te[0],me=te[1],K=w[0],se=w[1]):i.raise("invalid shape");var ae=Array.isArray(G.data)?O.dtype:ut(G.data),ue=Se.allocType(ae,ne*me);aa(ue,G.data,ne,me,K,se,G.offset),k(ue,J),Se.freeType(ue)}else i.raise("invalid data for buffer subdata");return Y}return B||Y(v),Y._reglType="buffer",Y._buffer=O,Y.subdata=W,s.profile&&(Y.stats=O.stats),Y.destroy=function(){j(O)},Y}function V(){ze(E).forEach(function(v){v.buffer=e.createBuffer(),e.bindBuffer(v.type,v.buffer),e.bufferData(v.type,v.persistentData||v.byteLength,v.usage)})}return s.profile&&(t.getTotalBufferSize=function(){var v=0;return Object.keys(E).forEach(function(A){v+=E[A].stats.size}),v}),{create:F,createStream:I,destroyStream:z,clear:function(){ze(E).forEach(j),N.forEach(j)},getBuffer:function(v){return v&&v._buffer instanceof S?v._buffer:null},restore:V,_initBuffer:U}}var Io=0,ko=0,Po=1,Mo=1,Uo=4,Vo=4,Tr={points:Io,point:ko,lines:Po,line:Mo,triangles:Uo,triangle:Vo,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},zo=0,jo=1,Ur=4,Ho=5120,Ar=5121,ia=5122,Sr=5123,fa=5124,dr=5125,Ht=34963,Xo=35040,$o=35044;function Wo(e,t,s,y){var L={},E=0,S={uint8:Ar,uint16:Sr};t.oes_element_index_uint&&(S.uint32=dr);function N(V){this.id=E++,L[this.id]=this,this.buffer=V,this.primType=Ur,this.vertCount=0,this.type=0}N.prototype.bind=function(){this.buffer.bind()};var I=[];function z(V){var v=I.pop();return v||(v=new N(s.create(null,Ht,!0,!1)._buffer)),U(v,V,Xo,-1,-1,0,0),v}function M(V){I.push(V)}function U(V,v,A,B,X,O,Y){V.buffer.bind();var k;if(v){var W=Y;!Y&&(!Be(v)||We(v)&&!Be(v.data))&&(W=t.oes_element_index_uint?dr:Sr),s._initBuffer(V.buffer,v,A,W,3)}else e.bufferData(Ht,O,A),V.buffer.dtype=k||Ar,V.buffer.usage=A,V.buffer.dimension=3,V.buffer.byteLength=O;if(k=Y,!Y){switch(V.buffer.dtype){case Ar:case Ho:k=Ar;break;case Sr:case ia:k=Sr;break;case dr:case fa:k=dr;break;default:i.raise("unsupported type for element array")}V.buffer.dtype=k}V.type=k,i(k!==dr||!!t.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var G=X;G<0&&(G=V.buffer.byteLength,k===Sr?G>>=1:k===dr&&(G>>=2)),V.vertCount=G;var H=B;if(B<0){H=Ur;var J=V.buffer.dimension;J===1&&(H=zo),J===2&&(H=jo),J===3&&(H=Ur)}V.primType=H}function j(V){y.elementsCount--,i(V.buffer!==null,"must not double destroy elements"),delete L[V.id],V.buffer.destroy(),V.buffer=null}function F(V,v){var A=s.create(null,Ht,!0),B=new N(A._buffer);y.elementsCount++;function X(O){if(!O)A(),B.primType=Ur,B.vertCount=0,B.type=Ar;else if(typeof O=="number")A(O),B.primType=Ur,B.vertCount=O|0,B.type=Ar;else{var Y=null,k=$o,W=-1,G=-1,H=0,J=0;Array.isArray(O)||Be(O)||We(O)?Y=O:(i.type(O,"object","invalid arguments for elements"),"data"in O&&(Y=O.data,i(Array.isArray(Y)||Be(Y)||We(Y),"invalid data for element buffer")),"usage"in O&&(i.parameter(O.usage,ot,"invalid element buffer usage"),k=ot[O.usage]),"primitive"in O&&(i.parameter(O.primitive,Tr,"invalid element buffer primitive"),W=Tr[O.primitive]),"count"in O&&(i(typeof O.count=="number"&&O.count>=0,"invalid vertex count for elements"),G=O.count|0),"type"in O&&(i.parameter(O.type,S,"invalid buffer type"),J=S[O.type]),"length"in O?H=O.length|0:(H=G,J===Sr||J===ia?H*=2:(J===dr||J===fa)&&(H*=4))),U(B,Y,k,W,G,H,J)}return X}return X(V),X._reglType="elements",X._elements=B,X.subdata=function(O,Y){return A.subdata(O,Y),X},X.destroy=function(){j(B)},X}return{create:F,createStream:z,destroyStream:M,getElements:function(V){return typeof V=="function"&&V._elements instanceof N?V._elements:null},clear:function(){ze(L).forEach(j)}}}var oa=new Float32Array(1),Yo=new Uint32Array(oa.buffer),Qo=5123;function ua(e){for(var t=Se.allocType(Qo,e.length),s=0;s<e.length;++s)if(isNaN(e[s]))t[s]=65535;else if(e[s]===1/0)t[s]=31744;else if(e[s]===-1/0)t[s]=64512;else{oa[0]=e[s];var y=Yo[0],L=y>>>31<<15,E=(y<<1>>>24)-127,S=y>>13&1023;if(E<-24)t[s]=L;else if(E<-14){var N=-14-E;t[s]=L+(S+1024>>N)}else E>15?t[s]=L+31744:t[s]=L+(E+15<<10)+S}return t}function Te(e){return Array.isArray(e)||Be(e)}var sa=function(e){return!(e&e-1)&&!!e},qo=34467,Je=3553,ca=34067,st=34069,mr=6408,Xt=6406,ct=6407,Vr=6409,lt=6410,la=32854,$t=32855,da=36194,Ko=32819,Zo=32820,Jo=33635,eu=34042,Wt=6402,dt=34041,Yt=35904,Qt=35906,gr=36193,qt=33776,Kt=33777,Zt=33778,Jt=33779,ma=35986,ha=35987,va=34798,pa=35840,_a=35841,ba=35842,ya=35843,Ea=36196,Lr=5121,en=5123,rn=5125,zr=5126,ru=10242,tu=10243,nu=10497,tn=33071,au=33648,iu=10240,fu=10241,nn=9728,ou=9729,an=9984,xa=9985,Ta=9986,fn=9987,uu=33170,mt=4352,su=4353,cu=4354,lu=34046,du=3317,mu=37440,hu=37441,vu=37443,Aa=37444,ht=33984,pu=[an,Ta,xa,fn],vt=[0,Vr,lt,ct,mr],He={};He[Vr]=He[Xt]=He[Wt]=1,He[dt]=He[lt]=2,He[ct]=He[Yt]=3,He[mr]=He[Qt]=4;function wr(e){return"[object "+e+"]"}var Sa=wr("HTMLCanvasElement"),ga=wr("OffscreenCanvas"),La=wr("CanvasRenderingContext2D"),wa=wr("ImageBitmap"),Ra=wr("HTMLImageElement"),Oa=wr("HTMLVideoElement"),_u=Object.keys(Ut).concat([Sa,ga,La,wa,Ra,Oa]),Rr=[];Rr[Lr]=1,Rr[zr]=4,Rr[gr]=2,Rr[en]=2,Rr[rn]=4;var Ie=[];Ie[la]=2,Ie[$t]=2,Ie[da]=2,Ie[dt]=4,Ie[qt]=.5,Ie[Kt]=.5,Ie[Zt]=1,Ie[Jt]=1,Ie[ma]=.5,Ie[ha]=1,Ie[va]=1,Ie[pa]=.5,Ie[_a]=.25,Ie[ba]=.5,Ie[ya]=.25,Ie[Ea]=.5;function Ga(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")}function Ca(e){if(!Array.isArray(e))return!1;var t=e.length;return!(t===0||!Te(e[0]))}function hr(e){return Object.prototype.toString.call(e)}function Fa(e){return hr(e)===Sa}function Da(e){return hr(e)===ga}function bu(e){return hr(e)===La}function yu(e){return hr(e)===wa}function Eu(e){return hr(e)===Ra}function xu(e){return hr(e)===Oa}function on(e){if(!e)return!1;var t=hr(e);return _u.indexOf(t)>=0?!0:Ga(e)||Ca(e)||We(e)}function Na(e){return Ut[Object.prototype.toString.call(e)]|0}function Tu(e,t){var s=t.length;switch(e.type){case Lr:case en:case rn:case zr:var y=Se.allocType(e.type,s);y.set(t),e.data=y;break;case gr:e.data=ua(t);break;default:i.raise("unsupported texture type, must specify a typed array")}}function Ba(e,t){return Se.allocType(e.type===gr?zr:e.type,t)}function Ia(e,t){e.type===gr?(e.data=ua(t),Se.freeType(t)):e.data=t}function Au(e,t,s,y,L,E){for(var S=e.width,N=e.height,I=e.channels,z=S*N*I,M=Ba(e,z),U=0,j=0;j<N;++j)for(var F=0;F<S;++F)for(var V=0;V<I;++V)M[U++]=t[s*F+y*j+L*V+E];Ia(e,M)}function pt(e,t,s,y,L,E){var S;if(typeof Ie[e]!="undefined"?S=Ie[e]:S=He[e]*Rr[t],E&&(S*=6),L){for(var N=0,I=s;I>=1;)N+=S*I*I,I/=2;return N}else return S*s*y}function Su(e,t,s,y,L,E,S){var N={"don't care":mt,"dont care":mt,nice:cu,fast:su},I={repeat:nu,clamp:tn,mirror:au},z={nearest:nn,linear:ou},M=xe({mipmap:fn,"nearest mipmap nearest":an,"linear mipmap nearest":xa,"nearest mipmap linear":Ta,"linear mipmap linear":fn},z),U={none:0,browser:Aa},j={uint8:Lr,rgba4:Ko,rgb565:Jo,"rgb5 a1":Zo},F={alpha:Xt,luminance:Vr,"luminance alpha":lt,rgb:ct,rgba:mr,rgba4:la,"rgb5 a1":$t,rgb565:da},V={};t.ext_srgb&&(F.srgb=Yt,F.srgba=Qt),t.oes_texture_float&&(j.float32=j.float=zr),t.oes_texture_half_float&&(j.float16=j["half float"]=gr),t.webgl_depth_texture&&(xe(F,{depth:Wt,"depth stencil":dt}),xe(j,{uint16:en,uint32:rn,"depth stencil":eu})),t.webgl_compressed_texture_s3tc&&xe(V,{"rgb s3tc dxt1":qt,"rgba s3tc dxt1":Kt,"rgba s3tc dxt3":Zt,"rgba s3tc dxt5":Jt}),t.webgl_compressed_texture_atc&&xe(V,{"rgb atc":ma,"rgba atc explicit alpha":ha,"rgba atc interpolated alpha":va}),t.webgl_compressed_texture_pvrtc&&xe(V,{"rgb pvrtc 4bppv1":pa,"rgb pvrtc 2bppv1":_a,"rgba pvrtc 4bppv1":ba,"rgba pvrtc 2bppv1":ya}),t.webgl_compressed_texture_etc1&&(V["rgb etc1"]=Ea);var v=Array.prototype.slice.call(e.getParameter(qo));Object.keys(V).forEach(function(f){var T=V[f];v.indexOf(T)>=0&&(F[f]=T)});var A=Object.keys(F);s.textureFormats=A;var B=[];Object.keys(F).forEach(function(f){var T=F[f];B[T]=f});var X=[];Object.keys(j).forEach(function(f){var T=j[f];X[T]=f});var O=[];Object.keys(z).forEach(function(f){var T=z[f];O[T]=f});var Y=[];Object.keys(M).forEach(function(f){var T=M[f];Y[T]=f});var k=[];Object.keys(I).forEach(function(f){var T=I[f];k[T]=f});var W=A.reduce(function(f,T){var _=F[T];return _===Vr||_===Xt||_===Vr||_===lt||_===Wt||_===dt||t.ext_srgb&&(_===Yt||_===Qt)?f[_]=_:_===$t||T.indexOf("rgba")>=0?f[_]=mr:f[_]=ct,f},{});function G(){this.internalformat=mr,this.format=mr,this.type=Lr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Aa,this.width=0,this.height=0,this.channels=0}function H(f,T){f.internalformat=T.internalformat,f.format=T.format,f.type=T.type,f.compressed=T.compressed,f.premultiplyAlpha=T.premultiplyAlpha,f.flipY=T.flipY,f.unpackAlignment=T.unpackAlignment,f.colorSpace=T.colorSpace,f.width=T.width,f.height=T.height,f.channels=T.channels}function J(f,T){if(!(typeof T!="object"||!T)){if("premultiplyAlpha"in T&&(i.type(T.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),f.premultiplyAlpha=T.premultiplyAlpha),"flipY"in T&&(i.type(T.flipY,"boolean","invalid texture flip"),f.flipY=T.flipY),"alignment"in T&&(i.oneOf(T.alignment,[1,2,4,8],"invalid texture unpack alignment"),f.unpackAlignment=T.alignment),"colorSpace"in T&&(i.parameter(T.colorSpace,U,"invalid colorSpace"),f.colorSpace=U[T.colorSpace]),"type"in T){var _=T.type;i(t.oes_texture_float||!(_==="float"||_==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),i(t.oes_texture_half_float||!(_==="half float"||_==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),i(t.webgl_depth_texture||!(_==="uint16"||_==="uint32"||_==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),i.parameter(_,j,"invalid texture type"),f.type=j[_]}var Q=f.width,ce=f.height,be=f.channels,r=!1;"shape"in T?(i(Array.isArray(T.shape)&&T.shape.length>=2,"shape must be an array"),Q=T.shape[0],ce=T.shape[1],T.shape.length===3&&(be=T.shape[2],i(be>0&&be<=4,"invalid number of channels"),r=!0),i(Q>=0&&Q<=s.maxTextureSize,"invalid width"),i(ce>=0&&ce<=s.maxTextureSize,"invalid height")):("radius"in T&&(Q=ce=T.radius,i(Q>=0&&Q<=s.maxTextureSize,"invalid radius")),"width"in T&&(Q=T.width,i(Q>=0&&Q<=s.maxTextureSize,"invalid width")),"height"in T&&(ce=T.height,i(ce>=0&&ce<=s.maxTextureSize,"invalid height")),"channels"in T&&(be=T.channels,i(be>0&&be<=4,"invalid number of channels"),r=!0)),f.width=Q|0,f.height=ce|0,f.channels=be|0;var a=!1;if("format"in T){var u=T.format;i(t.webgl_depth_texture||!(u==="depth"||u==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),i.parameter(u,F,"invalid texture format");var b=f.internalformat=F[u];f.format=W[b],u in j&&("type"in T||(f.type=j[u])),u in V&&(f.compressed=!0),a=!0}!r&&a?f.channels=He[f.format]:r&&!a?f.channels!==vt[f.format]&&(f.format=f.internalformat=vt[f.channels]):a&&r&&i(f.channels===He[f.format],"number of channels inconsistent with specified format")}}function te(f){e.pixelStorei(mu,f.flipY),e.pixelStorei(hu,f.premultiplyAlpha),e.pixelStorei(vu,f.colorSpace),e.pixelStorei(du,f.unpackAlignment)}function $(){G.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function P(f,T){var _=null;if(on(T)?_=T:T&&(i.type(T,"object","invalid pixel data type"),J(f,T),"x"in T&&(f.xOffset=T.x|0),"y"in T&&(f.yOffset=T.y|0),on(T.data)&&(_=T.data)),i(!f.compressed||_ instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),T.copy){i(!_,"can not specify copy and data field for the same texture");var Q=L.viewportWidth,ce=L.viewportHeight;f.width=f.width||Q-f.xOffset,f.height=f.height||ce-f.yOffset,f.needsCopy=!0,i(f.xOffset>=0&&f.xOffset<Q&&f.yOffset>=0&&f.yOffset<ce&&f.width>0&&f.width<=Q&&f.height>0&&f.height<=ce,"copy texture read out of bounds")}else if(!_)f.width=f.width||1,f.height=f.height||1,f.channels=f.channels||4;else if(Be(_))f.channels=f.channels||4,f.data=_,!("type"in T)&&f.type===Lr&&(f.type=Na(_));else if(Ga(_))f.channels=f.channels||4,Tu(f,_),f.alignment=1,f.needsFree=!0;else if(We(_)){var be=_.data;!Array.isArray(be)&&f.type===Lr&&(f.type=Na(be));var r=_.shape,a=_.stride,u,b,p,c,m,h;r.length===3?(p=r[2],h=a[2]):(i(r.length===2,"invalid ndarray pixel data, must be 2 or 3D"),p=1,h=1),u=r[0],b=r[1],c=a[0],m=a[1],f.alignment=1,f.width=u,f.height=b,f.channels=p,f.format=f.internalformat=vt[p],f.needsFree=!0,Au(f,be,c,m,h,_.offset)}else if(Fa(_)||Da(_)||bu(_))Fa(_)||Da(_)?f.element=_:f.element=_.canvas,f.width=f.element.width,f.height=f.element.height,f.channels=4;else if(yu(_))f.element=_,f.width=_.width,f.height=_.height,f.channels=4;else if(Eu(_))f.element=_,f.width=_.naturalWidth,f.height=_.naturalHeight,f.channels=4;else if(xu(_))f.element=_,f.width=_.videoWidth,f.height=_.videoHeight,f.channels=4;else if(Ca(_)){var o=f.width||_[0].length,l=f.height||_.length,n=f.channels;Te(_[0][0])?n=n||_[0][0].length:n=n||1;for(var d=ft.shape(_),x=1,g=0;g<d.length;++g)x*=d[g];var C=Ba(f,x);ft.flatten(_,d,"",C),Ia(f,C),f.alignment=1,f.width=o,f.height=l,f.channels=n,f.format=f.internalformat=vt[n],f.needsFree=!0}f.type===zr?i(s.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):f.type===gr&&i(s.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function w(f,T,_){var Q=f.element,ce=f.data,be=f.internalformat,r=f.format,a=f.type,u=f.width,b=f.height;te(f),Q?e.texImage2D(T,_,r,r,a,Q):f.compressed?e.compressedTexImage2D(T,_,be,u,b,0,ce):f.needsCopy?(y(),e.copyTexImage2D(T,_,r,f.xOffset,f.yOffset,u,b,0)):e.texImage2D(T,_,r,u,b,0,r,a,ce||null)}function ne(f,T,_,Q,ce){var be=f.element,r=f.data,a=f.internalformat,u=f.format,b=f.type,p=f.width,c=f.height;te(f),be?e.texSubImage2D(T,ce,_,Q,u,b,be):f.compressed?e.compressedTexSubImage2D(T,ce,_,Q,a,p,c,r):f.needsCopy?(y(),e.copyTexSubImage2D(T,ce,_,Q,f.xOffset,f.yOffset,p,c)):e.texSubImage2D(T,ce,_,Q,p,c,u,b,r)}var me=[];function K(){return me.pop()||new $}function se(f){f.needsFree&&Se.freeType(f.data),$.call(f),me.push(f)}function ae(){G.call(this),this.genMipmaps=!1,this.mipmapHint=mt,this.mipmask=0,this.images=Array(16)}function ue(f,T,_){var Q=f.images[0]=K();f.mipmask=1,Q.width=f.width=T,Q.height=f.height=_,Q.channels=f.channels=4}function ve(f,T){var _=null;if(on(T))_=f.images[0]=K(),H(_,f),P(_,T),f.mipmask=1;else if(J(f,T),Array.isArray(T.mipmap))for(var Q=T.mipmap,ce=0;ce<Q.length;++ce)_=f.images[ce]=K(),H(_,f),_.width>>=ce,_.height>>=ce,P(_,Q[ce]),f.mipmask|=1<<ce;else _=f.images[0]=K(),H(_,f),P(_,T),f.mipmask=1;H(f,f.images[0]),f.compressed&&(f.internalformat===qt||f.internalformat===Kt||f.internalformat===Zt||f.internalformat===Jt)&&i(f.width%4===0&&f.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Le(f,T){for(var _=f.images,Q=0;Q<_.length;++Q){if(!_[Q])return;w(_[Q],T,Q)}}var De=[];function de(){var f=De.pop()||new ae;G.call(f),f.mipmask=0;for(var T=0;T<16;++T)f.images[T]=null;return f}function Oe(f){for(var T=f.images,_=0;_<T.length;++_)T[_]&&se(T[_]),T[_]=null;De.push(f)}function ye(){this.minFilter=nn,this.magFilter=nn,this.wrapS=tn,this.wrapT=tn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=mt}function we(f,T){if("min"in T){var _=T.min;i.parameter(_,M),f.minFilter=M[_],pu.indexOf(f.minFilter)>=0&&!("faces"in T)&&(f.genMipmaps=!0)}if("mag"in T){var Q=T.mag;i.parameter(Q,z),f.magFilter=z[Q]}var ce=f.wrapS,be=f.wrapT;if("wrap"in T){var r=T.wrap;typeof r=="string"?(i.parameter(r,I),ce=be=I[r]):Array.isArray(r)&&(i.parameter(r[0],I),i.parameter(r[1],I),ce=I[r[0]],be=I[r[1]])}else{if("wrapS"in T){var a=T.wrapS;i.parameter(a,I),ce=I[a]}if("wrapT"in T){var u=T.wrapT;i.parameter(u,I),be=I[u]}}if(f.wrapS=ce,f.wrapT=be,"anisotropic"in T){var b=T.anisotropic;i(typeof b=="number"&&b>=1&&b<=s.maxAnisotropic,"aniso samples must be between 1 and "),f.anisotropic=T.anisotropic}if("mipmap"in T){var p=!1;switch(typeof T.mipmap){case"string":i.parameter(T.mipmap,N,"invalid mipmap hint"),f.mipmapHint=N[T.mipmap],f.genMipmaps=!0,p=!0;break;case"boolean":p=f.genMipmaps=T.mipmap;break;case"object":i(Array.isArray(T.mipmap),"invalid mipmap type"),f.genMipmaps=!1,p=!0;break;default:i.raise("invalid mipmap type")}p&&!("min"in T)&&(f.minFilter=an)}}function Ge(f,T){e.texParameteri(T,fu,f.minFilter),e.texParameteri(T,iu,f.magFilter),e.texParameteri(T,ru,f.wrapS),e.texParameteri(T,tu,f.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(T,lu,f.anisotropic),f.genMipmaps&&(e.hint(uu,f.mipmapHint),e.generateMipmap(T))}var Ce=0,Ne={},Pe=s.maxTextureUnits,Fe=Array(Pe).map(function(){return null});function fe(f){G.call(this),this.mipmask=0,this.internalformat=mr,this.id=Ce++,this.refCount=1,this.target=f,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ye,S.profile&&(this.stats={size:0})}function ke(f){e.activeTexture(ht),e.bindTexture(f.target,f.texture)}function _e(){var f=Fe[0];f?e.bindTexture(f.target,f.texture):e.bindTexture(Je,null)}function ee(f){var T=f.texture;i(T,"must not double destroy texture");var _=f.unit,Q=f.target;_>=0&&(e.activeTexture(ht+_),e.bindTexture(Q,null),Fe[_]=null),e.deleteTexture(T),f.texture=null,f.params=null,f.pixels=null,f.refCount=0,delete Ne[f.id],E.textureCount--}xe(fe.prototype,{bind:function(){var f=this;f.bindCount+=1;var T=f.unit;if(T<0){for(var _=0;_<Pe;++_){var Q=Fe[_];if(Q){if(Q.bindCount>0)continue;Q.unit=-1}Fe[_]=f,T=_;break}T>=Pe&&i.raise("insufficient number of texture units"),S.profile&&E.maxTextureUnits<T+1&&(E.maxTextureUnits=T+1),f.unit=T,e.activeTexture(ht+T),e.bindTexture(f.target,f.texture)}return T},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ee(this)}});function le(f,T){var _=new fe(Je);Ne[_.id]=_,E.textureCount++;function Q(r,a){var u=_.texInfo;ye.call(u);var b=de();return typeof r=="number"?typeof a=="number"?ue(b,r|0,a|0):ue(b,r|0,r|0):r?(i.type(r,"object","invalid arguments to regl.texture"),we(u,r),ve(b,r)):ue(b,1,1),u.genMipmaps&&(b.mipmask=(b.width<<1)-1),_.mipmask=b.mipmask,H(_,b),i.texture2D(u,b,s),_.internalformat=b.internalformat,Q.width=b.width,Q.height=b.height,ke(_),Le(b,Je),Ge(u,Je),_e(),Oe(b),S.profile&&(_.stats.size=pt(_.internalformat,_.type,b.width,b.height,u.genMipmaps,!1)),Q.format=B[_.internalformat],Q.type=X[_.type],Q.mag=O[u.magFilter],Q.min=Y[u.minFilter],Q.wrapS=k[u.wrapS],Q.wrapT=k[u.wrapT],Q}function ce(r,a,u,b){i(!!r,"must specify image data");var p=a|0,c=u|0,m=b|0,h=K();return H(h,_),h.width=0,h.height=0,P(h,r),h.width=h.width||(_.width>>m)-p,h.height=h.height||(_.height>>m)-c,i(_.type===h.type&&_.format===h.format&&_.internalformat===h.internalformat,"incompatible format for texture.subimage"),i(p>=0&&c>=0&&p+h.width<=_.width&&c+h.height<=_.height,"texture.subimage write out of bounds"),i(_.mipmask&1<<m,"missing mipmap data"),i(h.data||h.element||h.needsCopy,"missing image data"),ke(_),ne(h,Je,p,c,m),_e(),se(h),Q}function be(r,a){var u=r|0,b=a|0||u;if(u===_.width&&b===_.height)return Q;Q.width=_.width=u,Q.height=_.height=b,ke(_);for(var p=0;_.mipmask>>p;++p){var c=u>>p,m=b>>p;if(!c||!m)break;e.texImage2D(Je,p,_.format,c,m,0,_.format,_.type,null)}return _e(),S.profile&&(_.stats.size=pt(_.internalformat,_.type,u,b,!1,!1)),Q}return Q(f,T),Q.subimage=ce,Q.resize=be,Q._reglType="texture2d",Q._texture=_,S.profile&&(Q.stats=_.stats),Q.destroy=function(){_.decRef()},Q}function he(f,T,_,Q,ce,be){var r=new fe(ca);Ne[r.id]=r,E.cubeCount++;var a=new Array(6);function u(c,m,h,o,l,n){var d,x=r.texInfo;for(ye.call(x),d=0;d<6;++d)a[d]=de();if(typeof c=="number"||!c){var g=c|0||1;for(d=0;d<6;++d)ue(a[d],g,g)}else if(typeof c=="object")if(m)ve(a[0],c),ve(a[1],m),ve(a[2],h),ve(a[3],o),ve(a[4],l),ve(a[5],n);else if(we(x,c),J(r,c),"faces"in c){var C=c.faces;for(i(Array.isArray(C)&&C.length===6,"cube faces must be a length 6 array"),d=0;d<6;++d)i(typeof C[d]=="object"&&!!C[d],"invalid input for cube map face"),H(a[d],r),ve(a[d],C[d])}else for(d=0;d<6;++d)ve(a[d],c);else i.raise("invalid arguments to cube map");for(H(r,a[0]),s.npotTextureCube||i(sa(r.width)&&sa(r.height),"your browser does not support non power or two texture dimensions"),x.genMipmaps?r.mipmask=(a[0].width<<1)-1:r.mipmask=a[0].mipmask,i.textureCube(r,x,a,s),r.internalformat=a[0].internalformat,u.width=a[0].width,u.height=a[0].height,ke(r),d=0;d<6;++d)Le(a[d],st+d);for(Ge(x,ca),_e(),S.profile&&(r.stats.size=pt(r.internalformat,r.type,u.width,u.height,x.genMipmaps,!0)),u.format=B[r.internalformat],u.type=X[r.type],u.mag=O[x.magFilter],u.min=Y[x.minFilter],u.wrapS=k[x.wrapS],u.wrapT=k[x.wrapT],d=0;d<6;++d)Oe(a[d]);return u}function b(c,m,h,o,l){i(!!m,"must specify image data"),i(typeof c=="number"&&c===(c|0)&&c>=0&&c<6,"invalid face");var n=h|0,d=o|0,x=l|0,g=K();return H(g,r),g.width=0,g.height=0,P(g,m),g.width=g.width||(r.width>>x)-n,g.height=g.height||(r.height>>x)-d,i(r.type===g.type&&r.format===g.format&&r.internalformat===g.internalformat,"incompatible format for texture.subimage"),i(n>=0&&d>=0&&n+g.width<=r.width&&d+g.height<=r.height,"texture.subimage write out of bounds"),i(r.mipmask&1<<x,"missing mipmap data"),i(g.data||g.element||g.needsCopy,"missing image data"),ke(r),ne(g,st+c,n,d,x),_e(),se(g),u}function p(c){var m=c|0;if(m!==r.width){u.width=r.width=m,u.height=r.height=m,ke(r);for(var h=0;h<6;++h)for(var o=0;r.mipmask>>o;++o)e.texImage2D(st+h,o,r.format,m>>o,m>>o,0,r.format,r.type,null);return _e(),S.profile&&(r.stats.size=pt(r.internalformat,r.type,u.width,u.height,!1,!0)),u}}return u(f,T,_,Q,ce,be),u.subimage=b,u.resize=p,u._reglType="textureCube",u._texture=r,S.profile&&(u.stats=r.stats),u.destroy=function(){r.decRef()},u}function Ae(){for(var f=0;f<Pe;++f)e.activeTexture(ht+f),e.bindTexture(Je,null),Fe[f]=null;ze(Ne).forEach(ee),E.cubeCount=0,E.textureCount=0}S.profile&&(E.getTotalTextureSize=function(){var f=0;return Object.keys(Ne).forEach(function(T){f+=Ne[T].stats.size}),f});function Ke(){for(var f=0;f<Pe;++f){var T=Fe[f];T&&(T.bindCount=0,T.unit=-1,Fe[f]=null)}ze(Ne).forEach(function(_){_.texture=e.createTexture(),e.bindTexture(_.target,_.texture);for(var Q=0;Q<32;++Q)if(_.mipmask&1<<Q)if(_.target===Je)e.texImage2D(Je,Q,_.internalformat,_.width>>Q,_.height>>Q,0,_.internalformat,_.type,null);else for(var ce=0;ce<6;++ce)e.texImage2D(st+ce,Q,_.internalformat,_.width>>Q,_.height>>Q,0,_.internalformat,_.type,null);Ge(_.texInfo,_.target)})}return{create2D:le,createCube:he,clear:Ae,getTexture:function(f){return null},restore:Ke}}var ar=36161,_t=32854,ka=32855,Pa=36194,Ma=33189,Ua=36168,Va=34041,za=35907,ja=34836,Ha=34842,Xa=34843,Ye=[];Ye[_t]=2,Ye[ka]=2,Ye[Pa]=2,Ye[Ma]=2,Ye[Ua]=1,Ye[Va]=4,Ye[za]=4,Ye[ja]=16,Ye[Ha]=8,Ye[Xa]=6;function $a(e,t,s){return Ye[e]*t*s}var gu=function(e,t,s,y,L){var E={rgba4:_t,rgb565:Pa,"rgb5 a1":ka,depth:Ma,stencil:Ua,"depth stencil":Va};t.ext_srgb&&(E.srgba=za),t.ext_color_buffer_half_float&&(E.rgba16f=Ha,E.rgb16f=Xa),t.webgl_color_buffer_float&&(E.rgba32f=ja);var S=[];Object.keys(E).forEach(function(F){var V=E[F];S[V]=F});var N=0,I={};function z(F){this.id=N++,this.refCount=1,this.renderbuffer=F,this.format=_t,this.width=0,this.height=0,L.profile&&(this.stats={size:0})}z.prototype.decRef=function(){--this.refCount<=0&&M(this)};function M(F){var V=F.renderbuffer;i(V,"must not double destroy renderbuffer"),e.bindRenderbuffer(ar,null),e.deleteRenderbuffer(V),F.renderbuffer=null,F.refCount=0,delete I[F.id],y.renderbufferCount--}function U(F,V){var v=new z(e.createRenderbuffer());I[v.id]=v,y.renderbufferCount++;function A(X,O){var Y=0,k=0,W=_t;if(typeof X=="object"&&X){var G=X;if("shape"in G){var H=G.shape;i(Array.isArray(H)&&H.length>=2,"invalid renderbuffer shape"),Y=H[0]|0,k=H[1]|0}else"radius"in G&&(Y=k=G.radius|0),"width"in G&&(Y=G.width|0),"height"in G&&(k=G.height|0);"format"in G&&(i.parameter(G.format,E,"invalid renderbuffer format"),W=E[G.format])}else typeof X=="number"?(Y=X|0,typeof O=="number"?k=O|0:k=Y):X?i.raise("invalid arguments to renderbuffer constructor"):Y=k=1;if(i(Y>0&&k>0&&Y<=s.maxRenderbufferSize&&k<=s.maxRenderbufferSize,"invalid renderbuffer size"),!(Y===v.width&&k===v.height&&W===v.format))return A.width=v.width=Y,A.height=v.height=k,v.format=W,e.bindRenderbuffer(ar,v.renderbuffer),e.renderbufferStorage(ar,W,Y,k),i(e.getError()===0,"invalid render buffer format"),L.profile&&(v.stats.size=$a(v.format,v.width,v.height)),A.format=S[v.format],A}function B(X,O){var Y=X|0,k=O|0||Y;return Y===v.width&&k===v.height||(i(Y>0&&k>0&&Y<=s.maxRenderbufferSize&&k<=s.maxRenderbufferSize,"invalid renderbuffer size"),A.width=v.width=Y,A.height=v.height=k,e.bindRenderbuffer(ar,v.renderbuffer),e.renderbufferStorage(ar,v.format,Y,k),i(e.getError()===0,"invalid render buffer format"),L.profile&&(v.stats.size=$a(v.format,v.width,v.height))),A}return A(F,V),A.resize=B,A._reglType="renderbuffer",A._renderbuffer=v,L.profile&&(A.stats=v.stats),A.destroy=function(){v.decRef()},A}L.profile&&(y.getTotalRenderbufferSize=function(){var F=0;return Object.keys(I).forEach(function(V){F+=I[V].stats.size}),F});function j(){ze(I).forEach(function(F){F.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(ar,F.renderbuffer),e.renderbufferStorage(ar,F.format,F.width,F.height)}),e.bindRenderbuffer(ar,null)}return{create:U,clear:function(){ze(I).forEach(M)},restore:j}},er=36160,un=36161,vr=3553,bt=34069,Wa=36064,Ya=36096,Qa=36128,qa=33306,Ka=36053,Lu=36054,wu=36055,Ru=36057,Ou=36061,Gu=36193,Cu=5121,Fu=5126,Za=6407,Ja=6408,Du=6402,Nu=[Za,Ja],sn=[];sn[Ja]=4,sn[Za]=3;var yt=[];yt[Cu]=1,yt[Fu]=4,yt[Gu]=2;var Bu=32854,Iu=32855,ku=36194,Pu=33189,Mu=36168,ei=34041,Uu=35907,Vu=34836,zu=34842,ju=34843,Hu=[Bu,Iu,ku,Uu,zu,ju,Vu],Or={};Or[Ka]="complete",Or[Lu]="incomplete attachment",Or[Ru]="incomplete dimensions",Or[wu]="incomplete, missing attachment",Or[Ou]="unsupported";function Xu(e,t,s,y,L,E){var S={cur:null,next:null,dirty:!1,setFBO:null},N=["rgba"],I=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&I.push("srgba"),t.ext_color_buffer_half_float&&I.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&I.push("rgba32f");var z=["uint8"];t.oes_texture_half_float&&z.push("half float","float16"),t.oes_texture_float&&z.push("float","float32");function M($,P,w){this.target=$,this.texture=P,this.renderbuffer=w;var ne=0,me=0;P?(ne=P.width,me=P.height):w&&(ne=w.width,me=w.height),this.width=ne,this.height=me}function U($){$&&($.texture&&$.texture._texture.decRef(),$.renderbuffer&&$.renderbuffer._renderbuffer.decRef())}function j($,P,w){if($)if($.texture){var ne=$.texture._texture,me=Math.max(1,ne.width),K=Math.max(1,ne.height);i(me===P&&K===w,"inconsistent width/height for supplied texture"),ne.refCount+=1}else{var se=$.renderbuffer._renderbuffer;i(se.width===P&&se.height===w,"inconsistent width/height for renderbuffer"),se.refCount+=1}}function F($,P){P&&(P.texture?e.framebufferTexture2D(er,$,P.target,P.texture._texture.texture,0):e.framebufferRenderbuffer(er,$,un,P.renderbuffer._renderbuffer.renderbuffer))}function V($){var P=vr,w=null,ne=null,me=$;typeof $=="object"&&(me=$.data,"target"in $&&(P=$.target|0)),i.type(me,"function","invalid attachment data");var K=me._reglType;return K==="texture2d"?(w=me,i(P===vr)):K==="textureCube"?(w=me,i(P>=bt&&P<bt+6,"invalid cube map target")):K==="renderbuffer"?(ne=me,P=un):i.raise("invalid regl object for attachment"),new M(P,w,ne)}function v($,P,w,ne,me){if(w){var K=y.create2D({width:$,height:P,format:ne,type:me});return K._texture.refCount=0,new M(vr,K,null)}else{var se=L.create({width:$,height:P,format:ne});return se._renderbuffer.refCount=0,new M(un,null,se)}}function A($){return $&&($.texture||$.renderbuffer)}function B($,P,w){$&&($.texture?$.texture.resize(P,w):$.renderbuffer&&$.renderbuffer.resize(P,w),$.width=P,$.height=w)}var X=0,O={};function Y(){this.id=X++,O[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function k($){$.colorAttachments.forEach(U),U($.depthAttachment),U($.stencilAttachment),U($.depthStencilAttachment)}function W($){var P=$.framebuffer;i(P,"must not double destroy framebuffer"),e.deleteFramebuffer(P),$.framebuffer=null,E.framebufferCount--,delete O[$.id]}function G($){var P;e.bindFramebuffer(er,$.framebuffer);var w=$.colorAttachments;for(P=0;P<w.length;++P)F(Wa+P,w[P]);for(P=w.length;P<s.maxColorAttachments;++P)e.framebufferTexture2D(er,Wa+P,vr,null,0);e.framebufferTexture2D(er,qa,vr,null,0),e.framebufferTexture2D(er,Ya,vr,null,0),e.framebufferTexture2D(er,Qa,vr,null,0),F(Ya,$.depthAttachment),F(Qa,$.stencilAttachment),F(qa,$.depthStencilAttachment);var ne=e.checkFramebufferStatus(er);!e.isContextLost()&&ne!==Ka&&i.raise("framebuffer configuration not supported, status = "+Or[ne]),e.bindFramebuffer(er,S.next?S.next.framebuffer:null),S.cur=S.next,e.getError()}function H($,P){var w=new Y;E.framebufferCount++;function ne(K,se){var ae;i(S.next!==w,"can not update framebuffer which is currently in use");var ue=0,ve=0,Le=!0,De=!0,de=null,Oe=!0,ye="rgba",we="uint8",Ge=1,Ce=null,Ne=null,Pe=null,Fe=!1;if(typeof K=="number")ue=K|0,ve=se|0||ue;else if(!K)ue=ve=1;else{i.type(K,"object","invalid arguments for framebuffer");var fe=K;if("shape"in fe){var ke=fe.shape;i(Array.isArray(ke)&&ke.length>=2,"invalid shape for framebuffer"),ue=ke[0],ve=ke[1]}else"radius"in fe&&(ue=ve=fe.radius),"width"in fe&&(ue=fe.width),"height"in fe&&(ve=fe.height);("color"in fe||"colors"in fe)&&(de=fe.color||fe.colors,Array.isArray(de)&&i(de.length===1||t.webgl_draw_buffers,"multiple render targets not supported")),de||("colorCount"in fe&&(Ge=fe.colorCount|0,i(Ge>0,"invalid color buffer count")),"colorTexture"in fe&&(Oe=!!fe.colorTexture,ye="rgba4"),"colorType"in fe&&(we=fe.colorType,Oe?(i(t.oes_texture_float||!(we==="float"||we==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),i(t.oes_texture_half_float||!(we==="half float"||we==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):we==="half float"||we==="float16"?(i(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ye="rgba16f"):(we==="float"||we==="float32")&&(i(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ye="rgba32f"),i.oneOf(we,z,"invalid color type")),"colorFormat"in fe&&(ye=fe.colorFormat,N.indexOf(ye)>=0?Oe=!0:I.indexOf(ye)>=0?Oe=!1:Oe?i.oneOf(fe.colorFormat,N,"invalid color format for texture"):i.oneOf(fe.colorFormat,I,"invalid color format for renderbuffer"))),("depthTexture"in fe||"depthStencilTexture"in fe)&&(Fe=!!(fe.depthTexture||fe.depthStencilTexture),i(!Fe||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in fe&&(typeof fe.depth=="boolean"?Le=fe.depth:(Ce=fe.depth,De=!1)),"stencil"in fe&&(typeof fe.stencil=="boolean"?De=fe.stencil:(Ne=fe.stencil,Le=!1)),"depthStencil"in fe&&(typeof fe.depthStencil=="boolean"?Le=De=fe.depthStencil:(Pe=fe.depthStencil,Le=!1,De=!1))}var _e=null,ee=null,le=null,he=null;if(Array.isArray(de))_e=de.map(V);else if(de)_e=[V(de)];else for(_e=new Array(Ge),ae=0;ae<Ge;++ae)_e[ae]=v(ue,ve,Oe,ye,we);i(t.webgl_draw_buffers||_e.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),i(_e.length<=s.maxColorAttachments,"too many color attachments, not supported"),ue=ue||_e[0].width,ve=ve||_e[0].height,Ce?ee=V(Ce):Le&&!De&&(ee=v(ue,ve,Fe,"depth","uint32")),Ne?le=V(Ne):De&&!Le&&(le=v(ue,ve,!1,"stencil","uint8")),Pe?he=V(Pe):!Ce&&!Ne&&De&&Le&&(he=v(ue,ve,Fe,"depth stencil","depth stencil")),i(!!Ce+!!Ne+!!Pe<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ae=null;for(ae=0;ae<_e.length;++ae)if(j(_e[ae],ue,ve),i(!_e[ae]||_e[ae].texture&&Nu.indexOf(_e[ae].texture._texture.format)>=0||_e[ae].renderbuffer&&Hu.indexOf(_e[ae].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ae+" is invalid"),_e[ae]&&_e[ae].texture){var Ke=sn[_e[ae].texture._texture.format]*yt[_e[ae].texture._texture.type];Ae===null?Ae=Ke:i(Ae===Ke,"all color attachments much have the same number of bits per pixel.")}return j(ee,ue,ve),i(!ee||ee.texture&&ee.texture._texture.format===Du||ee.renderbuffer&&ee.renderbuffer._renderbuffer.format===Pu,"invalid depth attachment for framebuffer object"),j(le,ue,ve),i(!le||le.renderbuffer&&le.renderbuffer._renderbuffer.format===Mu,"invalid stencil attachment for framebuffer object"),j(he,ue,ve),i(!he||he.texture&&he.texture._texture.format===ei||he.renderbuffer&&he.renderbuffer._renderbuffer.format===ei,"invalid depth-stencil attachment for framebuffer object"),k(w),w.width=ue,w.height=ve,w.colorAttachments=_e,w.depthAttachment=ee,w.stencilAttachment=le,w.depthStencilAttachment=he,ne.color=_e.map(A),ne.depth=A(ee),ne.stencil=A(le),ne.depthStencil=A(he),ne.width=w.width,ne.height=w.height,G(w),ne}function me(K,se){i(S.next!==w,"can not resize a framebuffer which is currently in use");var ae=Math.max(K|0,1),ue=Math.max(se|0||ae,1);if(ae===w.width&&ue===w.height)return ne;for(var ve=w.colorAttachments,Le=0;Le<ve.length;++Le)B(ve[Le],ae,ue);return B(w.depthAttachment,ae,ue),B(w.stencilAttachment,ae,ue),B(w.depthStencilAttachment,ae,ue),w.width=ne.width=ae,w.height=ne.height=ue,G(w),ne}return ne($,P),xe(ne,{resize:me,_reglType:"framebuffer",_framebuffer:w,destroy:function(){W(w),k(w)},use:function(K){S.setFBO({framebuffer:ne},K)}})}function J($){var P=Array(6);function w(me){var K;i(P.indexOf(S.next)<0,"can not update framebuffer which is currently in use");var se={color:null},ae=0,ue=null,ve="rgba",Le="uint8",De=1;if(typeof me=="number")ae=me|0;else if(!me)ae=1;else{i.type(me,"object","invalid arguments for framebuffer");var de=me;if("shape"in de){var Oe=de.shape;i(Array.isArray(Oe)&&Oe.length>=2,"invalid shape for framebuffer"),i(Oe[0]===Oe[1],"cube framebuffer must be square"),ae=Oe[0]}else"radius"in de&&(ae=de.radius|0),"width"in de?(ae=de.width|0,"height"in de&&i(de.height===ae,"must be square")):"height"in de&&(ae=de.height|0);("color"in de||"colors"in de)&&(ue=de.color||de.colors,Array.isArray(ue)&&i(ue.length===1||t.webgl_draw_buffers,"multiple render targets not supported")),ue||("colorCount"in de&&(De=de.colorCount|0,i(De>0,"invalid color buffer count")),"colorType"in de&&(i.oneOf(de.colorType,z,"invalid color type"),Le=de.colorType),"colorFormat"in de&&(ve=de.colorFormat,i.oneOf(de.colorFormat,N,"invalid color format for texture"))),"depth"in de&&(se.depth=de.depth),"stencil"in de&&(se.stencil=de.stencil),"depthStencil"in de&&(se.depthStencil=de.depthStencil)}var ye;if(ue)if(Array.isArray(ue))for(ye=[],K=0;K<ue.length;++K)ye[K]=ue[K];else ye=[ue];else{ye=Array(De);var we={radius:ae,format:ve,type:Le};for(K=0;K<De;++K)ye[K]=y.createCube(we)}for(se.color=Array(ye.length),K=0;K<ye.length;++K){var Ge=ye[K];i(typeof Ge=="function"&&Ge._reglType==="textureCube","invalid cube map"),ae=ae||Ge.width,i(Ge.width===ae&&Ge.height===ae,"invalid cube map shape"),se.color[K]={target:bt,data:ye[K]}}for(K=0;K<6;++K){for(var Ce=0;Ce<ye.length;++Ce)se.color[Ce].target=bt+K;K>0&&(se.depth=P[0].depth,se.stencil=P[0].stencil,se.depthStencil=P[0].depthStencil),P[K]?P[K](se):P[K]=H(se)}return xe(w,{width:ae,height:ae,color:ye})}function ne(me){var K,se=me|0;if(i(se>0&&se<=s.maxCubeMapSize,"invalid radius for cube fbo"),se===w.width)return w;var ae=w.color;for(K=0;K<ae.length;++K)ae[K].resize(se);for(K=0;K<6;++K)P[K].resize(se);return w.width=w.height=se,w}return w($),xe(w,{faces:P,resize:ne,_reglType:"framebufferCube",destroy:function(){P.forEach(function(me){me.destroy()})}})}function te(){S.cur=null,S.next=null,S.dirty=!0,ze(O).forEach(function($){$.framebuffer=e.createFramebuffer(),G($)})}return xe(S,{getFramebuffer:function($){if(typeof $=="function"&&$._reglType==="framebuffer"){var P=$._framebuffer;if(P instanceof Y)return P}return null},create:H,createCube:J,clear:function(){ze(O).forEach(W)},restore:te})}var $u=5126,ri=34962;function cn(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=$u,this.offset=0,this.stride=0,this.divisor=0}function Wu(e,t,s,y,L){for(var E=s.maxAttributes,S=new Array(E),N=0;N<E;++N)S[N]=new cn;var I=0,z={},M={Record:cn,scope:{},state:S,currentVAO:null,targetVAO:null,restore:j()?O:function(){},createVAO:Y,getVAO:V,destroyBuffer:U,setVAO:j()?v:A,clear:j()?B:function(){}};function U(k){for(var W=0;W<S.length;++W){var G=S[W];G.buffer===k&&(e.disableVertexAttribArray(W),G.buffer=null)}}function j(){return t.oes_vertex_array_object}function F(){return t.angle_instanced_arrays}function V(k){return typeof k=="function"&&k._vao?k._vao:null}function v(k){if(k!==M.currentVAO){var W=j();k?W.bindVertexArrayOES(k.vao):W.bindVertexArrayOES(null),M.currentVAO=k}}function A(k){if(k!==M.currentVAO){if(k)k.bindAttrs();else for(var W=F(),G=0;G<S.length;++G){var H=S[G];H.buffer?(e.enableVertexAttribArray(G),e.vertexAttribPointer(G,H.size,H.type,H.normalized,H.stride,H.offfset),W&&W.vertexAttribDivisorANGLE(G,H.divisor)):(e.disableVertexAttribArray(G),e.vertexAttrib4f(G,H.x,H.y,H.z,H.w))}M.currentVAO=k}}function B(){ze(z).forEach(function(k){k.destroy()})}function X(){this.id=++I,this.attributes=[];var k=j();k?this.vao=k.createVertexArrayOES():this.vao=null,z[this.id]=this,this.buffers=[]}X.prototype.bindAttrs=function(){for(var k=F(),W=this.attributes,G=0;G<W.length;++G){var H=W[G];H.buffer?(e.enableVertexAttribArray(G),e.bindBuffer(ri,H.buffer.buffer),e.vertexAttribPointer(G,H.size,H.type,H.normalized,H.stride,H.offset),k&&k.vertexAttribDivisorANGLE(G,H.divisor)):(e.disableVertexAttribArray(G),e.vertexAttrib4f(G,H.x,H.y,H.z,H.w))}for(var J=W.length;J<E;++J)e.disableVertexAttribArray(J)},X.prototype.refresh=function(){var k=j();k&&(k.bindVertexArrayOES(this.vao),this.bindAttrs(),M.currentVAO=this)},X.prototype.destroy=function(){if(this.vao){var k=j();this===M.currentVAO&&(M.currentVAO=null,k.bindVertexArrayOES(null)),k.deleteVertexArrayOES(this.vao),this.vao=null}z[this.id]&&(delete z[this.id],y.vaoCount-=1)};function O(){var k=j();k&&ze(z).forEach(function(W){W.refresh()})}function Y(k){var W=new X;y.vaoCount+=1;function G(H){i(Array.isArray(H),"arguments to vertex array constructor must be an array"),i(H.length<E,"too many attributes"),i(H.length>0,"must specify at least one attribute");for(var J=0;J<W.buffers.length;++J)W.buffers[J].destroy();W.buffers.length=0;var te=W.attributes;te.length=H.length;for(var $=0;$<H.length;++$){var P=H[$],w=te[$]=new cn;if(Array.isArray(P)||Be(P)||We(P)){var ne=L.create(P,ri,!1,!0);w.buffer=L.getBuffer(ne),w.size=w.buffer.dimension|0,w.normalized=!1,w.type=w.buffer.dtype,w.offset=0,w.stride=0,w.divisor=0,w.state=1,W.buffers.push(ne)}else L.getBuffer(P)?(w.buffer=L.getBuffer(P),w.size=w.buffer.dimension|0,w.normalized=!1,w.type=w.buffer.dtype,w.offset=0,w.stride=0,w.divisor=0,w.state=1):L.getBuffer(P.buffer)?(w.buffer=L.getBuffer(P.buffer),w.size=(+P.size||w.buffer.dimension)|0,w.normalized=!!P.normalized||!1,"type"in P?(i.parameter(P.type,lr,"invalid buffer type"),w.type=lr[P.type]):w.type=w.buffer.dtype,w.offset=(P.offset||0)|0,w.stride=(P.stride||0)|0,w.divisor=(P.divisor||0)|0,w.state=1,i(w.size>=1&&w.size<=4,"size must be between 1 and 4"),i(w.offset>=0,"invalid offset"),i(w.stride>=0&&w.stride<=255,"stride must be between 0 and 255"),i(w.divisor>=0,"divisor must be positive"),i(!w.divisor||!!t.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in P?(i($>0,"first attribute must not be a constant"),w.x=+P.x||0,w.y=+P.y||0,w.z=+P.z||0,w.w=+P.w||0,w.state=2):i(!1,"invalid attribute spec for location "+$)}return W.refresh(),G}return G.destroy=function(){W.destroy()},G._vao=W,G._reglType="vao",G(k)}return M}var ti=35632,Yu=35633,Qu=35718,qu=35721;function Ku(e,t,s,y){var L={},E={};function S(v,A,B,X){this.name=v,this.id=A,this.location=B,this.info=X}function N(v,A){for(var B=0;B<v.length;++B)if(v[B].id===A.id){v[B].location=A.location;return}v.push(A)}function I(v,A,B){var X=v===ti?L:E,O=X[A];if(!O){var Y=t.str(A);O=e.createShader(v),e.shaderSource(O,Y),e.compileShader(O),i.shaderError(e,O,Y,v,B),X[A]=O}return O}var z={},M=[],U=0;function j(v,A){this.id=U++,this.fragId=v,this.vertId=A,this.program=null,this.uniforms=[],this.attributes=[],y.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function F(v,A,B){var X,O,Y=I(ti,v.fragId),k=I(Yu,v.vertId),W=v.program=e.createProgram();if(e.attachShader(W,Y),e.attachShader(W,k),B)for(X=0;X<B.length;++X){var G=B[X];e.bindAttribLocation(W,G[0],G[1])}e.linkProgram(W),i.linkError(e,W,t.str(v.fragId),t.str(v.vertId),A);var H=e.getProgramParameter(W,Qu);y.profile&&(v.stats.uniformsCount=H);var J=v.uniforms;for(X=0;X<H;++X)if(O=e.getActiveUniform(W,X),O)if(O.size>1)for(var te=0;te<O.size;++te){var $=O.name.replace("[0]","["+te+"]");N(J,new S($,t.id($),e.getUniformLocation(W,$),O))}else N(J,new S(O.name,t.id(O.name),e.getUniformLocation(W,O.name),O));var P=e.getProgramParameter(W,qu);y.profile&&(v.stats.attributesCount=P);var w=v.attributes;for(X=0;X<P;++X)O=e.getActiveAttrib(W,X),O&&N(w,new S(O.name,t.id(O.name),e.getAttribLocation(W,O.name),O))}y.profile&&(s.getMaxUniformsCount=function(){var v=0;return M.forEach(function(A){A.stats.uniformsCount>v&&(v=A.stats.uniformsCount)}),v},s.getMaxAttributesCount=function(){var v=0;return M.forEach(function(A){A.stats.attributesCount>v&&(v=A.stats.attributesCount)}),v});function V(){L={},E={};for(var v=0;v<M.length;++v)F(M[v],null,M[v].attributes.map(function(A){return[A.location,A.name]}))}return{clear:function(){var v=e.deleteShader.bind(e);ze(L).forEach(v),L={},ze(E).forEach(v),E={},M.forEach(function(A){e.deleteProgram(A.program)}),M.length=0,z={},s.shaderCount=0},program:function(v,A,B,X){i.command(v>=0,"missing vertex shader",B),i.command(A>=0,"missing fragment shader",B);var O=z[A];O||(O=z[A]={});var Y=O[v];if(Y&&!X)return Y;var k=new j(A,v);return s.shaderCount++,F(k,B,X),Y||(O[v]=k),M.push(k),k},restore:V,shader:I,frag:-1,vert:-1}}var Zu=6408,jr=5121,Ju=3333,Et=5126;function es(e,t,s,y,L,E,S){function N(M){var U;t.next===null?(i(L.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),U=jr):(i(t.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),U=t.next.colorAttachments[0].texture._texture.type,E.oes_texture_float?(i(U===jr||U===Et,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),U===Et&&i(S.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):i(U===jr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var j=0,F=0,V=y.framebufferWidth,v=y.framebufferHeight,A=null;Be(M)?A=M:M&&(i.type(M,"object","invalid arguments to regl.read()"),j=M.x|0,F=M.y|0,i(j>=0&&j<y.framebufferWidth,"invalid x offset for regl.read"),i(F>=0&&F<y.framebufferHeight,"invalid y offset for regl.read"),V=(M.width||y.framebufferWidth-j)|0,v=(M.height||y.framebufferHeight-F)|0,A=M.data||null),A&&(U===jr?i(A instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):U===Et&&i(A instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),i(V>0&&V+j<=y.framebufferWidth,"invalid width for read pixels"),i(v>0&&v+F<=y.framebufferHeight,"invalid height for read pixels"),s();var B=V*v*4;return A||(U===jr?A=new Uint8Array(B):U===Et&&(A=A||new Float32Array(B))),i.isTypedArray(A,"data buffer for regl.read() must be a typedarray"),i(A.byteLength>=B,"data buffer for regl.read() too small"),e.pixelStorei(Ju,4),e.readPixels(j,F,V,v,Zu,U,A),A}function I(M){var U;return t.setFBO({framebuffer:M.framebuffer},function(){U=N(M)}),U}function z(M){return!M||!("framebuffer"in M)?N(M):I(M)}return z}function Gr(e){return Array.prototype.slice.call(e)}function Cr(e){return Gr(e).join("")}function rs(){var e=0,t=[],s=[];function y(U){for(var j=0;j<s.length;++j)if(s[j]===U)return t[j];var F="g"+e++;return t.push(F),s.push(U),F}function L(){var U=[];function j(){U.push.apply(U,Gr(arguments))}var F=[];function V(){var v="v"+e++;return F.push(v),arguments.length>0&&(U.push(v,"="),U.push.apply(U,Gr(arguments)),U.push(";")),v}return xe(j,{def:V,toString:function(){return Cr([F.length>0?"var "+F.join(",")+";":"",Cr(U)])}})}function E(){var U=L(),j=L(),F=U.toString,V=j.toString;function v(A,B){j(A,B,"=",U.def(A,B),";")}return xe(function(){U.apply(U,Gr(arguments))},{def:U.def,entry:U,exit:j,save:v,set:function(A,B,X){v(A,B),U(A,B,"=",X,";")},toString:function(){return F()+V()}})}function S(){var U=Cr(arguments),j=E(),F=E(),V=j.toString,v=F.toString;return xe(j,{then:function(){return j.apply(j,Gr(arguments)),this},else:function(){return F.apply(F,Gr(arguments)),this},toString:function(){var A=v();return A&&(A="else{"+A+"}"),Cr(["if(",U,"){",V(),"}",A])}})}var N=L(),I={};function z(U,j){var F=[];function V(){var O="a"+F.length;return F.push(O),O}j=j||0;for(var v=0;v<j;++v)V();var A=E(),B=A.toString,X=I[U]=xe(A,{arg:V,toString:function(){return Cr(["function(",F.join(),"){",B(),"}"])}});return X}function M(){var U=['"use strict";',N,"return {"];Object.keys(I).forEach(function(V){U.push('"',V,'":',I[V].toString(),",")}),U.push("}");var j=Cr(U).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),F=Function.apply(null,t.concat(j));return F.apply(null,s)}return{global:N,link:y,block:L,proc:z,scope:E,cond:S,compile:M}}var Fr="xyzw".split(""),ni=5121,Dr=1,ln=2,ai=0,ii=1,fi=2,oi=3,dn=4,ui="dither",si="blend.enable",ci="blend.color",mn="blend.equation",hn="blend.func",li="depth.enable",di="depth.func",mi="depth.range",hi="depth.mask",vn="colorMask",vi="cull.enable",pi="cull.face",pn="frontFace",_n="lineWidth",_i="polygonOffset.enable",bn="polygonOffset.offset",bi="sample.alpha",yi="sample.enable",yn="sample.coverage",Ei="stencil.enable",xi="stencil.mask",En="stencil.func",xn="stencil.opFront",Hr="stencil.opBack",Ti="scissor.enable",xt="scissor.box",rr="viewport",Xr="profile",pr="framebuffer",$r="vert",Wr="frag",_r="elements",br="primitive",yr="count",Tt="offset",At="instances",Yr="vao",Tn="Width",An="Height",Nr=pr+Tn,Br=pr+An,ts=rr+Tn,ns=rr+An,Ai="drawingBuffer",Si=Ai+Tn,gi=Ai+An,as=[hn,mn,En,xn,Hr,yn,rr,xt,bn],Ir=34962,is=34963,fs=35632,os=35633,Li=3553,us=34067,ss=2884,cs=3042,ls=3024,ds=2960,ms=2929,hs=3089,vs=32823,ps=32926,_s=32928,Sn=5126,St=35664,gt=35665,Lt=35666,gn=5124,wt=35667,Rt=35668,Ot=35669,Ln=35670,Gt=35671,Ct=35672,Ft=35673,Qr=35674,qr=35675,Kr=35676,Zr=35678,Jr=35680,wi=4,et=1028,Er=1029,Ri=2304,wn=2305,bs=32775,ys=32776,Es=519,ir=7680,Oi=0,Gi=1,Ci=32774,xs=513,Fi=36160,Ts=36064,qe={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Di=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],kr={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},fr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ni={frag:fs,vert:os},Rn={cw:Ri,ccw:wn};function Dt(e){return Array.isArray(e)||Be(e)||We(e)}function Bi(e){return e.sort(function(t,s){return t===rr?-1:s===rr?1:t<s?-1:1})}function je(e,t,s,y){this.thisDep=e,this.contextDep=t,this.propDep=s,this.append=y}function or(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ge(e){return new je(!1,!1,!1,e)}function Me(e,t){var s=e.type;if(s===ai){var y=e.data.length;return new je(!0,y>=1,y>=2,t)}else if(s===dn){var L=e.data;return new je(L.thisDep,L.contextDep,L.propDep,t)}else return new je(s===oi,s===fi,s===ii,t)}var Ii=new je(!1,!1,!1,function(){});function As(e,t,s,y,L,E,S,N,I,z,M,U,j,F,V){var v=z.Record,A={add:32774,subtract:32778,"reverse subtract":32779};s.ext_blend_minmax&&(A.min=bs,A.max=ys);var B=s.angle_instanced_arrays,X=s.webgl_draw_buffers,O={dirty:!0,profile:V.profile},Y={},k=[],W={},G={};function H(r){return r.replace(".","_")}function J(r,a,u){var b=H(r);k.push(r),Y[b]=O[b]=!!u,W[b]=a}function te(r,a,u){var b=H(r);k.push(r),Array.isArray(u)?(O[b]=u.slice(),Y[b]=u.slice()):O[b]=Y[b]=u,G[b]=a}J(ui,ls),J(si,cs),te(ci,"blendColor",[0,0,0,0]),te(mn,"blendEquationSeparate",[Ci,Ci]),te(hn,"blendFuncSeparate",[Gi,Oi,Gi,Oi]),J(li,ms,!0),te(di,"depthFunc",xs),te(mi,"depthRange",[0,1]),te(hi,"depthMask",!0),te(vn,vn,[!0,!0,!0,!0]),J(vi,ss),te(pi,"cullFace",Er),te(pn,pn,wn),te(_n,_n,1),J(_i,vs),te(bn,"polygonOffset",[0,0]),J(bi,ps),J(yi,_s),te(yn,"sampleCoverage",[1,!1]),J(Ei,ds),te(xi,"stencilMask",-1),te(En,"stencilFunc",[Es,0,-1]),te(xn,"stencilOpSeparate",[et,ir,ir,ir]),te(Hr,"stencilOpSeparate",[Er,ir,ir,ir]),J(Ti,hs),te(xt,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),te(rr,rr,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var $={gl:e,context:j,strings:t,next:Y,current:O,draw:U,elements:E,buffer:L,shader:M,attributes:z.state,vao:z,uniforms:I,framebuffer:N,extensions:s,timer:F,isBufferArgs:Dt},P={primTypes:Tr,compareFuncs:kr,blendFuncs:qe,blendEquations:A,stencilOps:fr,glTypes:lr,orientationType:Rn};i.optional(function(){$.isArrayLike=Te}),X&&(P.backBuffer=[Er],P.drawBuffer=Ve(y.maxDrawbuffers,function(r){return r===0?[0]:Ve(r,function(a){return Ts+a})}));var w=0;function ne(){var r=rs(),a=r.link,u=r.global;r.id=w++,r.batchId="0";var b=a($),p=r.shared={props:"a0"};Object.keys($).forEach(function(l){p[l]=u.def(b,".",l)}),i.optional(function(){r.CHECK=a(i),r.commandStr=i.guessCommand(),r.command=a(r.commandStr),r.assert=function(l,n,d){l("if(!(",n,"))",this.CHECK,".commandRaise(",a(d),",",this.command,");")},P.invalidBlendCombinations=Di});var c=r.next={},m=r.current={};Object.keys(G).forEach(function(l){Array.isArray(O[l])&&(c[l]=u.def(p.next,".",l),m[l]=u.def(p.current,".",l))});var h=r.constants={};Object.keys(P).forEach(function(l){h[l]=u.def(JSON.stringify(P[l]))}),r.invoke=function(l,n){switch(n.type){case ai:var d=["this",p.context,p.props,r.batchId];return l.def(a(n.data),".call(",d.slice(0,Math.max(n.data.length+1,4)),")");case ii:return l.def(p.props,n.data);case fi:return l.def(p.context,n.data);case oi:return l.def("this",n.data);case dn:return n.data.append(r,l),n.data.ref}},r.attribCache={};var o={};return r.scopeAttrib=function(l){var n=t.id(l);if(n in o)return o[n];var d=z.scope[n];d||(d=z.scope[n]=new v);var x=o[n]=a(d);return x},r}function me(r){var a=r.static,u=r.dynamic,b;if(Xr in a){var p=!!a[Xr];b=ge(function(m,h){return p}),b.enable=p}else if(Xr in u){var c=u[Xr];b=Me(c,function(m,h){return m.invoke(h,c)})}return b}function K(r,a){var u=r.static,b=r.dynamic;if(pr in u){var p=u[pr];return p?(p=N.getFramebuffer(p),i.command(p,"invalid framebuffer object"),ge(function(m,h){var o=m.link(p),l=m.shared;h.set(l.framebuffer,".next",o);var n=l.context;return h.set(n,"."+Nr,o+".width"),h.set(n,"."+Br,o+".height"),o})):ge(function(m,h){var o=m.shared;h.set(o.framebuffer,".next","null");var l=o.context;return h.set(l,"."+Nr,l+"."+Si),h.set(l,"."+Br,l+"."+gi),"null"})}else if(pr in b){var c=b[pr];return Me(c,function(m,h){var o=m.invoke(h,c),l=m.shared,n=l.framebuffer,d=h.def(n,".getFramebuffer(",o,")");i.optional(function(){m.assert(h,"!"+o+"||"+d,"invalid framebuffer object")}),h.set(n,".next",d);var x=l.context;return h.set(x,"."+Nr,d+"?"+d+".width:"+x+"."+Si),h.set(x,"."+Br,d+"?"+d+".height:"+x+"."+gi),d})}else return null}function se(r,a,u){var b=r.static,p=r.dynamic;function c(o){if(o in b){var l=b[o];i.commandType(l,"object","invalid "+o,u.commandStr);var n=!0,d=l.x|0,x=l.y|0,g,C;return"width"in l?(g=l.width|0,i.command(g>=0,"invalid "+o,u.commandStr)):n=!1,"height"in l?(C=l.height|0,i.command(C>=0,"invalid "+o,u.commandStr)):n=!1,new je(!n&&a&&a.thisDep,!n&&a&&a.contextDep,!n&&a&&a.propDep,function(Z,oe){var q=Z.shared.context,re=g;"width"in l||(re=oe.def(q,".",Nr,"-",d));var ie=C;return"height"in l||(ie=oe.def(q,".",Br,"-",x)),[d,x,re,ie]})}else if(o in p){var R=p[o],D=Me(R,function(Z,oe){var q=Z.invoke(oe,R);i.optional(function(){Z.assert(oe,q+"&&typeof "+q+'==="object"',"invalid "+o)});var re=Z.shared.context,ie=oe.def(q,".x|0"),pe=oe.def(q,".y|0"),Re=oe.def('"width" in ',q,"?",q,".width|0:","(",re,".",Nr,"-",ie,")"),Qe=oe.def('"height" in ',q,"?",q,".height|0:","(",re,".",Br,"-",pe,")");return i.optional(function(){Z.assert(oe,Re+">=0&&"+Qe+">=0","invalid "+o)}),[ie,pe,Re,Qe]});return a&&(D.thisDep=D.thisDep||a.thisDep,D.contextDep=D.contextDep||a.contextDep,D.propDep=D.propDep||a.propDep),D}else return a?new je(a.thisDep,a.contextDep,a.propDep,function(Z,oe){var q=Z.shared.context;return[0,0,oe.def(q,".",Nr),oe.def(q,".",Br)]}):null}var m=c(rr);if(m){var h=m;m=new je(m.thisDep,m.contextDep,m.propDep,function(o,l){var n=h.append(o,l),d=o.shared.context;return l.set(d,"."+ts,n[2]),l.set(d,"."+ns,n[3]),n})}return{viewport:m,scissor_box:c(xt)}}function ae(r,a){var u=r.static,b=typeof u[Wr]=="string"&&typeof u[$r]=="string";if(b){if(Object.keys(a.dynamic).length>0)return null;var p=a.static,c=Object.keys(p);if(c.length>0&&typeof p[c[0]]=="number"){for(var m=[],h=0;h<c.length;++h)i(typeof p[c[h]]=="number","must specify all vertex attribute locations when using vaos"),m.push([p[c[h]]|0,c[h]]);return m}}return null}function ue(r,a,u){var b=r.static,p=r.dynamic;function c(n){if(n in b){var d=t.id(b[n]);i.optional(function(){M.shader(Ni[n],d,i.guessCommand())});var x=ge(function(){return d});return x.id=d,x}else if(n in p){var g=p[n];return Me(g,function(C,R){var D=C.invoke(R,g),Z=R.def(C.shared.strings,".id(",D,")");return i.optional(function(){R(C.shared.shader,".shader(",Ni[n],",",Z,",",C.command,");")}),Z})}return null}var m=c(Wr),h=c($r),o=null,l;return or(m)&&or(h)?(o=M.program(h.id,m.id,null,u),l=ge(function(n,d){return n.link(o)})):l=new je(m&&m.thisDep||h&&h.thisDep,m&&m.contextDep||h&&h.contextDep,m&&m.propDep||h&&h.propDep,function(n,d){var x=n.shared.shader,g;m?g=m.append(n,d):g=d.def(x,".",Wr);var C;h?C=h.append(n,d):C=d.def(x,".",$r);var R=x+".program("+C+","+g;return i.optional(function(){R+=","+n.command}),d.def(R+")")}),{frag:m,vert:h,progVar:l,program:o}}function ve(r,a){var u=r.static,b=r.dynamic;function p(){if(_r in u){var n=u[_r];Dt(n)?n=E.getElements(E.create(n,!0)):n&&(n=E.getElements(n),i.command(n,"invalid elements",a.commandStr));var d=ge(function(g,C){if(n){var R=g.link(n);return g.ELEMENTS=R,R}return g.ELEMENTS=null,null});return d.value=n,d}else if(_r in b){var x=b[_r];return Me(x,function(g,C){var R=g.shared,D=R.isBufferArgs,Z=R.elements,oe=g.invoke(C,x),q=C.def("null"),re=C.def(D,"(",oe,")"),ie=g.cond(re).then(q,"=",Z,".createStream(",oe,");").else(q,"=",Z,".getElements(",oe,");");return i.optional(function(){g.assert(ie.else,"!"+oe+"||"+q,"invalid elements")}),C.entry(ie),C.exit(g.cond(re).then(Z,".destroyStream(",q,");")),g.ELEMENTS=q,q})}return null}var c=p();function m(){if(br in u){var n=u[br];return i.commandParameter(n,Tr,"invalid primitve",a.commandStr),ge(function(x,g){return Tr[n]})}else if(br in b){var d=b[br];return Me(d,function(x,g){var C=x.constants.primTypes,R=x.invoke(g,d);return i.optional(function(){x.assert(g,R+" in "+C,"invalid primitive, must be one of "+Object.keys(Tr))}),g.def(C,"[",R,"]")})}else if(c)return or(c)?c.value?ge(function(x,g){return g.def(x.ELEMENTS,".primType")}):ge(function(){return wi}):new je(c.thisDep,c.contextDep,c.propDep,function(x,g){var C=x.ELEMENTS;return g.def(C,"?",C,".primType:",wi)});return null}function h(n,d){if(n in u){var x=u[n]|0;return i.command(!d||x>=0,"invalid "+n,a.commandStr),ge(function(C,R){return d&&(C.OFFSET=x),x})}else if(n in b){var g=b[n];return Me(g,function(C,R){var D=C.invoke(R,g);return d&&(C.OFFSET=D,i.optional(function(){C.assert(R,D+">=0","invalid "+n)})),D})}else if(d&&c)return ge(function(C,R){return C.OFFSET="0",0});return null}var o=h(Tt,!0);function l(){if(yr in u){var n=u[yr]|0;return i.command(typeof n=="number"&&n>=0,"invalid vertex count",a.commandStr),ge(function(){return n})}else if(yr in b){var d=b[yr];return Me(d,function(C,R){var D=C.invoke(R,d);return i.optional(function(){C.assert(R,"typeof "+D+'==="number"&&'+D+">=0&&"+D+"===("+D+"|0)","invalid vertex count")}),D})}else if(c)if(or(c)){if(c)return o?new je(o.thisDep,o.contextDep,o.propDep,function(C,R){var D=R.def(C.ELEMENTS,".vertCount-",C.OFFSET);return i.optional(function(){C.assert(R,D+">=0","invalid vertex offset/element buffer too small")}),D}):ge(function(C,R){return R.def(C.ELEMENTS,".vertCount")});var x=ge(function(){return-1});return i.optional(function(){x.MISSING=!0}),x}else{var g=new je(c.thisDep||o.thisDep,c.contextDep||o.contextDep,c.propDep||o.propDep,function(C,R){var D=C.ELEMENTS;return C.OFFSET?R.def(D,"?",D,".vertCount-",C.OFFSET,":-1"):R.def(D,"?",D,".vertCount:-1")});return i.optional(function(){g.DYNAMIC=!0}),g}return null}return{elements:c,primitive:m(),count:l(),instances:h(At,!1),offset:o}}function Le(r,a){var u=r.static,b=r.dynamic,p={};return k.forEach(function(c){var m=H(c);function h(o,l){if(c in u){var n=o(u[c]);p[m]=ge(function(){return n})}else if(c in b){var d=b[c];p[m]=Me(d,function(x,g){return l(x,g,x.invoke(g,d))})}}switch(c){case vi:case si:case ui:case Ei:case li:case Ti:case _i:case bi:case yi:case hi:return h(function(o){return i.commandType(o,"boolean",c,a.commandStr),o},function(o,l,n){return i.optional(function(){o.assert(l,"typeof "+n+'==="boolean"',"invalid flag "+c,o.commandStr)}),n});case di:return h(function(o){return i.commandParameter(o,kr,"invalid "+c,a.commandStr),kr[o]},function(o,l,n){var d=o.constants.compareFuncs;return i.optional(function(){o.assert(l,n+" in "+d,"invalid "+c+", must be one of "+Object.keys(kr))}),l.def(d,"[",n,"]")});case mi:return h(function(o){return i.command(Te(o)&&o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number"&&o[0]<=o[1],"depth range is 2d array",a.commandStr),o},function(o,l,n){i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")});var d=l.def("+",n,"[0]"),x=l.def("+",n,"[1]");return[d,x]});case hn:return h(function(o){i.commandType(o,"object","blend.func",a.commandStr);var l="srcRGB"in o?o.srcRGB:o.src,n="srcAlpha"in o?o.srcAlpha:o.src,d="dstRGB"in o?o.dstRGB:o.dst,x="dstAlpha"in o?o.dstAlpha:o.dst;return i.commandParameter(l,qe,m+".srcRGB",a.commandStr),i.commandParameter(n,qe,m+".srcAlpha",a.commandStr),i.commandParameter(d,qe,m+".dstRGB",a.commandStr),i.commandParameter(x,qe,m+".dstAlpha",a.commandStr),i.command(Di.indexOf(l+", "+d)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+l+", "+d+")",a.commandStr),[qe[l],qe[d],qe[n],qe[x]]},function(o,l,n){var d=o.constants.blendFuncs;i.optional(function(){o.assert(l,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")});function x(q,re){var ie=l.def('"',q,re,'" in ',n,"?",n,".",q,re,":",n,".",q);return i.optional(function(){o.assert(l,ie+" in "+d,"invalid "+c+"."+q+re+", must be one of "+Object.keys(qe))}),ie}var g=x("src","RGB"),C=x("dst","RGB");i.optional(function(){var q=o.constants.invalidBlendCombinations;o.assert(l,q+".indexOf("+g+'+", "+'+C+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var R=l.def(d,"[",g,"]"),D=l.def(d,"[",x("src","Alpha"),"]"),Z=l.def(d,"[",C,"]"),oe=l.def(d,"[",x("dst","Alpha"),"]");return[R,Z,D,oe]});case mn:return h(function(o){if(typeof o=="string")return i.commandParameter(o,A,"invalid "+c,a.commandStr),[A[o],A[o]];if(typeof o=="object")return i.commandParameter(o.rgb,A,c+".rgb",a.commandStr),i.commandParameter(o.alpha,A,c+".alpha",a.commandStr),[A[o.rgb],A[o.alpha]];i.commandRaise("invalid blend.equation",a.commandStr)},function(o,l,n){var d=o.constants.blendEquations,x=l.def(),g=l.def(),C=o.cond("typeof ",n,'==="string"');return i.optional(function(){function R(D,Z,oe){o.assert(D,oe+" in "+d,"invalid "+Z+", must be one of "+Object.keys(A))}R(C.then,c,n),o.assert(C.else,n+"&&typeof "+n+'==="object"',"invalid "+c),R(C.else,c+".rgb",n+".rgb"),R(C.else,c+".alpha",n+".alpha")}),C.then(x,"=",g,"=",d,"[",n,"];"),C.else(x,"=",d,"[",n,".rgb];",g,"=",d,"[",n,".alpha];"),l(C),[x,g]});case ci:return h(function(o){return i.command(Te(o)&&o.length===4,"blend.color must be a 4d array",a.commandStr),Ve(4,function(l){return+o[l]})},function(o,l,n){return i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")}),Ve(4,function(d){return l.def("+",n,"[",d,"]")})});case xi:return h(function(o){return i.commandType(o,"number",m,a.commandStr),o|0},function(o,l,n){return i.optional(function(){o.assert(l,"typeof "+n+'==="number"',"invalid stencil.mask")}),l.def(n,"|0")});case En:return h(function(o){i.commandType(o,"object",m,a.commandStr);var l=o.cmp||"keep",n=o.ref||0,d="mask"in o?o.mask:-1;return i.commandParameter(l,kr,c+".cmp",a.commandStr),i.commandType(n,"number",c+".ref",a.commandStr),i.commandType(d,"number",c+".mask",a.commandStr),[kr[l],n,d]},function(o,l,n){var d=o.constants.compareFuncs;i.optional(function(){function R(){o.assert(l,Array.prototype.join.call(arguments,""),"invalid stencil.func")}R(n+"&&typeof ",n,'==="object"'),R('!("cmp" in ',n,")||(",n,".cmp in ",d,")")});var x=l.def('"cmp" in ',n,"?",d,"[",n,".cmp]",":",ir),g=l.def(n,".ref|0"),C=l.def('"mask" in ',n,"?",n,".mask|0:-1");return[x,g,C]});case xn:case Hr:return h(function(o){i.commandType(o,"object",m,a.commandStr);var l=o.fail||"keep",n=o.zfail||"keep",d=o.zpass||"keep";return i.commandParameter(l,fr,c+".fail",a.commandStr),i.commandParameter(n,fr,c+".zfail",a.commandStr),i.commandParameter(d,fr,c+".zpass",a.commandStr),[c===Hr?Er:et,fr[l],fr[n],fr[d]]},function(o,l,n){var d=o.constants.stencilOps;i.optional(function(){o.assert(l,n+"&&typeof "+n+'==="object"',"invalid "+c)});function x(g){return i.optional(function(){o.assert(l,'!("'+g+'" in '+n+")||("+n+"."+g+" in "+d+")","invalid "+c+"."+g+", must be one of "+Object.keys(fr))}),l.def('"',g,'" in ',n,"?",d,"[",n,".",g,"]:",ir)}return[c===Hr?Er:et,x("fail"),x("zfail"),x("zpass")]});case bn:return h(function(o){i.commandType(o,"object",m,a.commandStr);var l=o.factor|0,n=o.units|0;return i.commandType(l,"number",m+".factor",a.commandStr),i.commandType(n,"number",m+".units",a.commandStr),[l,n]},function(o,l,n){i.optional(function(){o.assert(l,n+"&&typeof "+n+'==="object"',"invalid "+c)});var d=l.def(n,".factor|0"),x=l.def(n,".units|0");return[d,x]});case pi:return h(function(o){var l=0;return o==="front"?l=et:o==="back"&&(l=Er),i.command(!!l,m,a.commandStr),l},function(o,l,n){return i.optional(function(){o.assert(l,n+'==="front"||'+n+'==="back"',"invalid cull.face")}),l.def(n,'==="front"?',et,":",Er)});case _n:return h(function(o){return i.command(typeof o=="number"&&o>=y.lineWidthDims[0]&&o<=y.lineWidthDims[1],"invalid line width, must be a positive number between "+y.lineWidthDims[0]+" and "+y.lineWidthDims[1],a.commandStr),o},function(o,l,n){return i.optional(function(){o.assert(l,"typeof "+n+'==="number"&&'+n+">="+y.lineWidthDims[0]+"&&"+n+"<="+y.lineWidthDims[1],"invalid line width")}),n});case pn:return h(function(o){return i.commandParameter(o,Rn,m,a.commandStr),Rn[o]},function(o,l,n){return i.optional(function(){o.assert(l,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),l.def(n+'==="cw"?'+Ri+":"+wn)});case vn:return h(function(o){return i.command(Te(o)&&o.length===4,"color.mask must be length 4 array",a.commandStr),o.map(function(l){return!!l})},function(o,l,n){return i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")}),Ve(4,function(d){return"!!"+n+"["+d+"]"})});case yn:return h(function(o){i.command(typeof o=="object"&&o,m,a.commandStr);var l="value"in o?o.value:1,n=!!o.invert;return i.command(typeof l=="number"&&l>=0&&l<=1,"sample.coverage.value must be a number between 0 and 1",a.commandStr),[l,n]},function(o,l,n){i.optional(function(){o.assert(l,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")});var d=l.def('"value" in ',n,"?+",n,".value:1"),x=l.def("!!",n,".invert");return[d,x]})}}),p}function De(r,a){var u=r.static,b=r.dynamic,p={};return Object.keys(u).forEach(function(c){var m=u[c],h;if(typeof m=="number"||typeof m=="boolean")h=ge(function(){return m});else if(typeof m=="function"){var o=m._reglType;o==="texture2d"||o==="textureCube"?h=ge(function(l){return l.link(m)}):o==="framebuffer"||o==="framebufferCube"?(i.command(m.color.length>0,'missing color attachment for framebuffer sent to uniform "'+c+'"',a.commandStr),h=ge(function(l){return l.link(m.color[0])})):i.commandRaise('invalid data for uniform "'+c+'"',a.commandStr)}else Te(m)?h=ge(function(l){var n=l.global.def("[",Ve(m.length,function(d){return i.command(typeof m[d]=="number"||typeof m[d]=="boolean","invalid uniform "+c,l.commandStr),m[d]}),"]");return n}):i.commandRaise('invalid or missing data for uniform "'+c+'"',a.commandStr);h.value=m,p[c]=h}),Object.keys(b).forEach(function(c){var m=b[c];p[c]=Me(m,function(h,o){return h.invoke(o,m)})}),p}function de(r,a){var u=r.static,b=r.dynamic,p={};return Object.keys(u).forEach(function(c){var m=u[c],h=t.id(c),o=new v;if(Dt(m))o.state=Dr,o.buffer=L.getBuffer(L.create(m,Ir,!1,!0)),o.type=0;else{var l=L.getBuffer(m);if(l)o.state=Dr,o.buffer=l,o.type=0;else if(i.command(typeof m=="object"&&m,"invalid data for attribute "+c,a.commandStr),"constant"in m){var n=m.constant;o.buffer="null",o.state=ln,typeof n=="number"?o.x=n:(i.command(Te(n)&&n.length>0&&n.length<=4,"invalid constant for attribute "+c,a.commandStr),Fr.forEach(function(Z,oe){oe<n.length&&(o[Z]=n[oe])}))}else{Dt(m.buffer)?l=L.getBuffer(L.create(m.buffer,Ir,!1,!0)):l=L.getBuffer(m.buffer),i.command(!!l,'missing buffer for attribute "'+c+'"',a.commandStr);var d=m.offset|0;i.command(d>=0,'invalid offset for attribute "'+c+'"',a.commandStr);var x=m.stride|0;i.command(x>=0&&x<256,'invalid stride for attribute "'+c+'", must be integer betweeen [0, 255]',a.commandStr);var g=m.size|0;i.command(!("size"in m)||g>0&&g<=4,'invalid size for attribute "'+c+'", must be 1,2,3,4',a.commandStr);var C=!!m.normalized,R=0;"type"in m&&(i.commandParameter(m.type,lr,"invalid type for attribute "+c,a.commandStr),R=lr[m.type]);var D=m.divisor|0;"divisor"in m&&(i.command(D===0||B,'cannot specify divisor for attribute "'+c+'", instancing not supported',a.commandStr),i.command(D>=0,'invalid divisor for attribute "'+c+'"',a.commandStr)),i.optional(function(){var Z=a.commandStr,oe=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(m).forEach(function(q){i.command(oe.indexOf(q)>=0,'unknown parameter "'+q+'" for attribute pointer "'+c+'" (valid parameters are '+oe+")",Z)})}),o.buffer=l,o.state=Dr,o.size=g,o.normalized=C,o.type=R||l.dtype,o.offset=d,o.stride=x,o.divisor=D}}p[c]=ge(function(Z,oe){var q=Z.attribCache;if(h in q)return q[h];var re={isStream:!1};return Object.keys(o).forEach(function(ie){re[ie]=o[ie]}),o.buffer&&(re.buffer=Z.link(o.buffer),re.type=re.type||re.buffer+".dtype"),q[h]=re,re})}),Object.keys(b).forEach(function(c){var m=b[c];function h(o,l){var n=o.invoke(l,m),d=o.shared,x=o.constants,g=d.isBufferArgs,C=d.buffer;i.optional(function(){o.assert(l,n+"&&(typeof "+n+'==="object"||typeof '+n+'==="function")&&('+g+"("+n+")||"+C+".getBuffer("+n+")||"+C+".getBuffer("+n+".buffer)||"+g+"("+n+'.buffer)||("constant" in '+n+"&&(typeof "+n+'.constant==="number"||'+d.isArrayLike+"("+n+".constant))))",'invalid dynamic attribute "'+c+'"')});var R={isStream:l.def(!1)},D=new v;D.state=Dr,Object.keys(D).forEach(function(re){R[re]=l.def(""+D[re])});var Z=R.buffer,oe=R.type;l("if(",g,"(",n,")){",R.isStream,"=true;",Z,"=",C,".createStream(",Ir,",",n,");",oe,"=",Z,".dtype;","}else{",Z,"=",C,".getBuffer(",n,");","if(",Z,"){",oe,"=",Z,".dtype;",'}else if("constant" in ',n,"){",R.state,"=",ln,";","if(typeof "+n+'.constant === "number"){',R[Fr[0]],"=",n,".constant;",Fr.slice(1).map(function(re){return R[re]}).join("="),"=0;","}else{",Fr.map(function(re,ie){return R[re]+"="+n+".constant.length>"+ie+"?"+n+".constant["+ie+"]:0;"}).join(""),"}}else{","if(",g,"(",n,".buffer)){",Z,"=",C,".createStream(",Ir,",",n,".buffer);","}else{",Z,"=",C,".getBuffer(",n,".buffer);","}",oe,'="type" in ',n,"?",x.glTypes,"[",n,".type]:",Z,".dtype;",R.normalized,"=!!",n,".normalized;");function q(re){l(R[re],"=",n,".",re,"|0;")}return q("size"),q("offset"),q("stride"),q("divisor"),l("}}"),l.exit("if(",R.isStream,"){",C,".destroyStream(",Z,");","}"),R}p[c]=Me(m,h)}),p}function Oe(r,a){var u=r.static,b=r.dynamic;if(Yr in u){var p=u[Yr];return p!==null&&z.getVAO(p)===null&&(p=z.createVAO(p)),ge(function(m){return m.link(z.getVAO(p))})}else if(Yr in b){var c=b[Yr];return Me(c,function(m,h){var o=m.invoke(h,c);return h.def(m.shared.vao+".getVAO("+o+")")})}return null}function ye(r){var a=r.static,u=r.dynamic,b={};return Object.keys(a).forEach(function(p){var c=a[p];b[p]=ge(function(m,h){return typeof c=="number"||typeof c=="boolean"?""+c:m.link(c)})}),Object.keys(u).forEach(function(p){var c=u[p];b[p]=Me(c,function(m,h){return m.invoke(h,c)})}),b}function we(r,a,u,b,p){var c=r.static,m=r.dynamic;i.optional(function(){var q=[pr,$r,Wr,_r,br,Tt,yr,At,Xr,Yr].concat(k);function re(ie){Object.keys(ie).forEach(function(pe){i.command(q.indexOf(pe)>=0,'unknown parameter "'+pe+'"',p.commandStr)})}re(c),re(m)});var h=ae(r,a),o=K(r,p),l=se(r,o,p),n=ve(r,p),d=Le(r,p),x=ue(r,p,h);function g(q){var re=l[q];re&&(d[q]=re)}g(rr),g(H(xt));var C=Object.keys(d).length>0,R={framebuffer:o,draw:n,shader:x,state:d,dirty:C,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(R.profile=me(r,p),R.uniforms=De(u,p),R.drawVAO=R.scopeVAO=Oe(r,p),!R.drawVAO&&x.program&&!h&&s.angle_instanced_arrays){var D=!0,Z=x.program.attributes.map(function(q){var re=a.static[q];return D=D&&!!re,re});if(D&&Z.length>0){var oe=z.getVAO(z.createVAO(Z));R.drawVAO=new je(null,null,null,function(q,re){return q.link(oe)}),R.useVAO=!0}}return h?R.useVAO=!0:R.attributes=de(a,p),R.context=ye(b,p),R}function Ge(r,a,u){var b=r.shared,p=b.context,c=r.scope();Object.keys(u).forEach(function(m){a.save(p,"."+m);var h=u[m];c(p,".",m,"=",h.append(r,a),";")}),a(c)}function Ce(r,a,u,b){var p=r.shared,c=p.gl,m=p.framebuffer,h;X&&(h=a.def(p.extensions,".webgl_draw_buffers"));var o=r.constants,l=o.drawBuffer,n=o.backBuffer,d;u?d=u.append(r,a):d=a.def(m,".next"),b||a("if(",d,"!==",m,".cur){"),a("if(",d,"){",c,".bindFramebuffer(",Fi,",",d,".framebuffer);"),X&&a(h,".drawBuffersWEBGL(",l,"[",d,".colorAttachments.length]);"),a("}else{",c,".bindFramebuffer(",Fi,",null);"),X&&a(h,".drawBuffersWEBGL(",n,");"),a("}",m,".cur=",d,";"),b||a("}")}function Ne(r,a,u){var b=r.shared,p=b.gl,c=r.current,m=r.next,h=b.current,o=b.next,l=r.cond(h,".dirty");k.forEach(function(n){var d=H(n);if(!(d in u.state)){var x,g;if(d in m){x=m[d],g=c[d];var C=Ve(O[d].length,function(D){return l.def(x,"[",D,"]")});l(r.cond(C.map(function(D,Z){return D+"!=="+g+"["+Z+"]"}).join("||")).then(p,".",G[d],"(",C,");",C.map(function(D,Z){return g+"["+Z+"]="+D}).join(";"),";"))}else{x=l.def(o,".",d);var R=r.cond(x,"!==",h,".",d);l(R),d in W?R(r.cond(x).then(p,".enable(",W[d],");").else(p,".disable(",W[d],");"),h,".",d,"=",x,";"):R(p,".",G[d],"(",x,");",h,".",d,"=",x,";")}}}),Object.keys(u.state).length===0&&l(h,".dirty=false;"),a(l)}function Pe(r,a,u,b){var p=r.shared,c=r.current,m=p.current,h=p.gl;Bi(Object.keys(u)).forEach(function(o){var l=u[o];if(!(b&&!b(l))){var n=l.append(r,a);if(W[o]){var d=W[o];or(l)?n?a(h,".enable(",d,");"):a(h,".disable(",d,");"):a(r.cond(n).then(h,".enable(",d,");").else(h,".disable(",d,");")),a(m,".",o,"=",n,";")}else if(Te(n)){var x=c[o];a(h,".",G[o],"(",n,");",n.map(function(g,C){return x+"["+C+"]="+g}).join(";"),";")}else a(h,".",G[o],"(",n,");",m,".",o,"=",n,";")}})}function Fe(r,a){B&&(r.instancing=a.def(r.shared.extensions,".angle_instanced_arrays"))}function fe(r,a,u,b,p){var c=r.shared,m=r.stats,h=c.current,o=c.timer,l=u.profile;function n(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var d,x;function g(q){d=a.def(),q(d,"=",n(),";"),typeof p=="string"?q(m,".count+=",p,";"):q(m,".count++;"),F&&(b?(x=a.def(),q(x,"=",o,".getNumPendingQueries();")):q(o,".beginQuery(",m,");"))}function C(q){q(m,".cpuTime+=",n(),"-",d,";"),F&&(b?q(o,".pushScopeStats(",x,",",o,".getNumPendingQueries(),",m,");"):q(o,".endQuery();"))}function R(q){var re=a.def(h,".profile");a(h,".profile=",q,";"),a.exit(h,".profile=",re,";")}var D;if(l){if(or(l)){l.enable?(g(a),C(a.exit),R("true")):R("false");return}D=l.append(r,a),R(D)}else D=a.def(h,".profile");var Z=r.block();g(Z),a("if(",D,"){",Z,"}");var oe=r.block();C(oe),a.exit("if(",D,"){",oe,"}")}function ke(r,a,u,b,p){var c=r.shared;function m(o){switch(o){case St:case wt:case Gt:return 2;case gt:case Rt:case Ct:return 3;case Lt:case Ot:case Ft:return 4;default:return 1}}function h(o,l,n){var d=c.gl,x=a.def(o,".location"),g=a.def(c.attributes,"[",x,"]"),C=n.state,R=n.buffer,D=[n.x,n.y,n.z,n.w],Z=["buffer","normalized","offset","stride"];function oe(){a("if(!",g,".buffer){",d,".enableVertexAttribArray(",x,");}");var re=n.type,ie;if(n.size?ie=a.def(n.size,"||",l):ie=l,a("if(",g,".type!==",re,"||",g,".size!==",ie,"||",Z.map(function(Re){return g+"."+Re+"!=="+n[Re]}).join("||"),"){",d,".bindBuffer(",Ir,",",R,".buffer);",d,".vertexAttribPointer(",[x,ie,re,n.normalized,n.stride,n.offset],");",g,".type=",re,";",g,".size=",ie,";",Z.map(function(Re){return g+"."+Re+"="+n[Re]+";"}).join(""),"}"),B){var pe=n.divisor;a("if(",g,".divisor!==",pe,"){",r.instancing,".vertexAttribDivisorANGLE(",[x,pe],");",g,".divisor=",pe,";}")}}function q(){a("if(",g,".buffer){",d,".disableVertexAttribArray(",x,");",g,".buffer=null;","}if(",Fr.map(function(re,ie){return g+"."+re+"!=="+D[ie]}).join("||"),"){",d,".vertexAttrib4f(",x,",",D,");",Fr.map(function(re,ie){return g+"."+re+"="+D[ie]+";"}).join(""),"}")}C===Dr?oe():C===ln?q():(a("if(",C,"===",Dr,"){"),oe(),a("}else{"),q(),a("}"))}b.forEach(function(o){var l=o.name,n=u.attributes[l],d;if(n){if(!p(n))return;d=n.append(r,a)}else{if(!p(Ii))return;var x=r.scopeAttrib(l);i.optional(function(){r.assert(a,x+".state","missing attribute "+l)}),d={},Object.keys(new v).forEach(function(g){d[g]=a.def(x,".",g)})}h(r.link(o),m(o.info.type),d)})}function _e(r,a,u,b,p){for(var c=r.shared,m=c.gl,h,o=0;o<b.length;++o){var l=b[o],n=l.name,d=l.info.type,x=u.uniforms[n],g=r.link(l),C=g+".location",R;if(x){if(!p(x))continue;if(or(x)){var D=x.value;if(i.command(D!==null&&typeof D!="undefined",'missing uniform "'+n+'"',r.commandStr),d===Zr||d===Jr){i.command(typeof D=="function"&&(d===Zr&&(D._reglType==="texture2d"||D._reglType==="framebuffer")||d===Jr&&(D._reglType==="textureCube"||D._reglType==="framebufferCube")),"invalid texture for uniform "+n,r.commandStr);var Z=r.link(D._texture||D.color[0]._texture);a(m,".uniform1i(",C,",",Z+".bind());"),a.exit(Z,".unbind();")}else if(d===Qr||d===qr||d===Kr){i.optional(function(){i.command(Te(D),"invalid matrix for uniform "+n,r.commandStr),i.command(d===Qr&&D.length===4||d===qr&&D.length===9||d===Kr&&D.length===16,"invalid length for matrix uniform "+n,r.commandStr)});var oe=r.global.def("new Float32Array(["+Array.prototype.slice.call(D)+"])"),q=2;d===qr?q=3:d===Kr&&(q=4),a(m,".uniformMatrix",q,"fv(",C,",false,",oe,");")}else{switch(d){case Sn:i.commandType(D,"number","uniform "+n,r.commandStr),h="1f";break;case St:i.command(Te(D)&&D.length===2,"uniform "+n,r.commandStr),h="2f";break;case gt:i.command(Te(D)&&D.length===3,"uniform "+n,r.commandStr),h="3f";break;case Lt:i.command(Te(D)&&D.length===4,"uniform "+n,r.commandStr),h="4f";break;case Ln:i.commandType(D,"boolean","uniform "+n,r.commandStr),h="1i";break;case gn:i.commandType(D,"number","uniform "+n,r.commandStr),h="1i";break;case Gt:i.command(Te(D)&&D.length===2,"uniform "+n,r.commandStr),h="2i";break;case wt:i.command(Te(D)&&D.length===2,"uniform "+n,r.commandStr),h="2i";break;case Ct:i.command(Te(D)&&D.length===3,"uniform "+n,r.commandStr),h="3i";break;case Rt:i.command(Te(D)&&D.length===3,"uniform "+n,r.commandStr),h="3i";break;case Ft:i.command(Te(D)&&D.length===4,"uniform "+n,r.commandStr),h="4i";break;case Ot:i.command(Te(D)&&D.length===4,"uniform "+n,r.commandStr),h="4i";break}a(m,".uniform",h,"(",C,",",Te(D)?Array.prototype.slice.call(D):D,");")}continue}else R=x.append(r,a)}else{if(!p(Ii))continue;R=a.def(c.uniforms,"[",t.id(n),"]")}d===Zr?a("if(",R,"&&",R,'._reglType==="framebuffer"){',R,"=",R,".color[0];","}"):d===Jr&&a("if(",R,"&&",R,'._reglType==="framebufferCube"){',R,"=",R,".color[0];","}"),i.optional(function(){function Qe(tr,ji){r.assert(a,tr,'bad data or missing for uniform "'+n+'".  '+ji)}function On(tr){Qe("typeof "+R+'==="'+tr+'"',"invalid type, expected "+tr)}function Xe(tr,ji){Qe(c.isArrayLike+"("+R+")&&"+R+".length==="+tr,"invalid vector, should have length "+tr,r.commandStr)}function zi(tr){Qe("typeof "+R+'==="function"&&'+R+'._reglType==="texture'+(tr===Li?"2d":"Cube")+'"',"invalid texture type",r.commandStr)}switch(d){case gn:On("number");break;case wt:Xe(2,"number");break;case Rt:Xe(3,"number");break;case Ot:Xe(4,"number");break;case Sn:On("number");break;case St:Xe(2,"number");break;case gt:Xe(3,"number");break;case Lt:Xe(4,"number");break;case Ln:On("boolean");break;case Gt:Xe(2,"boolean");break;case Ct:Xe(3,"boolean");break;case Ft:Xe(4,"boolean");break;case Qr:Xe(4,"number");break;case qr:Xe(9,"number");break;case Kr:Xe(16,"number");break;case Zr:zi(Li);break;case Jr:zi(us);break}});var re=1;switch(d){case Zr:case Jr:var ie=a.def(R,"._texture");a(m,".uniform1i(",C,",",ie,".bind());"),a.exit(ie,".unbind();");continue;case gn:case Ln:h="1i";break;case wt:case Gt:h="2i",re=2;break;case Rt:case Ct:h="3i",re=3;break;case Ot:case Ft:h="4i",re=4;break;case Sn:h="1f";break;case St:h="2f",re=2;break;case gt:h="3f",re=3;break;case Lt:h="4f",re=4;break;case Qr:h="Matrix2fv";break;case qr:h="Matrix3fv";break;case Kr:h="Matrix4fv";break}if(a(m,".uniform",h,"(",C,","),h.charAt(0)==="M"){var pe=Math.pow(d-Qr+2,2),Re=r.global.def("new Float32Array(",pe,")");a("false,(Array.isArray(",R,")||",R," instanceof Float32Array)?",R,":(",Ve(pe,function(Qe){return Re+"["+Qe+"]="+R+"["+Qe+"]"}),",",Re,")")}else re>1?a(Ve(re,function(Qe){return R+"["+Qe+"]"})):a(R);a(");")}}function ee(r,a,u,b){var p=r.shared,c=p.gl,m=p.draw,h=b.draw;function o(){var ie=h.elements,pe,Re=a;return ie?((ie.contextDep&&b.contextDynamic||ie.propDep)&&(Re=u),pe=ie.append(r,Re)):pe=Re.def(m,".",_r),pe&&Re("if("+pe+")"+c+".bindBuffer("+is+","+pe+".buffer.buffer);"),pe}function l(){var ie=h.count,pe,Re=a;return ie?((ie.contextDep&&b.contextDynamic||ie.propDep)&&(Re=u),pe=ie.append(r,Re),i.optional(function(){ie.MISSING&&r.assert(a,"false","missing vertex count"),ie.DYNAMIC&&r.assert(Re,pe+">=0","missing vertex count")})):(pe=Re.def(m,".",yr),i.optional(function(){r.assert(Re,pe+">=0","missing vertex count")})),pe}var n=o();function d(ie){var pe=h[ie];return pe?pe.contextDep&&b.contextDynamic||pe.propDep?pe.append(r,u):pe.append(r,a):a.def(m,".",ie)}var x=d(br),g=d(Tt),C=l();if(typeof C=="number"){if(C===0)return}else u("if(",C,"){"),u.exit("}");var R,D;B&&(R=d(At),D=r.instancing);var Z=n+".type",oe=h.elements&&or(h.elements);function q(){function ie(){u(D,".drawElementsInstancedANGLE(",[x,C,Z,g+"<<(("+Z+"-"+ni+")>>1)",R],");")}function pe(){u(D,".drawArraysInstancedANGLE(",[x,g,C,R],");")}n?oe?ie():(u("if(",n,"){"),ie(),u("}else{"),pe(),u("}")):pe()}function re(){function ie(){u(c+".drawElements("+[x,C,Z,g+"<<(("+Z+"-"+ni+")>>1)"]+");")}function pe(){u(c+".drawArrays("+[x,g,C]+");")}n?oe?ie():(u("if(",n,"){"),ie(),u("}else{"),pe(),u("}")):pe()}B&&(typeof R!="number"||R>=0)?typeof R=="string"?(u("if(",R,">0){"),q(),u("}else if(",R,"<0){"),re(),u("}")):q():re()}function le(r,a,u,b,p){var c=ne(),m=c.proc("body",p);return i.optional(function(){c.commandStr=a.commandStr,c.command=c.link(a.commandStr)}),B&&(c.instancing=m.def(c.shared.extensions,".angle_instanced_arrays")),r(c,m,u,b),c.compile().body}function he(r,a,u,b){Fe(r,a),u.useVAO?u.drawVAO?a(r.shared.vao,".setVAO(",u.drawVAO.append(r,a),");"):a(r.shared.vao,".setVAO(",r.shared.vao,".targetVAO);"):(a(r.shared.vao,".setVAO(null);"),ke(r,a,u,b.attributes,function(){return!0})),_e(r,a,u,b.uniforms,function(){return!0}),ee(r,a,a,u)}function Ae(r,a){var u=r.proc("draw",1);Fe(r,u),Ge(r,u,a.context),Ce(r,u,a.framebuffer),Ne(r,u,a),Pe(r,u,a.state),fe(r,u,a,!1,!0);var b=a.shader.progVar.append(r,u);if(u(r.shared.gl,".useProgram(",b,".program);"),a.shader.program)he(r,u,a,a.shader.program);else{u(r.shared.vao,".setVAO(null);");var p=r.global.def("{}"),c=u.def(b,".id"),m=u.def(p,"[",c,"]");u(r.cond(m).then(m,".call(this,a0);").else(m,"=",p,"[",c,"]=",r.link(function(h){return le(he,r,a,h,1)}),"(",b,");",m,".call(this,a0);"))}Object.keys(a.state).length>0&&u(r.shared.current,".dirty=true;")}function Ke(r,a,u,b){r.batchId="a1",Fe(r,a);function p(){return!0}ke(r,a,u,b.attributes,p),_e(r,a,u,b.uniforms,p),ee(r,a,a,u)}function f(r,a,u,b){Fe(r,a);var p=u.contextDep,c=a.def(),m="a0",h="a1",o=a.def();r.shared.props=o,r.batchId=c;var l=r.scope(),n=r.scope();a(l.entry,"for(",c,"=0;",c,"<",h,";++",c,"){",o,"=",m,"[",c,"];",n,"}",l.exit);function d(Z){return Z.contextDep&&p||Z.propDep}function x(Z){return!d(Z)}if(u.needsContext&&Ge(r,n,u.context),u.needsFramebuffer&&Ce(r,n,u.framebuffer),Pe(r,n,u.state,d),u.profile&&d(u.profile)&&fe(r,n,u,!1,!0),b)u.useVAO?u.drawVAO?d(u.drawVAO)?n(r.shared.vao,".setVAO(",u.drawVAO.append(r,n),");"):l(r.shared.vao,".setVAO(",u.drawVAO.append(r,l),");"):l(r.shared.vao,".setVAO(",r.shared.vao,".targetVAO);"):(l(r.shared.vao,".setVAO(null);"),ke(r,l,u,b.attributes,x),ke(r,n,u,b.attributes,d)),_e(r,l,u,b.uniforms,x),_e(r,n,u,b.uniforms,d),ee(r,l,n,u);else{var g=r.global.def("{}"),C=u.shader.progVar.append(r,n),R=n.def(C,".id"),D=n.def(g,"[",R,"]");n(r.shared.gl,".useProgram(",C,".program);","if(!",D,"){",D,"=",g,"[",R,"]=",r.link(function(Z){return le(Ke,r,u,Z,2)}),"(",C,");}",D,".call(this,a0[",c,"],",c,");")}}function T(r,a){var u=r.proc("batch",2);r.batchId="0",Fe(r,u);var b=!1,p=!0;Object.keys(a.context).forEach(function(g){b=b||a.context[g].propDep}),b||(Ge(r,u,a.context),p=!1);var c=a.framebuffer,m=!1;c?(c.propDep?b=m=!0:c.contextDep&&b&&(m=!0),m||Ce(r,u,c)):Ce(r,u,null),a.state.viewport&&a.state.viewport.propDep&&(b=!0);function h(g){return g.contextDep&&b||g.propDep}Ne(r,u,a),Pe(r,u,a.state,function(g){return!h(g)}),(!a.profile||!h(a.profile))&&fe(r,u,a,!1,"a1"),a.contextDep=b,a.needsContext=p,a.needsFramebuffer=m;var o=a.shader.progVar;if(o.contextDep&&b||o.propDep)f(r,u,a,null);else{var l=o.append(r,u);if(u(r.shared.gl,".useProgram(",l,".program);"),a.shader.program)f(r,u,a,a.shader.program);else{u(r.shared.vao,".setVAO(null);");var n=r.global.def("{}"),d=u.def(l,".id"),x=u.def(n,"[",d,"]");u(r.cond(x).then(x,".call(this,a0,a1);").else(x,"=",n,"[",d,"]=",r.link(function(g){return le(f,r,a,g,2)}),"(",l,");",x,".call(this,a0,a1);"))}}Object.keys(a.state).length>0&&u(r.shared.current,".dirty=true;")}function _(r,a){var u=r.proc("scope",3);r.batchId="a2";var b=r.shared,p=b.current;Ge(r,u,a.context),a.framebuffer&&a.framebuffer.append(r,u),Bi(Object.keys(a.state)).forEach(function(m){var h=a.state[m],o=h.append(r,u);Te(o)?o.forEach(function(l,n){u.set(r.next[m],"["+n+"]",l)}):u.set(b.next,"."+m,o)}),fe(r,u,a,!0,!0),[_r,Tt,yr,At,br].forEach(function(m){var h=a.draw[m];h&&u.set(b.draw,"."+m,""+h.append(r,u))}),Object.keys(a.uniforms).forEach(function(m){u.set(b.uniforms,"["+t.id(m)+"]",a.uniforms[m].append(r,u))}),Object.keys(a.attributes).forEach(function(m){var h=a.attributes[m].append(r,u),o=r.scopeAttrib(m);Object.keys(new v).forEach(function(l){u.set(o,"."+l,h[l])})}),a.scopeVAO&&u.set(b.vao,".targetVAO",a.scopeVAO.append(r,u));function c(m){var h=a.shader[m];h&&u.set(b.shader,"."+m,h.append(r,u))}c($r),c(Wr),Object.keys(a.state).length>0&&(u(p,".dirty=true;"),u.exit(p,".dirty=true;")),u("a1(",r.shared.context,",a0,",r.batchId,");")}function Q(r){if(!(typeof r!="object"||Te(r))){for(var a=Object.keys(r),u=0;u<a.length;++u)if($e.isDynamic(r[a[u]]))return!0;return!1}}function ce(r,a,u){var b=a.static[u];if(!b||!Q(b))return;var p=r.global,c=Object.keys(b),m=!1,h=!1,o=!1,l=r.global.def("{}");c.forEach(function(d){var x=b[d];if($e.isDynamic(x)){typeof x=="function"&&(x=b[d]=$e.unbox(x));var g=Me(x,null);m=m||g.thisDep,o=o||g.propDep,h=h||g.contextDep}else{switch(p(l,".",d,"="),typeof x){case"number":p(x);break;case"string":p('"',x,'"');break;case"object":Array.isArray(x)&&p("[",x.join(),"]");break;default:p(r.link(x));break}p(";")}});function n(d,x){c.forEach(function(g){var C=b[g];if($e.isDynamic(C)){var R=d.invoke(x,C);x(l,".",g,"=",R,";")}})}a.dynamic[u]=new $e.DynamicVariable(dn,{thisDep:m,contextDep:h,propDep:o,ref:l,append:n}),delete a.static[u]}function be(r,a,u,b,p){var c=ne();c.stats=c.link(p),Object.keys(a.static).forEach(function(h){ce(c,a,h)}),as.forEach(function(h){ce(c,r,h)});var m=we(r,a,u,b,c);return Ae(c,m),_(c,m),T(c,m),c.compile()}return{next:Y,current:O,procs:function(){var r=ne(),a=r.proc("poll"),u=r.proc("refresh"),b=r.block();a(b),u(b);var p=r.shared,c=p.gl,m=p.next,h=p.current;b(h,".dirty=false;"),Ce(r,a),Ce(r,u,null,!0);var o;B&&(o=r.link(B)),s.oes_vertex_array_object&&u(r.link(s.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var l=0;l<y.maxAttributes;++l){var n=u.def(p.attributes,"[",l,"]"),d=r.cond(n,".buffer");d.then(c,".enableVertexAttribArray(",l,");",c,".bindBuffer(",Ir,",",n,".buffer.buffer);",c,".vertexAttribPointer(",l,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);").else(c,".disableVertexAttribArray(",l,");",c,".vertexAttrib4f(",l,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;"),u(d),B&&u(o,".vertexAttribDivisorANGLE(",l,",",n,".divisor);")}return u(r.shared.vao,".currentVAO=null;",r.shared.vao,".setVAO(",r.shared.vao,".targetVAO);"),Object.keys(W).forEach(function(x){var g=W[x],C=b.def(m,".",x),R=r.block();R("if(",C,"){",c,".enable(",g,")}else{",c,".disable(",g,")}",h,".",x,"=",C,";"),u(R),a("if(",C,"!==",h,".",x,"){",R,"}")}),Object.keys(G).forEach(function(x){var g=G[x],C=O[x],R,D,Z=r.block();if(Z(c,".",g,"("),Te(C)){var oe=C.length;R=r.global.def(m,".",x),D=r.global.def(h,".",x),Z(Ve(oe,function(q){return R+"["+q+"]"}),");",Ve(oe,function(q){return D+"["+q+"]="+R+"["+q+"];"}).join("")),a("if(",Ve(oe,function(q){return R+"["+q+"]!=="+D+"["+q+"]"}).join("||"),"){",Z,"}")}else R=b.def(m,".",x),D=b.def(h,".",x),Z(R,");",h,".",x,"=",R,";"),a("if(",R,"!==",D,"){",Z,"}");u(Z)}),r.compile()}(),compile:be}}function Ss(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var gs=34918,Ls=34919,ki=35007,ws=function(e,t){if(!t.ext_disjoint_timer_query)return null;var s=[];function y(){return s.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function L(B){s.push(B)}var E=[];function S(B){var X=y();t.ext_disjoint_timer_query.beginQueryEXT(ki,X),E.push(X),F(E.length-1,E.length,B)}function N(){t.ext_disjoint_timer_query.endQueryEXT(ki)}function I(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var z=[];function M(){return z.pop()||new I}function U(B){z.push(B)}var j=[];function F(B,X,O){var Y=M();Y.startQueryIndex=B,Y.endQueryIndex=X,Y.sum=0,Y.stats=O,j.push(Y)}var V=[],v=[];function A(){var B,X,O=E.length;if(O!==0){v.length=Math.max(v.length,O+1),V.length=Math.max(V.length,O+1),V[0]=0,v[0]=0;var Y=0;for(B=0,X=0;X<E.length;++X){var k=E[X];t.ext_disjoint_timer_query.getQueryObjectEXT(k,Ls)?(Y+=t.ext_disjoint_timer_query.getQueryObjectEXT(k,gs),L(k)):E[B++]=k,V[X+1]=Y,v[X+1]=B}for(E.length=B,B=0,X=0;X<j.length;++X){var W=j[X],G=W.startQueryIndex,H=W.endQueryIndex;W.sum+=V[H]-V[G];var J=v[G],te=v[H];te===J?(W.stats.gpuTime+=W.sum/1e6,U(W)):(W.startQueryIndex=J,W.endQueryIndex=te,j[B++]=W)}j.length=B}}return{beginQuery:S,endQuery:N,pushScopeStats:F,update:A,getNumPendingQueries:function(){return E.length},clear:function(){s.push.apply(s,E);for(var B=0;B<s.length;B++)t.ext_disjoint_timer_query.deleteQueryEXT(s[B]);E.length=0,s.length=0},restore:function(){E.length=0,s.length=0}}},Rs=16384,Os=256,Gs=1024,Cs=34962,Pi="webglcontextlost",Mi="webglcontextrestored",Ui=1,Fs=2,Ds=3;function Vi(e,t){for(var s=0;s<e.length;++s)if(e[s]===t)return s;return-1}function Ns(e){var t=Gf(e);if(!t)return null;var s=t.gl,y=s.getContextAttributes(),L=s.isContextLost(),E=Cf(s,t);if(!E)return null;var S=gf(),N=Ss(),I=E.extensions,z=ws(s,I),M=$n(),U=s.drawingBufferWidth,j=s.drawingBufferHeight,F={tick:0,time:0,viewportWidth:U,viewportHeight:j,framebufferWidth:U,framebufferHeight:j,drawingBufferWidth:U,drawingBufferHeight:j,pixelRatio:t.pixelRatio},V={},v={elements:null,primitive:4,count:-1,offset:0,instances:-1},A=yo(s,I),B=Bo(s,N,t,O),X=Wu(s,I,A,N,B);function O(ee){return X.destroyBuffer(ee)}var Y=Wo(s,I,B,N),k=Ku(s,S,N,t),W=Su(s,I,A,function(){J.procs.poll()},F,N,t),G=gu(s,I,A,N,t),H=Xu(s,I,A,W,G,N),J=As(s,S,I,A,B,Y,W,H,V,X,k,v,F,z,t),te=es(s,H,J.procs.poll,F,y,I,A),$=J.next,P=s.canvas,w=[],ne=[],me=[],K=[t.onDestroy],se=null;function ae(){if(w.length===0){z&&z.update(),se=null;return}se=kt.next(ae),Pe();for(var ee=w.length-1;ee>=0;--ee){var le=w[ee];le&&le(F,null,0)}s.flush(),z&&z.update()}function ue(){!se&&w.length>0&&(se=kt.next(ae))}function ve(){se&&(kt.cancel(ae),se=null)}function Le(ee){ee.preventDefault(),L=!0,ve(),ne.forEach(function(le){le()})}function De(ee){s.getError(),L=!1,E.restore(),k.restore(),B.restore(),W.restore(),G.restore(),H.restore(),X.restore(),z&&z.restore(),J.procs.refresh(),ue(),me.forEach(function(le){le()})}P&&(P.addEventListener(Pi,Le,!1),P.addEventListener(Mi,De,!1));function de(){w.length=0,ve(),P&&(P.removeEventListener(Pi,Le),P.removeEventListener(Mi,De)),k.clear(),H.clear(),G.clear(),W.clear(),Y.clear(),B.clear(),X.clear(),z&&z.clear(),K.forEach(function(ee){ee()})}function Oe(ee){i(!!ee,"invalid args to regl({...})"),i.type(ee,"object","invalid args to regl({...})");function le(p){var c=xe({},p);delete c.uniforms,delete c.attributes,delete c.context,delete c.vao,"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);function m(h){if(h in c){var o=c[h];delete c[h],Object.keys(o).forEach(function(l){c[h+"."+l]=o[l]})}}return m("blend"),m("depth"),m("cull"),m("stencil"),m("polygonOffset"),m("scissor"),m("sample"),"vao"in p&&(c.vao=p.vao),c}function he(p){var c={},m={};return Object.keys(p).forEach(function(h){var o=p[h];$e.isDynamic(o)?m[h]=$e.unbox(o,h):c[h]=o}),{dynamic:m,static:c}}var Ae=he(ee.context||{}),Ke=he(ee.uniforms||{}),f=he(ee.attributes||{}),T=he(le(ee)),_={gpuTime:0,cpuTime:0,count:0},Q=J.compile(T,f,Ke,Ae,_),ce=Q.draw,be=Q.batch,r=Q.scope,a=[];function u(p){for(;a.length<p;)a.push(null);return a}function b(p,c){var m;if(L&&i.raise("context lost"),typeof p=="function")return r.call(this,null,p,0);if(typeof c=="function")if(typeof p=="number")for(m=0;m<p;++m)r.call(this,null,c,m);else if(Array.isArray(p))for(m=0;m<p.length;++m)r.call(this,p[m],c,m);else return r.call(this,p,c,0);else if(typeof p=="number"){if(p>0)return be.call(this,u(p|0),p|0)}else if(Array.isArray(p)){if(p.length)return be.call(this,p,p.length)}else return ce.call(this,p)}return xe(b,{stats:_})}var ye=H.setFBO=Oe({framebuffer:$e.define.call(null,Ui,"framebuffer")});function we(ee,le){var he=0;J.procs.poll();var Ae=le.color;Ae&&(s.clearColor(+Ae[0]||0,+Ae[1]||0,+Ae[2]||0,+Ae[3]||0),he|=Rs),"depth"in le&&(s.clearDepth(+le.depth),he|=Os),"stencil"in le&&(s.clearStencil(le.stencil|0),he|=Gs),i(!!he,"called regl.clear with no buffer specified"),s.clear(he)}function Ge(ee){if(i(typeof ee=="object"&&ee,"regl.clear() takes an object as input"),"framebuffer"in ee)if(ee.framebuffer&&ee.framebuffer_reglType==="framebufferCube")for(var le=0;le<6;++le)ye(xe({framebuffer:ee.framebuffer.faces[le]},ee),we);else ye(ee,we);else we(null,ee)}function Ce(ee){i.type(ee,"function","regl.frame() callback must be a function"),w.push(ee);function le(){var he=Vi(w,ee);i(he>=0,"cannot cancel a frame twice");function Ae(){var Ke=Vi(w,Ae);w[Ke]=w[w.length-1],w.length-=1,w.length<=0&&ve()}w[he]=Ae}return ue(),{cancel:le}}function Ne(){var ee=$.viewport,le=$.scissor_box;ee[0]=ee[1]=le[0]=le[1]=0,F.viewportWidth=F.framebufferWidth=F.drawingBufferWidth=ee[2]=le[2]=s.drawingBufferWidth,F.viewportHeight=F.framebufferHeight=F.drawingBufferHeight=ee[3]=le[3]=s.drawingBufferHeight}function Pe(){F.tick+=1,F.time=fe(),Ne(),J.procs.poll()}function Fe(){Ne(),J.procs.refresh(),z&&z.update()}function fe(){return($n()-M)/1e3}Fe();function ke(ee,le){i.type(le,"function","listener callback must be a function");var he;switch(ee){case"frame":return Ce(le);case"lost":he=ne;break;case"restore":he=me;break;case"destroy":he=K;break;default:i.raise("invalid event, must be one of frame,lost,restore,destroy")}return he.push(le),{cancel:function(){for(var Ae=0;Ae<he.length;++Ae)if(he[Ae]===le){he[Ae]=he[he.length-1],he.pop();return}}}}var _e=xe(Oe,{clear:Ge,prop:$e.define.bind(null,Ui),context:$e.define.bind(null,Fs),this:$e.define.bind(null,Ds),draw:Oe({}),buffer:function(ee){return B.create(ee,Cs,!1,!1)},elements:function(ee){return Y.create(ee,!1)},texture:W.create2D,cube:W.createCube,renderbuffer:G.create,framebuffer:H.create,framebufferCube:H.createCube,vao:X.createVAO,attributes:y,frame:Ce,on:ke,limits:A,hasExtension:function(ee){return A.extensions.indexOf(ee.toLowerCase())>=0},read:te,destroy:de,_gl:s,_refresh:Fe,poll:function(){Pe(),z&&z.update()},now:fe,stats:N});return t.onDone(null,_e),_e}return Ns})}}]);
