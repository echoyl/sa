"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[318],{55318:function(Qe,K,a){a.r(K),a.d(K,{default:function(){return Re}});var ue=a(19632),g=a.n(ue),ve=a(15009),Q=a.n(ve),ce=a(99289),fe=a.n(ce),me=a(5574),p=a.n(me),ge=a(68400),he=a.n(ge),xe=a(97857),o=a.n(xe),W=a(97584),A=a(51042),ye=a(79090),je=a(14726),pe=a(9361),X=a(36457),Se=a(40411),Te=a(96917),m=a(67294),B=a(60887),O=a(45587),Ce=a(97133),Le=a(70145),N=a(65302),n=a(85893),Y,Ie=function(r){var D=r.originNode,I=r.file,u=(0,O.nB)({id:I.uid}),V=u.attributes,E=u.listeners,h=u.setNodeRef,S=u.transform,v=u.transition,x=u.isDragging,c={cursor:"move",transition:"unset",height:"100%",width:"100%"},U=S?o()(o()({},c),{},{transform:"translate3d(".concat(S.x,"px, ").concat(S.y,"px, 0)"),transition:x?"unset":v},x?{zIndex:9999}:{}):c,G=x?(0,Ce.iv)(Y||(Y=he()([`
        a {
          pointer-events: none;
        }
      `]))):"";return(0,n.jsx)("div",o()(o()(o()({ref:h,style:U,className:G},V),E),{},{children:I.status==="error"&&x?D.props.children:D}))},Pe=function(r){var D=(0,m.useState)(),I=p()(D,2),u=I[0],V=I[1],E=r.max,h=E===void 0?1:E,S=r.type,v=S===void 0?"image":S,x=r.value,c=x===void 0?[]:x,U=r.size,G=U===void 0?0:U,$=r.accept,Ne=$===void 0?v=="image"?"image/*":"application/*,text/*":$,w=r.fieldProps,T=w===void 0?{name:"file",listType:"picture-card",data:{toSize:G,isFile:v=="image"?0:1}}:w,k=r.buttonType,f=k===void 0?"card":k,q=r.readonly,P=q===void 0?!1:q,De=(0,m.useState)([]),_=p()(De,2),e=_[0],y=_[1],ee=(0,m.useContext)(Le.r),z=ee.notificationApi,b=ee.setting,Ee=(0,m.useState)(!1),te=p()(Ee,2),Ue=te[0],ae=te[1],ze=(0,m.useState)(0),ne=p()(ze,2),Fe=ne[0],ie=ne[1],Ae=(0,m.useState)(!1),le=p()(Ae,2),F=le[0],H=le[1];T.maxCount=h,T.multiple=h>1,T.accept=Ne;var re=function(t){if((0,N.jg)(t))return{url:t,value:t};var l;return{url:[b==null||(l=b.adminSetting)===null||l===void 0?void 0:l.fileImagePrefix,t].join(""),value:t}};(0,m.useEffect)(function(){(0,W.hu)().then(function(i){V(i)})},[]),(0,m.useEffect)(function(){var i=[];if((0,N.d8)(c))i.push(re(c)),y(i);else if((0,N.H1)(c)){if(c.length<1)return;c.map(function(t){(0,N.d8)(t)?i.push(re(t)):i.push(t)}),y(i)}},[c]);var Be=function(){var i=fe()(Q()().mark(function t(l){return Q()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(v!="file"){d.next=2;break}return d.abrupt("return");case 2:e.forEach(function(C,L){l.uid==C.uid&&ie(L)}),ae(!0);case 4:case"end":return d.stop()}},t)}));return function(l){return i.apply(this,arguments)}}();v=="image"&&(T.onPreview=Be);var Oe=(0,n.jsxs)("div",{children:[(0,n.jsx)(A.Z,{}),(0,n.jsx)("div",{style:{marginTop:4},children:v=="image"?"\u9009\u56FE\u7247":"\u9009\u6587\u4EF6"}),(0,n.jsxs)("div",{children:[e==null?void 0:e.length,"/",h]})]}),Ve=f=="card"||f=="table"?(0,n.jsxs)("div",{children:[F?(0,n.jsx)(ye.Z,{}):(0,n.jsx)(A.Z,{}),f=="card"&&(0,n.jsx)("div",{style:{marginTop:8},children:v=="image"?"\u9009\u56FE\u7247":"\u9009\u6587\u4EF6"})]}):(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(A.Z,{}),children:v=="image"?"\u9009\u56FE\u7247":"\u9009\u6587\u4EF6"}),Ge=(0,B.VT)(B.we,{activationConstraint:{distance:10}}),be=function(t){var l=t.active,s=t.over;if(l.id!==(s==null?void 0:s.id)){var d,C=e.findIndex(function(j){return j.uid===l.id}),L=e.findIndex(function(j){return j.uid===(s==null?void 0:s.id)}),R=(0,O.Rp)(e,C,L);y(g()(R)),(d=r.onChange)===null||d===void 0||d.call(r,g()(R))}},se=function(t){if(t.file.status==="uploading"&&(H(!0),y(g()(t.fileList))),t.file.status==="done"){var l=t.file.response,s=l.code,d=l.msg,C=l.data,L=e.findIndex(function(Z){return Z.uid==t.file.uid}),R={uid:t.file.uid,name:t.file.name,url:s?"":C.src,value:s?"":C.url,status:s?"error":"done"};if(L>=0?e.splice(L,1,R):e.push(R),s)t.file.status="error",t.file.errorMsg=d;else{var j;(j=r.onChange)===null||j===void 0||j.call(r,g()(e))}y(g()(e)),H(!1)}if(t.file.status==="removed"){var M,oe=e.filter(function(Z){return Z.uid!=t.file.uid});(M=r.onChange)===null||M===void 0||M.call(r,g()(oe)),y(oe)}if(t.file.status==="error"){var J;z==null||(J=z.error)===null||J===void 0||J.call(z,{description:"".concat(t.file.name," \u4E0A\u4F20\u5931\u8D25. ").concat(t.file.errorMsg),message:"\u63D0\u793A"});var Ke=e.findIndex(function(Z){return Z.uid==t.file.uid});e.splice(Ke,1),y(g()(e)),H(!1)}},de=W.m7+"uploader/index",He=pe.Z.useToken,Me=He(),Je=Me.token;return(0,n.jsxs)(n.Fragment,{children:[h==1||P?(0,n.jsx)(X.Z,o()(o()({},T),{},{headers:u,listType:f=="card"||f=="table"?"picture-card":"text",className:"sa-upload-list sa-upload-list-".concat(f," sa-upload-list-").concat(P?"readonly":"edit"),showUploadList:e!=null&&e.length&&!F?{showRemoveIcon:!P}:!1,action:de,fileList:e!=null&&e.length?[e[0]]:[],onChange:se,itemRender:function(t){return(0,n.jsx)(Se.Z,{color:Je.colorPrimary,count:(e==null?void 0:e.length)>1&&P?e==null?void 0:e.length:0,size:"small",offset:[-2,2],styles:{root:{height:"100%",width:"100%"}},children:t})},children:e!=null&&e.length&&!F||P?null:Ve})):(0,n.jsx)(B.LB,{sensors:[Ge],onDragEnd:be,children:(0,n.jsx)(O.Fo,{items:e==null?void 0:e.map(function(i){return i.uid}),children:(0,n.jsx)(X.Z,o()(o()({},T),{},{headers:u,action:de,listType:f=="card"||f=="table"?"picture-card":"text",className:f=="table"?"sa-upload-list sa-upload-list-table":"sa-upload-list",itemRender:function(t,l){return(0,n.jsx)(Ie,{originNode:t,file:l})},fileList:e,onChange:se,children:e!=null&&e.length&&e.length==h&&!F?null:Oe}))})}),(e==null?void 0:e.length)>0&&(0,n.jsx)("div",{style:{display:"none"},children:(0,n.jsx)(Te.Z.PreviewGroup,{preview:{visible:Ue,current:Fe,onVisibleChange:function(t){ae(t)},onChange:function(t){ie(t)}},items:e==null?void 0:e.map(function(i){if(i.url){var t=i.url.split("?"),l=p()(t,2),s=l[0],d=l[1];return[s,d].join("?")+"&p=ori"}else return""})})})]})},Re=Pe}}]);
